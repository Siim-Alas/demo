!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).IJS={})}(this,(function(exports){"use strict";var bitMethods={getBit(t){return this.data[getSlot(t)]&1<<getShift(t)?1:0},setBit(t){this.data[getSlot(t)]|=1<<getShift(t)},clearBit(t){this.data[getSlot(t)]&=~(1<<getShift(t))},toggleBit(t){this.data[getSlot(t)]^=1<<getShift(t)},getBitXY(t,e){return this.getBit(e*this.width+t)},setBitXY(t,e){this.setBit(e*this.width+t)},clearBitXY(t,e){this.clearBit(e*this.width+t)},toggleBitXY(t,e){this.toggleBit(e*this.width+t)}};function getSlot(t){return t>>3}function getShift(t){return 7-(7&t)}function setBitMethods(t){for(var e in bitMethods)t.prototype[e]=bitMethods[e]}function checkProcessable(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.bitDepth,i=e.alpha,n=e.colorModel,a=e.components,o=e.channels;if("string"!=typeof t||0===t.length)throw new TypeError("processName must be a string");if(r&&(Array.isArray(r)||(r=[r]),!r.includes(this.bitDepth)))throw new TypeError(`The process: ${t} can only be applied if bit depth is in: ${r}`);if(i&&(Array.isArray(i)||(i=[i]),!i.includes(this.alpha)))throw new TypeError(`The process: ${t} can only be applied if alpha is in: ${i}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.colorModel)))throw new TypeError(`The process: ${t} can only be applied if color model is in: ${n}`);if(a&&(Array.isArray(a)||(a=[a]),!a.includes(this.components))){var s=`The process: ${t} can only be applied if the number of components is in: ${a}`;throw 1===a.length&&1===a[0]?new TypeError(s+'.\rYou should transform your image using "image.grey()" before applying the algorithm.'):new TypeError(s)}if(o&&(Array.isArray(o)||(o=[o]),!o.includes(this.channels)))throw new TypeError(`The process: ${t} can only be applied if the number of channels is in: ${o}`)}function createBlob(t,e){t=t||[],"string"==typeof(e=e||{})&&(e={type:e});try{return new Blob(t,e)}catch(n){if("TypeError"!==n.name)throw n;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<t.length;i+=1)r.append(t[i]);return r.getBlob(e.type)}}function dataURLToBlob(t){var e=t.match(/data:([^;]+)/)[1],r=t.replace(/^[^,]+,/,"");return createBlob([binaryStringToArrayBuffer(atob(r))],{type:e})}function canvasToBlob(t,e,r){return"function"==typeof t.toBlob?new Promise((function(i){t.toBlob(i,e,r)})):Promise.resolve(dataURLToBlob(t.toDataURL(e,r)))}function binaryStringToArrayBuffer(t){for(var e=t.length,r=new ArrayBuffer(e),i=new Uint8Array(r),n=-1;++n<e;)i[n]=t.charCodeAt(n);return r}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}function getCjsExportFromNamespace(t){return t&&t.default||t}var utf8=createCommonjsModule((function(t,e){!function(r){var i=e,n=t&&t.exports==i&&t,a="object"==typeof commonjsGlobal&&commonjsGlobal;a.global!==a&&a.window!==a||(r=a);var o,s,h,l=String.fromCharCode;function u(t){for(var e,r,i=[],n=0,a=t.length;n<a;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<a?56320==(64512&(r=t.charCodeAt(n++)))?i.push(((1023&e)<<10)+(1023&r)+65536):(i.push(e),n--):i.push(e);return i}function f(t){if(t>=55296&&t<=57343)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value")}function c(t,e){return l(t>>e&63|128)}function d(t){if(0==(4294967168&t))return l(t);var e="";return 0==(4294965248&t)?e=l(t>>6&31|192):0==(4294901760&t)?(f(t),e=l(t>>12&15|224),e+=c(t,6)):0==(4292870144&t)&&(e=l(t>>18&7|240),e+=c(t,12),e+=c(t,6)),e+=l(63&t|128)}function m(){if(h>=s)throw Error("Invalid byte index");var t=255&o[h];if(h++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function g(){var t,e;if(h>s)throw Error("Invalid byte index");if(h==s)return!1;if(t=255&o[h],h++,0==(128&t))return t;if(192==(224&t)){if((e=(31&t)<<6|m())>=128)return e;throw Error("Invalid continuation byte")}if(224==(240&t)){if((e=(15&t)<<12|m()<<6|m())>=2048)return f(e),e;throw Error("Invalid continuation byte")}if(240==(248&t)&&(e=(7&t)<<18|m()<<12|m()<<6|m())>=65536&&e<=1114111)return e;throw Error("Invalid UTF-8 detected")}var p={version:"2.1.2",encode:function(t){for(var e=u(t),r=e.length,i=-1,n="";++i<r;)n+=d(e[i]);return n},decode:function(t){o=u(t),s=o.length,h=0;for(var e,r=[];!1!==(e=g());)r.push(e);return function(t){for(var e,r=t.length,i=-1,n="";++i<r;)(e=t[i])>65535&&(n+=l((e-=65536)>>>10&1023|55296),e=56320|1023&e),n+=l(e);return n}(r)}};if(i&&!i.nodeType)if(n)n.exports=p;else{var w={}.hasOwnProperty;for(var v in p)w.call(p,v)&&(i[v]=p[v])}else r.utf8=p}(commonjsGlobal)}));const defaultByteLength=8192,charArray=[];class IOBuffer{constructor(t,e){e=e||{};var r=!1;void 0===t&&(t=defaultByteLength),"number"==typeof t?t=new ArrayBuffer(t):(r=!0,this._lastWrittenByte=t.byteLength);const i=e.offset?e.offset>>>0:0;let n=t.byteLength-i,a=i;t.buffer&&(t.byteLength!==t.buffer.byteLength&&(a=t.byteOffset+i),t=t.buffer),this._lastWrittenByte=r?n:0,this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=a,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,a,n),this._mark=0,this._marks=[]}available(t){return void 0===t&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t){return void 0===t&&(t=1),this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t){if(void 0===t&&(t=1),!this.available(t)){const e=2*(this.offset+t),r=new Uint8Array(e);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){void 0===t&&(t=1);for(var e=new Uint8Array(t),r=0;r<t;r++)e[r]=this.readByte();return e}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){void 0===t&&(t=1),charArray.length=t;for(var e=0;e<t;e++)charArray[e]=this.readChar();return charArray.join("")}readUtf8(t){void 0===t&&(t=1);const e=this.readChars(t);return utf8.decode(e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){const e=utf8.encode(t);return this.writeChars(e)}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}getBuffer(){return"undefined"!=typeof Buffer?Buffer.from(this.toArray()):this.toArray()}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}var IOBuffer_1=IOBuffer,constants={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const tableLeft=[];for(var i=0;i<=8;i++)tableLeft.push(255<<i);var encode=function(t){if(1!==t.bitDepth)throw new Error("Only bitDepth of 1 is supported");if(!t.height||!t.width)throw new Error("ImageData width and height are required");if(1!==t.components)throw new Error("Only 1 component is supported");if(1!==t.channels)throw new Error("Only 1 channel is supported");var e=new IOBuffer_1;e.skip(14),writeBitmapV5Header(e,t),writeColorTable(e,t);const r=e.offset;return writePixelArray(e,t),e.rewind(),writeBitmapFileHeader(e,r),e.getBuffer()};function writePixelArray(t,e){const r=4*Math.floor((e.bitDepth*e.width+31)/32),i=Math.ceil(e.bitDepth*e.width/8),n=r-i,a=e.bitDepth*e.width%8,o=0===a?0:8-a,s=r*e.height;var h,l;const u=new IOBuffer_1(e.data);let f=0,c=0,d=8;t.mark(),l=u.readUint8();for(var m=e.height-1;m>=0;m--){const e=0===m;t.reset(),t.skip(m*r);for(var g=0;g<i;g++){const r=g===i-1;c<=o&&r?(t.writeByte(l<<c),0!==o&&o!==c||e||(h=l,l=u.readByte())):0===c?(h=l,l=u.readUint8(),t.writeByte(h)):(h=l,l=u.readUint8(),t.writeByte(h<<c&tableLeft[c]|l>>d)),r?(f+=a||8,t.skip(n),c=f%8,d=8-c):f+=8}}r>i&&(t.reset(),t.skip(s-1),t.writeUint8(0))}function writeColorTable(t,e){e.bitDepth>8||t.writeUint32(0).writeUint32(16777215)}function writeBitmapFileHeader(t,e){t.writeChars("BM"),t.writeInt32(t._lastWrittenByte),t.writeUint16(0),t.writeUint16(0),t.writeUint32(e)}function writeBitmapV5Header(t,e){t.writeUint32(124).writeInt32(e.width).writeInt32(e.height).writeUint16(1).writeUint16(e.bitDepth).writeUint32(constants.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(e.width*e.height*e.bitDepth).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,e.bitDepth)).writeUint32(Math.pow(2,e.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}var encode$1=encode;!function(t){if(t.TextEncoder&&t.TextDecoder)return!1;function e(t="utf-8"){if("utf-8"!==t)throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${t}') is invalid.`)}function r(t="utf-8",e={fatal:!1}){if("utf-8"!==t)throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${t}') is invalid.`);if(e.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let r=0;const i=t.length;let n=0,a=Math.max(32,i+(i>>1)+7),o=new Uint8Array(a>>3<<3);for(;r<i;){let e=t.charCodeAt(r++);if(e>=55296&&e<=56319){if(r<i){const i=t.charCodeAt(r);56320==(64512&i)&&(++r,e=((1023&e)<<10)+(1023&i)+65536)}if(e>=55296&&e<=56319)continue}if(n+4>o.length){a+=8,a*=1+r/t.length*2,a=a>>3<<3;const e=new Uint8Array(a);e.set(o),o=e}if(0!=(4294967168&e)){if(0==(4294965248&e))o[n++]=e>>6&31|192;else if(0==(4294901760&e))o[n++]=e>>12&15|224,o[n++]=e>>6&63|128;else{if(0!=(4292870144&e))continue;o[n++]=e>>18&7|240,o[n++]=e>>12&63|128,o[n++]=e>>6&63|128}o[n++]=63&e|128}else o[n++]=e}return o.slice(0,n)},Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(r.prototype,"fatal",{value:!1}),Object.defineProperty(r.prototype,"ignoreBOM",{value:!1}),r.prototype.decode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const r=new Uint8Array(t);let i=0;const n=r.length,a=[];for(;i<n;){const t=r[i++];if(0===t)break;if(0==(128&t))a.push(t);else if(192==(224&t)){const e=63&r[i++];a.push((31&t)<<6|e)}else if(224==(240&t)){const e=63&r[i++],n=63&r[i++];a.push((31&t)<<12|e<<6|n)}else if(240==(248&t)){let e=(7&t)<<18|(63&r[i++])<<12|(63&r[i++])<<6|63&r[i++];e>65535&&(e-=65536,a.push(e>>>10&1023|55296),e=56320|1023&e),a.push(e)}}return String.fromCharCode.apply(null,a)},t.TextEncoder=e,t.TextDecoder=r}("undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0);const decoder=new TextDecoder("utf-8");function decode(t){return decoder.decode(t)}const encoder=new TextEncoder;function encode$2(t){return encoder.encode(t)}const defaultByteLength$1=8192;class IOBuffer$1{constructor(t=defaultByteLength$1,e={}){let r=!1;"number"==typeof t?t=new ArrayBuffer(t):(r=!0,this.lastWrittenByte=t.byteLength);const i=e.offset?e.offset>>>0:0,n=t.byteLength-i;let a=i;(ArrayBuffer.isView(t)||t instanceof IOBuffer$1)&&(t.byteLength!==t.buffer.byteLength&&(a=t.byteOffset+i),t=t.buffer),this.lastWrittenByte=r?n:0,this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=a,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,a,n),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const e=2*(this.offset+t),r=new Uint8Array(e);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){const e=new Uint8Array(t);for(let r=0;r<t;r++)e[r]=this.readByte();return e}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let r=0;r<t;r++)e+=this.readChar();return e}readUtf8(t=1){return decode(this.readBytes(t))}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(encode$2(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}var common=createCommonjsModule((function(t,e){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(t[n]=r[n])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var n={arraySet:function(t,e,r,i,n){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+i),n);else for(var a=0;a<i;a++)t[n+a]=e[r+a]},flattenChunks:function(t){var e,r,i,n,a,o;for(i=0,e=0,r=t.length;e<r;e++)i+=t[e].length;for(o=new Uint8Array(i),n=0,e=0,r=t.length;e<r;e++)a=t[e],o.set(a,n),n+=a.length;return o}},a={arraySet:function(t,e,r,i,n){for(var a=0;a<i;a++)t[n+a]=e[r+a]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(r)})),common_1=common.assign,common_2=common.shrinkBuf,common_3=common.setTyped,common_4=common.Buf8,common_5=common.Buf16,common_6=common.Buf32,Z_FIXED=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN=2;function zero(t){for(var e=t.length;--e>=0;)t[e]=0}var STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH=3,MAX_MATCH=258,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],DIST_CODE_LEN=512,static_ltree=new Array(2*(L_CODES+2));zero(static_ltree);var static_dtree=new Array(2*D_CODES);zero(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);var _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES),static_l_desc,static_d_desc,static_bl_desc;function StaticTreeDesc(t,e,r,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}function TreeDesc(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function d_code(t){return t<256?_dist_code[t]:_dist_code[256+(t>>>7)]}function put_short(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function send_bits(t,e,r){t.bi_valid>Buf_size-r?(t.bi_buf|=e<<t.bi_valid&65535,put_short(t,t.bi_buf),t.bi_buf=e>>Buf_size-t.bi_valid,t.bi_valid+=r-Buf_size):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function send_code(t,e,r){send_bits(t,r[2*e],r[2*e+1])}function bi_reverse(t,e){var r=0;do{r|=1&t,t>>>=1,r<<=1}while(--e>0);return r>>>1}function bi_flush(t){16===t.bi_valid?(put_short(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function gen_bitlen(t,e){var r,i,n,a,o,s,h=e.dyn_tree,l=e.max_code,u=e.stat_desc.static_tree,f=e.stat_desc.has_stree,c=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,m=e.stat_desc.max_length,g=0;for(a=0;a<=MAX_BITS;a++)t.bl_count[a]=0;for(h[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<HEAP_SIZE;r++)(a=h[2*h[2*(i=t.heap[r])+1]+1]+1)>m&&(a=m,g++),h[2*i+1]=a,i>l||(t.bl_count[a]++,o=0,i>=d&&(o=c[i-d]),s=h[2*i],t.opt_len+=s*(a+o),f&&(t.static_len+=s*(u[2*i+1]+o)));if(0!==g){do{for(a=m-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[m]--,g-=2}while(g>0);for(a=m;0!==a;a--)for(i=t.bl_count[a];0!==i;)(n=t.heap[--r])>l||(h[2*n+1]!==a&&(t.opt_len+=(a-h[2*n+1])*h[2*n],h[2*n+1]=a),i--)}}function gen_codes(t,e,r){var i,n,a=new Array(MAX_BITS+1),o=0;for(i=1;i<=MAX_BITS;i++)a[i]=o=o+r[i-1]<<1;for(n=0;n<=e;n++){var s=t[2*n+1];0!==s&&(t[2*n]=bi_reverse(a[s]++,s))}}function tr_static_init(){var t,e,r,i,n,a=new Array(MAX_BITS+1);for(r=0,i=0;i<LENGTH_CODES-1;i++)for(base_length[i]=r,t=0;t<1<<extra_lbits[i];t++)_length_code[r++]=i;for(_length_code[r-1]=i,n=0,i=0;i<16;i++)for(base_dist[i]=n,t=0;t<1<<extra_dbits[i];t++)_dist_code[n++]=i;for(n>>=7;i<D_CODES;i++)for(base_dist[i]=n<<7,t=0;t<1<<extra_dbits[i]-7;t++)_dist_code[256+n++]=i;for(e=0;e<=MAX_BITS;e++)a[e]=0;for(t=0;t<=143;)static_ltree[2*t+1]=8,t++,a[8]++;for(;t<=255;)static_ltree[2*t+1]=9,t++,a[9]++;for(;t<=279;)static_ltree[2*t+1]=7,t++,a[7]++;for(;t<=287;)static_ltree[2*t+1]=8,t++,a[8]++;for(gen_codes(static_ltree,L_CODES+1,a),t=0;t<D_CODES;t++)static_dtree[2*t+1]=5,static_dtree[2*t]=bi_reverse(t,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}function init_block(t){var e;for(e=0;e<L_CODES;e++)t.dyn_ltree[2*e]=0;for(e=0;e<D_CODES;e++)t.dyn_dtree[2*e]=0;for(e=0;e<BL_CODES;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*END_BLOCK]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function bi_windup(t){t.bi_valid>8?put_short(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function copy_block(t,e,r,i){bi_windup(t),i&&(put_short(t,r),put_short(t,~r)),common.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}function smaller(t,e,r,i){var n=2*e,a=2*r;return t[n]<t[a]||t[n]===t[a]&&i[e]<=i[r]}function pqdownheap(t,e,r){for(var i=t.heap[r],n=r<<1;n<=t.heap_len&&(n<t.heap_len&&smaller(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!smaller(e,i,t.heap[n],t.depth));)t.heap[r]=t.heap[n],r=n,n<<=1;t.heap[r]=i}function compress_block(t,e,r){var i,n,a,o,s=0;if(0!==t.last_lit)do{i=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],n=t.pending_buf[t.l_buf+s],s++,0===i?send_code(t,n,e):(send_code(t,(a=_length_code[n])+LITERALS+1,e),0!==(o=extra_lbits[a])&&send_bits(t,n-=base_length[a],o),send_code(t,a=d_code(--i),r),0!==(o=extra_dbits[a])&&send_bits(t,i-=base_dist[a],o))}while(s<t.last_lit);send_code(t,END_BLOCK,e)}function build_tree(t,e){var r,i,n,a=e.dyn_tree,o=e.stat_desc.static_tree,s=e.stat_desc.has_stree,h=e.stat_desc.elems,l=-1;for(t.heap_len=0,t.heap_max=HEAP_SIZE,r=0;r<h;r++)0!==a[2*r]?(t.heap[++t.heap_len]=l=r,t.depth[r]=0):a[2*r+1]=0;for(;t.heap_len<2;)a[2*(n=t.heap[++t.heap_len]=l<2?++l:0)]=1,t.depth[n]=0,t.opt_len--,s&&(t.static_len-=o[2*n+1]);for(e.max_code=l,r=t.heap_len>>1;r>=1;r--)pqdownheap(t,a,r);n=h;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],pqdownheap(t,a,1),i=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=i,a[2*n]=a[2*r]+a[2*i],t.depth[n]=(t.depth[r]>=t.depth[i]?t.depth[r]:t.depth[i])+1,a[2*r+1]=a[2*i+1]=n,t.heap[1]=n++,pqdownheap(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],gen_bitlen(t,e),gen_codes(a,l,t.bl_count)}function scan_tree(t,e,r){var i,n,a=-1,o=e[1],s=0,h=7,l=4;for(0===o&&(h=138,l=3),e[2*(r+1)+1]=65535,i=0;i<=r;i++)n=o,o=e[2*(i+1)+1],++s<h&&n===o||(s<l?t.bl_tree[2*n]+=s:0!==n?(n!==a&&t.bl_tree[2*n]++,t.bl_tree[2*REP_3_6]++):s<=10?t.bl_tree[2*REPZ_3_10]++:t.bl_tree[2*REPZ_11_138]++,s=0,a=n,0===o?(h=138,l=3):n===o?(h=6,l=3):(h=7,l=4))}function send_tree(t,e,r){var i,n,a=-1,o=e[1],s=0,h=7,l=4;for(0===o&&(h=138,l=3),i=0;i<=r;i++)if(n=o,o=e[2*(i+1)+1],!(++s<h&&n===o)){if(s<l)do{send_code(t,n,t.bl_tree)}while(0!=--s);else 0!==n?(n!==a&&(send_code(t,n,t.bl_tree),s--),send_code(t,REP_3_6,t.bl_tree),send_bits(t,s-3,2)):s<=10?(send_code(t,REPZ_3_10,t.bl_tree),send_bits(t,s-3,3)):(send_code(t,REPZ_11_138,t.bl_tree),send_bits(t,s-11,7));s=0,a=n,0===o?(h=138,l=3):n===o?(h=6,l=3):(h=7,l=4)}}function build_bl_tree(t){var e;for(scan_tree(t,t.dyn_ltree,t.l_desc.max_code),scan_tree(t,t.dyn_dtree,t.d_desc.max_code),build_tree(t,t.bl_desc),e=BL_CODES-1;e>=3&&0===t.bl_tree[2*bl_order[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function send_all_trees(t,e,r,i){var n;for(send_bits(t,e-257,5),send_bits(t,r-1,5),send_bits(t,i-4,4),n=0;n<i;n++)send_bits(t,t.bl_tree[2*bl_order[n]+1],3);send_tree(t,t.dyn_ltree,e-1),send_tree(t,t.dyn_dtree,r-1)}function detect_data_type(t){var e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return Z_BINARY;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return Z_TEXT;for(e=32;e<LITERALS;e++)if(0!==t.dyn_ltree[2*e])return Z_TEXT;return Z_BINARY}zero(base_dist);var static_init_done=!1;function _tr_init(t){static_init_done||(tr_static_init(),static_init_done=!0),t.l_desc=new TreeDesc(t.dyn_ltree,static_l_desc),t.d_desc=new TreeDesc(t.dyn_dtree,static_d_desc),t.bl_desc=new TreeDesc(t.bl_tree,static_bl_desc),t.bi_buf=0,t.bi_valid=0,init_block(t)}function _tr_stored_block(t,e,r,i){send_bits(t,(STORED_BLOCK<<1)+(i?1:0),3),copy_block(t,e,r,!0)}function _tr_align(t){send_bits(t,STATIC_TREES<<1,3),send_code(t,END_BLOCK,static_ltree),bi_flush(t)}function _tr_flush_block(t,e,r,i){var n,a,o=0;t.level>0?(t.strm.data_type===Z_UNKNOWN&&(t.strm.data_type=detect_data_type(t)),build_tree(t,t.l_desc),build_tree(t,t.d_desc),o=build_bl_tree(t),n=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=n&&(n=a)):n=a=r+5,r+4<=n&&-1!==e?_tr_stored_block(t,e,r,i):t.strategy===Z_FIXED||a===n?(send_bits(t,(STATIC_TREES<<1)+(i?1:0),3),compress_block(t,static_ltree,static_dtree)):(send_bits(t,(DYN_TREES<<1)+(i?1:0),3),send_all_trees(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),compress_block(t,t.dyn_ltree,t.dyn_dtree)),init_block(t),i&&bi_windup(t)}function _tr_tally(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(_length_code[r]+LITERALS+1)]++,t.dyn_dtree[2*d_code(e)]++),t.last_lit===t.lit_bufsize-1}var _tr_init_1=_tr_init,_tr_stored_block_1=_tr_stored_block,_tr_flush_block_1=_tr_flush_block,_tr_tally_1=_tr_tally,_tr_align_1=_tr_align,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};function adler32(t,e,r,i){for(var n=65535&t|0,a=t>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(n=n+e[i++]|0)|0}while(--o);n%=65521,a%=65521}return n|a<<16|0}var adler32_1=adler32;function makeTable(){for(var t,e=[],r=0;r<256;r++){t=r;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}var crcTable=makeTable();function crc32(t,e,r,i){var n=crcTable,a=i+r;t^=-1;for(var o=i;o<a;o++)t=t>>>8^n[255&(t^e[o])];return-1^t}var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_FULL_FLUSH=3,Z_FINISH=4,Z_BLOCK=5,Z_OK=0,Z_STREAM_END=1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_BUF_ERROR=-5,Z_DEFAULT_COMPRESSION=-1,Z_FILTERED=1,Z_HUFFMAN_ONLY=2,Z_RLE=3,Z_FIXED$1=4,Z_DEFAULT_STRATEGY=0,Z_UNKNOWN$1=2,Z_DEFLATED=8,MAX_MEM_LEVEL=9,MAX_WBITS=15,DEF_MEM_LEVEL=8,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,MIN_MATCH$1=3,MAX_MATCH$1=258,MIN_LOOKAHEAD=MAX_MATCH$1+MIN_MATCH$1+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,configuration_table;function err(t,e){return t.msg=messages[e],e}function rank(t){return(t<<1)-(t>4?9:0)}function zero$1(t){for(var e=t.length;--e>=0;)t[e]=0}function flush_pending(t){var e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(common.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function flush_block_only(t,e){trees._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,flush_pending(t.strm)}function put_byte(t,e){t.pending_buf[t.pending++]=e}function putShortMSB(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function read_buf(t,e,r,i){var n=t.avail_in;return n>i&&(n=i),0===n?0:(t.avail_in-=n,common.arraySet(e,t.input,t.next_in,n,r),1===t.state.wrap?t.adler=adler32_1(t.adler,e,n,r):2===t.state.wrap&&(t.adler=crc32_1(t.adler,e,n,r)),t.next_in+=n,t.total_in+=n,n)}function longest_match(t,e){var r,i,n=t.max_chain_length,a=t.strstart,o=t.prev_length,s=t.nice_match,h=t.strstart>t.w_size-MIN_LOOKAHEAD?t.strstart-(t.w_size-MIN_LOOKAHEAD):0,l=t.window,u=t.w_mask,f=t.prev,c=t.strstart+MAX_MATCH$1,d=l[a+o-1],m=l[a+o];t.prev_length>=t.good_match&&(n>>=2),s>t.lookahead&&(s=t.lookahead);do{if(l[(r=e)+o]===m&&l[r+o-1]===d&&l[r]===l[a]&&l[++r]===l[a+1]){a+=2,r++;do{}while(l[++a]===l[++r]&&l[++a]===l[++r]&&l[++a]===l[++r]&&l[++a]===l[++r]&&l[++a]===l[++r]&&l[++a]===l[++r]&&l[++a]===l[++r]&&l[++a]===l[++r]&&a<c);if(i=MAX_MATCH$1-(c-a),a=c-MAX_MATCH$1,i>o){if(t.match_start=e,o=i,i>=s)break;d=l[a+o-1],m=l[a+o]}}}while((e=f[e&u])>h&&0!=--n);return o<=t.lookahead?o:t.lookahead}function fill_window(t){var e,r,i,n,a,o=t.w_size;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=o+(o-MIN_LOOKAHEAD)){common.arraySet(t.window,t.window,o,o,0),t.match_start-=o,t.strstart-=o,t.block_start-=o,e=r=t.hash_size;do{i=t.head[--e],t.head[e]=i>=o?i-o:0}while(--r);e=r=o;do{i=t.prev[--e],t.prev[e]=i>=o?i-o:0}while(--r);n+=o}if(0===t.strm.avail_in)break;if(r=read_buf(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=r,t.lookahead+t.insert>=MIN_MATCH$1)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+MIN_MATCH$1-1])&t.hash_mask,t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<MIN_MATCH$1)););}while(t.lookahead<MIN_LOOKAHEAD&&0!==t.strm.avail_in)}function deflate_stored(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(fill_window(t),0===t.lookahead&&e===Z_NO_FLUSH)return BS_NEED_MORE;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+r;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,flush_block_only(t,!1),0===t.strm.avail_out))return BS_NEED_MORE;if(t.strstart-t.block_start>=t.w_size-MIN_LOOKAHEAD&&(flush_block_only(t,!1),0===t.strm.avail_out))return BS_NEED_MORE}return t.insert=0,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):(t.strstart>t.block_start&&(flush_block_only(t,!1),t.strm.avail_out),BS_NEED_MORE)}function deflate_fast(t,e){for(var r,i;;){if(t.lookahead<MIN_LOOKAHEAD){if(fill_window(t),t.lookahead<MIN_LOOKAHEAD&&e===Z_NO_FLUSH)return BS_NEED_MORE;if(0===t.lookahead)break}if(r=0,t.lookahead>=MIN_MATCH$1&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+MIN_MATCH$1-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-MIN_LOOKAHEAD&&(t.match_length=longest_match(t,r)),t.match_length>=MIN_MATCH$1)if(i=trees._tr_tally(t,t.strstart-t.match_start,t.match_length-MIN_MATCH$1),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=MIN_MATCH$1){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+MIN_MATCH$1-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=trees._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(flush_block_only(t,!1),0===t.strm.avail_out))return BS_NEED_MORE}return t.insert=t.strstart<MIN_MATCH$1-1?t.strstart:MIN_MATCH$1-1,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_slow(t,e){for(var r,i,n;;){if(t.lookahead<MIN_LOOKAHEAD){if(fill_window(t),t.lookahead<MIN_LOOKAHEAD&&e===Z_NO_FLUSH)return BS_NEED_MORE;if(0===t.lookahead)break}if(r=0,t.lookahead>=MIN_MATCH$1&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+MIN_MATCH$1-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=MIN_MATCH$1-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-MIN_LOOKAHEAD&&(t.match_length=longest_match(t,r),t.match_length<=5&&(t.strategy===Z_FILTERED||t.match_length===MIN_MATCH$1&&t.strstart-t.match_start>4096)&&(t.match_length=MIN_MATCH$1-1)),t.prev_length>=MIN_MATCH$1&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-MIN_MATCH$1,i=trees._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-MIN_MATCH$1),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+MIN_MATCH$1-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=MIN_MATCH$1-1,t.strstart++,i&&(flush_block_only(t,!1),0===t.strm.avail_out))return BS_NEED_MORE}else if(t.match_available){if((i=trees._tr_tally(t,0,t.window[t.strstart-1]))&&flush_block_only(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return BS_NEED_MORE}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=trees._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<MIN_MATCH$1-1?t.strstart:MIN_MATCH$1-1,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_rle(t,e){for(var r,i,n,a,o=t.window;;){if(t.lookahead<=MAX_MATCH$1){if(fill_window(t),t.lookahead<=MAX_MATCH$1&&e===Z_NO_FLUSH)return BS_NEED_MORE;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=MIN_MATCH$1&&t.strstart>0&&(i=o[n=t.strstart-1])===o[++n]&&i===o[++n]&&i===o[++n]){a=t.strstart+MAX_MATCH$1;do{}while(i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&n<a);t.match_length=MAX_MATCH$1-(a-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=MIN_MATCH$1?(r=trees._tr_tally(t,1,t.match_length-MIN_MATCH$1),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=trees._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(flush_block_only(t,!1),0===t.strm.avail_out))return BS_NEED_MORE}return t.insert=0,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_huff(t,e){for(var r;;){if(0===t.lookahead&&(fill_window(t),0===t.lookahead)){if(e===Z_NO_FLUSH)return BS_NEED_MORE;break}if(t.match_length=0,r=trees._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(flush_block_only(t,!1),0===t.strm.avail_out))return BS_NEED_MORE}return t.insert=0,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function Config(t,e,r,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=i,this.func=n}function lm_init(t){t.window_size=2*t.w_size,zero$1(t.head),t.max_lazy_match=configuration_table[t.level].max_lazy,t.good_match=configuration_table[t.level].good_length,t.nice_match=configuration_table[t.level].nice_length,t.max_chain_length=configuration_table[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=MIN_MATCH$1-1,t.match_available=0,t.ins_h=0}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new common.Buf16(2*HEAP_SIZE$1),this.dyn_dtree=new common.Buf16(2*(2*D_CODES$1+1)),this.bl_tree=new common.Buf16(2*(2*BL_CODES$1+1)),zero$1(this.dyn_ltree),zero$1(this.dyn_dtree),zero$1(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new common.Buf16(MAX_BITS$1+1),this.heap=new common.Buf16(2*L_CODES$1+1),zero$1(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new common.Buf16(2*L_CODES$1+1),zero$1(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=Z_UNKNOWN$1,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?INIT_STATE:BUSY_STATE,t.adler=2===e.wrap?0:1,e.last_flush=Z_NO_FLUSH,trees._tr_init(e),Z_OK):err(t,Z_STREAM_ERROR)}function deflateReset(t){var e=deflateResetKeep(t);return e===Z_OK&&lm_init(t.state),e}function deflateSetHeader(t,e){return t&&t.state?2!==t.state.wrap?Z_STREAM_ERROR:(t.state.gzhead=e,Z_OK):Z_STREAM_ERROR}function deflateInit2(t,e,r,i,n,a){if(!t)return Z_STREAM_ERROR;var o=1;if(e===Z_DEFAULT_COMPRESSION&&(e=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),n<1||n>MAX_MEM_LEVEL||r!==Z_DEFLATED||i<8||i>15||e<0||e>9||a<0||a>Z_FIXED$1)return err(t,Z_STREAM_ERROR);8===i&&(i=9);var s=new DeflateState;return t.state=s,s.strm=t,s.wrap=o,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+MIN_MATCH$1-1)/MIN_MATCH$1),s.window=new common.Buf8(2*s.w_size),s.head=new common.Buf16(s.hash_size),s.prev=new common.Buf16(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new common.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=e,s.strategy=a,s.method=r,deflateReset(t)}function deflateInit(t,e){return deflateInit2(t,e,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}function deflate(t,e){var r,i,n,a;if(!t||!t.state||e>Z_BLOCK||e<0)return t?err(t,Z_STREAM_ERROR):Z_STREAM_ERROR;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===FINISH_STATE&&e!==Z_FINISH)return err(t,0===t.avail_out?Z_BUF_ERROR:Z_STREAM_ERROR);if(i.strm=t,r=i.last_flush,i.last_flush=e,i.status===INIT_STATE)if(2===i.wrap)t.adler=0,put_byte(i,31),put_byte(i,139),put_byte(i,8),i.gzhead?(put_byte(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),put_byte(i,255&i.gzhead.time),put_byte(i,i.gzhead.time>>8&255),put_byte(i,i.gzhead.time>>16&255),put_byte(i,i.gzhead.time>>24&255),put_byte(i,9===i.level?2:i.strategy>=Z_HUFFMAN_ONLY||i.level<2?4:0),put_byte(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(put_byte(i,255&i.gzhead.extra.length),put_byte(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=EXTRA_STATE):(put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,9===i.level?2:i.strategy>=Z_HUFFMAN_ONLY||i.level<2?4:0),put_byte(i,OS_CODE),i.status=BUSY_STATE);else{var o=Z_DEFLATED+(i.w_bits-8<<4)<<8;o|=(i.strategy>=Z_HUFFMAN_ONLY||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(o|=PRESET_DICT),o+=31-o%31,i.status=BUSY_STATE,putShortMSB(i,o),0!==i.strstart&&(putShortMSB(i,t.adler>>>16),putShortMSB(i,65535&t.adler)),t.adler=1}if(i.status===EXTRA_STATE)if(i.gzhead.extra){for(n=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>n&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending-n,n)),flush_pending(t),n=i.pending,i.pending!==i.pending_buf_size));)put_byte(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>n&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending-n,n)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=NAME_STATE)}else i.status=NAME_STATE;if(i.status===NAME_STATE)if(i.gzhead.name){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending-n,n)),flush_pending(t),n=i.pending,i.pending===i.pending_buf_size)){a=1;break}a=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,put_byte(i,a)}while(0!==a);i.gzhead.hcrc&&i.pending>n&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending-n,n)),0===a&&(i.gzindex=0,i.status=COMMENT_STATE)}else i.status=COMMENT_STATE;if(i.status===COMMENT_STATE)if(i.gzhead.comment){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending-n,n)),flush_pending(t),n=i.pending,i.pending===i.pending_buf_size)){a=1;break}a=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,put_byte(i,a)}while(0!==a);i.gzhead.hcrc&&i.pending>n&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending-n,n)),0===a&&(i.status=HCRC_STATE)}else i.status=HCRC_STATE;if(i.status===HCRC_STATE&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&flush_pending(t),i.pending+2<=i.pending_buf_size&&(put_byte(i,255&t.adler),put_byte(i,t.adler>>8&255),t.adler=0,i.status=BUSY_STATE)):i.status=BUSY_STATE),0!==i.pending){if(flush_pending(t),0===t.avail_out)return i.last_flush=-1,Z_OK}else if(0===t.avail_in&&rank(e)<=rank(r)&&e!==Z_FINISH)return err(t,Z_BUF_ERROR);if(i.status===FINISH_STATE&&0!==t.avail_in)return err(t,Z_BUF_ERROR);if(0!==t.avail_in||0!==i.lookahead||e!==Z_NO_FLUSH&&i.status!==FINISH_STATE){var s=i.strategy===Z_HUFFMAN_ONLY?deflate_huff(i,e):i.strategy===Z_RLE?deflate_rle(i,e):configuration_table[i.level].func(i,e);if(s!==BS_FINISH_STARTED&&s!==BS_FINISH_DONE||(i.status=FINISH_STATE),s===BS_NEED_MORE||s===BS_FINISH_STARTED)return 0===t.avail_out&&(i.last_flush=-1),Z_OK;if(s===BS_BLOCK_DONE&&(e===Z_PARTIAL_FLUSH?trees._tr_align(i):e!==Z_BLOCK&&(trees._tr_stored_block(i,0,0,!1),e===Z_FULL_FLUSH&&(zero$1(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),flush_pending(t),0===t.avail_out))return i.last_flush=-1,Z_OK}return e!==Z_FINISH?Z_OK:i.wrap<=0?Z_STREAM_END:(2===i.wrap?(put_byte(i,255&t.adler),put_byte(i,t.adler>>8&255),put_byte(i,t.adler>>16&255),put_byte(i,t.adler>>24&255),put_byte(i,255&t.total_in),put_byte(i,t.total_in>>8&255),put_byte(i,t.total_in>>16&255),put_byte(i,t.total_in>>24&255)):(putShortMSB(i,t.adler>>>16),putShortMSB(i,65535&t.adler)),flush_pending(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?Z_OK:Z_STREAM_END)}function deflateEnd(t){var e;return t&&t.state?(e=t.state.status)!==INIT_STATE&&e!==EXTRA_STATE&&e!==NAME_STATE&&e!==COMMENT_STATE&&e!==HCRC_STATE&&e!==BUSY_STATE&&e!==FINISH_STATE?err(t,Z_STREAM_ERROR):(t.state=null,e===BUSY_STATE?err(t,Z_DATA_ERROR):Z_OK):Z_STREAM_ERROR}function deflateSetDictionary(t,e){var r,i,n,a,o,s,h,l,u=e.length;if(!t||!t.state)return Z_STREAM_ERROR;if(2===(a=(r=t.state).wrap)||1===a&&r.status!==INIT_STATE||r.lookahead)return Z_STREAM_ERROR;for(1===a&&(t.adler=adler32_1(t.adler,e,u,0)),r.wrap=0,u>=r.w_size&&(0===a&&(zero$1(r.head),r.strstart=0,r.block_start=0,r.insert=0),l=new common.Buf8(r.w_size),common.arraySet(l,e,u-r.w_size,r.w_size,0),e=l,u=r.w_size),o=t.avail_in,s=t.next_in,h=t.input,t.avail_in=u,t.next_in=0,t.input=e,fill_window(r);r.lookahead>=MIN_MATCH$1;){i=r.strstart,n=r.lookahead-(MIN_MATCH$1-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+MIN_MATCH$1-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++}while(--n);r.strstart=i,r.lookahead=MIN_MATCH$1-1,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=MIN_MATCH$1-1,r.match_available=0,t.next_in=s,t.input=h,t.avail_in=o,r.wrap=a,Z_OK}configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2=deflate,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo:deflateInfo},STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(t){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){STR_APPLY_UIA_OK=!1}for(var _utf8len=new common.Buf8(256),q=0;q<256;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=function(t){var e,r,i,n,a,o=t.length,s=0;for(n=0;n<o;n++)55296==(64512&(r=t.charCodeAt(n)))&&n+1<o&&56320==(64512&(i=t.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),s+=r<128?1:r<2048?2:r<65536?3:4;for(e=new common.Buf8(s),a=0,n=0;a<s;n++)55296==(64512&(r=t.charCodeAt(n)))&&n+1<o&&56320==(64512&(i=t.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),r<128?e[a++]=r:r<2048?(e[a++]=192|r>>>6,e[a++]=128|63&r):r<65536?(e[a++]=224|r>>>12,e[a++]=128|r>>>6&63,e[a++]=128|63&r):(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63,e[a++]=128|r>>>6&63,e[a++]=128|63&r);return e};function buf2binstring(t,e){if(e<65534&&(t.subarray&&STR_APPLY_UIA_OK||!t.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,common.shrinkBuf(t,e));for(var r="",i=0;i<e;i++)r+=String.fromCharCode(t[i]);return r}var buf2binstring_1=function(t){return buf2binstring(t,t.length)},binstring2buf=function(t){for(var e=new common.Buf8(t.length),r=0,i=e.length;r<i;r++)e[r]=t.charCodeAt(r);return e},buf2string=function(t,e){var r,i,n,a,o=e||t.length,s=new Array(2*o);for(i=0,r=0;r<o;)if((n=t[r++])<128)s[i++]=n;else if((a=_utf8len[n])>4)s[i++]=65533,r+=a-1;else{for(n&=2===a?31:3===a?15:7;a>1&&r<o;)n=n<<6|63&t[r++],a--;a>1?s[i++]=65533:n<65536?s[i++]=n:(n-=65536,s[i++]=55296|n>>10&1023,s[i++]=56320|1023&n)}return buf2binstring(s,i)},utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;r>=0&&128==(192&t[r]);)r--;return r<0||0===r?e:r+_utf8len[t[r]]>e?r:e},strings={string2buf:string2buf,buf2binstring:buf2binstring_1,binstring2buf:binstring2buf,buf2string:buf2string,utf8border:utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream,toString=Object.prototype.toString,Z_NO_FLUSH$1=0,Z_FINISH$1=4,Z_OK$1=0,Z_STREAM_END$1=1,Z_SYNC_FLUSH=2,Z_DEFAULT_COMPRESSION$1=-1,Z_DEFAULT_STRATEGY$1=0,Z_DEFLATED$1=8;function Deflate(t){if(!(this instanceof Deflate))return new Deflate(t);this.options=common.assign({level:Z_DEFAULT_COMPRESSION$1,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY$1,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var r=deflate_1.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==Z_OK$1)throw new Error(messages[r]);if(e.header&&deflate_1.deflateSetHeader(this.strm,e.header),e.dictionary){var i;if(i="string"==typeof e.dictionary?strings.string2buf(e.dictionary):"[object ArrayBuffer]"===toString.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(r=deflate_1.deflateSetDictionary(this.strm,i))!==Z_OK$1)throw new Error(messages[r]);this._dict_set=!0}}function deflate$1(t,e){var r=new Deflate(e);if(r.push(t,!0),r.err)throw r.msg||messages[r.err];return r.result}function deflateRaw(t,e){return(e=e||{}).raw=!0,deflate$1(t,e)}function gzip(t,e){return(e=e||{}).gzip=!0,deflate$1(t,e)}Deflate.prototype.push=function(t,e){var r,i,n=this.strm,a=this.options.chunkSize;if(this.ended)return!1;i=e===~~e?e:!0===e?Z_FINISH$1:Z_NO_FLUSH$1,"string"==typeof t?n.input=strings.string2buf(t):"[object ArrayBuffer]"===toString.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new common.Buf8(a),n.next_out=0,n.avail_out=a),(r=deflate_1.deflate(n,i))!==Z_STREAM_END$1&&r!==Z_OK$1)return this.onEnd(r),this.ended=!0,!1;0!==n.avail_out&&(0!==n.avail_in||i!==Z_FINISH$1&&i!==Z_SYNC_FLUSH)||("string"===this.options.to?this.onData(strings.buf2binstring(common.shrinkBuf(n.output,n.next_out))):this.onData(common.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||0===n.avail_out)&&r!==Z_STREAM_END$1);return i===Z_FINISH$1?(r=deflate_1.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Z_OK$1):i!==Z_SYNC_FLUSH||(this.onEnd(Z_OK$1),n.avail_out=0,!0)},Deflate.prototype.onData=function(t){this.chunks.push(t)},Deflate.prototype.onEnd=function(t){t===Z_OK$1&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Deflate_1=Deflate,deflate_2$1=deflate$1,deflateRaw_1=deflateRaw,gzip_1=gzip,deflate_1$1={Deflate:Deflate_1,deflate:deflate_2$1,deflateRaw:deflateRaw_1,gzip:gzip_1},BAD=30,TYPE=12,inffast=function(t,e){var r,i,n,a,o,s,h,l,u,f,c,d,m,g,p,w,v,_,b,y,M,x,E,A,k;r=t.state,i=t.next_in,A=t.input,n=i+(t.avail_in-5),a=t.next_out,k=t.output,o=a-(e-t.avail_out),s=a+(t.avail_out-257),h=r.dmax,l=r.wsize,u=r.whave,f=r.wnext,c=r.window,d=r.hold,m=r.bits,g=r.lencode,p=r.distcode,w=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;t:do{m<15&&(d+=A[i++]<<m,m+=8,d+=A[i++]<<m,m+=8),_=g[d&w];e:for(;;){if(d>>>=b=_>>>24,m-=b,0===(b=_>>>16&255))k[a++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=g[(65535&_)+(d&(1<<b)-1)];continue e}if(32&b){r.mode=TYPE;break t}t.msg="invalid literal/length code",r.mode=BAD;break t}y=65535&_,(b&=15)&&(m<b&&(d+=A[i++]<<m,m+=8),y+=d&(1<<b)-1,d>>>=b,m-=b),m<15&&(d+=A[i++]<<m,m+=8,d+=A[i++]<<m,m+=8),_=p[d&v];r:for(;;){if(d>>>=b=_>>>24,m-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=p[(65535&_)+(d&(1<<b)-1)];continue r}t.msg="invalid distance code",r.mode=BAD;break t}if(M=65535&_,m<(b&=15)&&(d+=A[i++]<<m,(m+=8)<b&&(d+=A[i++]<<m,m+=8)),(M+=d&(1<<b)-1)>h){t.msg="invalid distance too far back",r.mode=BAD;break t}if(d>>>=b,m-=b,M>(b=a-o)){if((b=M-b)>u&&r.sane){t.msg="invalid distance too far back",r.mode=BAD;break t}if(x=0,E=c,0===f){if(x+=l-b,b<y){y-=b;do{k[a++]=c[x++]}while(--b);x=a-M,E=k}}else if(f<b){if(x+=l+f-b,(b-=f)<y){y-=b;do{k[a++]=c[x++]}while(--b);if(x=0,f<y){y-=b=f;do{k[a++]=c[x++]}while(--b);x=a-M,E=k}}}else if(x+=f-b,b<y){y-=b;do{k[a++]=c[x++]}while(--b);x=a-M,E=k}for(;y>2;)k[a++]=E[x++],k[a++]=E[x++],k[a++]=E[x++],y-=3;y&&(k[a++]=E[x++],y>1&&(k[a++]=E[x++]))}else{x=a-M;do{k[a++]=k[x++],k[a++]=k[x++],k[a++]=k[x++],y-=3}while(y>2);y&&(k[a++]=k[x++],y>1&&(k[a++]=k[x++]))}break}}break}}while(i<n&&a<s);i-=y=m>>3,d&=(1<<(m-=y<<3))-1,t.next_in=i,t.next_out=a,t.avail_in=i<n?n-i+5:5-(i-n),t.avail_out=a<s?s-a+257:257-(a-s),r.hold=d,r.bits=m},MAXBITS=15,ENOUGH_LENS=852,ENOUGH_DISTS=592,CODES=0,LENS=1,DISTS=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],inftrees=function(t,e,r,i,n,a,o,s){var h,l,u,f,c,d,m,g,p,w=s.bits,v=0,_=0,b=0,y=0,M=0,x=0,E=0,A=0,k=0,S=0,I=null,D=0,T=new common.Buf16(MAXBITS+1),R=new common.Buf16(MAXBITS+1),B=null,C=0;for(v=0;v<=MAXBITS;v++)T[v]=0;for(_=0;_<i;_++)T[e[r+_]]++;for(M=w,y=MAXBITS;y>=1&&0===T[y];y--);if(M>y&&(M=y),0===y)return n[a++]=20971520,n[a++]=20971520,s.bits=1,0;for(b=1;b<y&&0===T[b];b++);for(M<b&&(M=b),A=1,v=1;v<=MAXBITS;v++)if(A<<=1,(A-=T[v])<0)return-1;if(A>0&&(t===CODES||1!==y))return-1;for(R[1]=0,v=1;v<MAXBITS;v++)R[v+1]=R[v]+T[v];for(_=0;_<i;_++)0!==e[r+_]&&(o[R[e[r+_]]++]=_);if(t===CODES?(I=B=o,d=19):t===LENS?(I=lbase,D-=257,B=lext,C-=257,d=256):(I=dbase,B=dext,d=-1),S=0,_=0,v=b,c=a,x=M,E=0,u=-1,f=(k=1<<M)-1,t===LENS&&k>ENOUGH_LENS||t===DISTS&&k>ENOUGH_DISTS)return 1;for(;;){m=v-E,o[_]<d?(g=0,p=o[_]):o[_]>d?(g=B[C+o[_]],p=I[D+o[_]]):(g=96,p=0),h=1<<v-E,b=l=1<<x;do{n[c+(S>>E)+(l-=h)]=m<<24|g<<16|p|0}while(0!==l);for(h=1<<v-1;S&h;)h>>=1;if(0!==h?(S&=h-1,S+=h):S=0,_++,0==--T[v]){if(v===y)break;v=e[r+o[_]]}if(v>M&&(S&f)!==u){for(0===E&&(E=M),c+=b,A=1<<(x=v-E);x+E<y&&!((A-=T[x+E])<=0);)x++,A<<=1;if(k+=1<<x,t===LENS&&k>ENOUGH_LENS||t===DISTS&&k>ENOUGH_DISTS)return 1;n[u=S&f]=M<<24|x<<16|c-a|0}}return 0!==S&&(n[c+S]=v-E<<24|64<<16|0),s.bits=M,0},CODES$1=0,LENS$1=1,DISTS$1=2,Z_FINISH$2=4,Z_BLOCK$1=5,Z_TREES=6,Z_OK$2=0,Z_STREAM_END$2=1,Z_NEED_DICT=2,Z_STREAM_ERROR$1=-2,Z_DATA_ERROR$1=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR$1=-5,Z_DEFLATED$2=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE$1=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD$1=30,MEM=31,SYNC=32,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,MAX_WBITS$1=15,DEF_WBITS=MAX_WBITS$1;function zswap32(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new common.Buf16(320),this.work=new common.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=HEAD,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new common.Buf32(ENOUGH_LENS$1),e.distcode=e.distdyn=new common.Buf32(ENOUGH_DISTS$1),e.sane=1,e.back=-1,Z_OK$2):Z_STREAM_ERROR$1}function inflateReset(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,inflateResetKeep(t)):Z_STREAM_ERROR$1}function inflateReset2(t,e){var r,i;return t&&t.state?(i=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Z_STREAM_ERROR$1:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=r,i.wbits=e,inflateReset(t))):Z_STREAM_ERROR$1}function inflateInit2(t,e){var r,i;return t?(i=new InflateState,t.state=i,i.window=null,(r=inflateReset2(t,e))!==Z_OK$2&&(t.state=null),r):Z_STREAM_ERROR$1}function inflateInit(t){return inflateInit2(t,DEF_WBITS)}var virgin=!0,lenfix,distfix;function fixedtables(t){if(virgin){var e;for(lenfix=new common.Buf32(512),distfix=new common.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(inftrees(LENS$1,t.lens,0,288,lenfix,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;inftrees(DISTS$1,t.lens,0,32,distfix,0,t.work,{bits:5}),virgin=!1}t.lencode=lenfix,t.lenbits=9,t.distcode=distfix,t.distbits=5}function updatewindow(t,e,r,i){var n,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new common.Buf8(a.wsize)),i>=a.wsize?(common.arraySet(a.window,e,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((n=a.wsize-a.wnext)>i&&(n=i),common.arraySet(a.window,e,r-i,n,a.wnext),(i-=n)?(common.arraySet(a.window,e,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0}function inflate(t,e){var r,i,n,a,o,s,h,l,u,f,c,d,m,g,p,w,v,_,b,y,M,x,E,A,k=0,S=new common.Buf8(4),I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return Z_STREAM_ERROR$1;(r=t.state).mode===TYPE$1&&(r.mode=TYPEDO),o=t.next_out,n=t.output,h=t.avail_out,a=t.next_in,i=t.input,s=t.avail_in,l=r.hold,u=r.bits,f=s,c=h,x=Z_OK$2;t:for(;;)switch(r.mode){case HEAD:if(0===r.wrap){r.mode=TYPEDO;break}for(;u<16;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}if(2&r.wrap&&35615===l){r.check=0,S[0]=255&l,S[1]=l>>>8&255,r.check=crc32_1(r.check,S,2,0),l=0,u=0,r.mode=FLAGS;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&l)<<8)+(l>>8))%31){t.msg="incorrect header check",r.mode=BAD$1;break}if((15&l)!==Z_DEFLATED$2){t.msg="unknown compression method",r.mode=BAD$1;break}if(u-=4,M=8+(15&(l>>>=4)),0===r.wbits)r.wbits=M;else if(M>r.wbits){t.msg="invalid window size",r.mode=BAD$1;break}r.dmax=1<<M,t.adler=r.check=1,r.mode=512&l?DICTID:TYPE$1,l=0,u=0;break;case FLAGS:for(;u<16;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}if(r.flags=l,(255&r.flags)!==Z_DEFLATED$2){t.msg="unknown compression method",r.mode=BAD$1;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=BAD$1;break}r.head&&(r.head.text=l>>8&1),512&r.flags&&(S[0]=255&l,S[1]=l>>>8&255,r.check=crc32_1(r.check,S,2,0)),l=0,u=0,r.mode=TIME;case TIME:for(;u<32;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}r.head&&(r.head.time=l),512&r.flags&&(S[0]=255&l,S[1]=l>>>8&255,S[2]=l>>>16&255,S[3]=l>>>24&255,r.check=crc32_1(r.check,S,4,0)),l=0,u=0,r.mode=OS;case OS:for(;u<16;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}r.head&&(r.head.xflags=255&l,r.head.os=l>>8),512&r.flags&&(S[0]=255&l,S[1]=l>>>8&255,r.check=crc32_1(r.check,S,2,0)),l=0,u=0,r.mode=EXLEN;case EXLEN:if(1024&r.flags){for(;u<16;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}r.length=l,r.head&&(r.head.extra_len=l),512&r.flags&&(S[0]=255&l,S[1]=l>>>8&255,r.check=crc32_1(r.check,S,2,0)),l=0,u=0}else r.head&&(r.head.extra=null);r.mode=EXTRA;case EXTRA:if(1024&r.flags&&((d=r.length)>s&&(d=s),d&&(r.head&&(M=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),common.arraySet(r.head.extra,i,a,d,M)),512&r.flags&&(r.check=crc32_1(r.check,i,d,a)),s-=d,a+=d,r.length-=d),r.length))break t;r.length=0,r.mode=NAME;case NAME:if(2048&r.flags){if(0===s)break t;d=0;do{M=i[a+d++],r.head&&M&&r.length<65536&&(r.head.name+=String.fromCharCode(M))}while(M&&d<s);if(512&r.flags&&(r.check=crc32_1(r.check,i,d,a)),s-=d,a+=d,M)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT;case COMMENT:if(4096&r.flags){if(0===s)break t;d=0;do{M=i[a+d++],r.head&&M&&r.length<65536&&(r.head.comment+=String.fromCharCode(M))}while(M&&d<s);if(512&r.flags&&(r.check=crc32_1(r.check,i,d,a)),s-=d,a+=d,M)break t}else r.head&&(r.head.comment=null);r.mode=HCRC;case HCRC:if(512&r.flags){for(;u<16;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}if(l!==(65535&r.check)){t.msg="header crc mismatch",r.mode=BAD$1;break}l=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=TYPE$1;break;case DICTID:for(;u<32;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}t.adler=r.check=zswap32(l),l=0,u=0,r.mode=DICT;case DICT:if(0===r.havedict)return t.next_out=o,t.avail_out=h,t.next_in=a,t.avail_in=s,r.hold=l,r.bits=u,Z_NEED_DICT;t.adler=r.check=1,r.mode=TYPE$1;case TYPE$1:if(e===Z_BLOCK$1||e===Z_TREES)break t;case TYPEDO:if(r.last){l>>>=7&u,u-=7&u,r.mode=CHECK;break}for(;u<3;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}switch(r.last=1&l,u-=1,3&(l>>>=1)){case 0:r.mode=STORED;break;case 1:if(fixedtables(r),r.mode=LEN_,e===Z_TREES){l>>>=2,u-=2;break t}break;case 2:r.mode=TABLE;break;case 3:t.msg="invalid block type",r.mode=BAD$1}l>>>=2,u-=2;break;case STORED:for(l>>>=7&u,u-=7&u;u<32;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}if((65535&l)!=(l>>>16^65535)){t.msg="invalid stored block lengths",r.mode=BAD$1;break}if(r.length=65535&l,l=0,u=0,r.mode=COPY_,e===Z_TREES)break t;case COPY_:r.mode=COPY;case COPY:if(d=r.length){if(d>s&&(d=s),d>h&&(d=h),0===d)break t;common.arraySet(n,i,a,d,o),s-=d,a+=d,h-=d,o+=d,r.length-=d;break}r.mode=TYPE$1;break;case TABLE:for(;u<14;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}if(r.nlen=257+(31&l),l>>>=5,u-=5,r.ndist=1+(31&l),l>>>=5,u-=5,r.ncode=4+(15&l),l>>>=4,u-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=BAD$1;break}r.have=0,r.mode=LENLENS;case LENLENS:for(;r.have<r.ncode;){for(;u<3;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}r.lens[I[r.have++]]=7&l,l>>>=3,u-=3}for(;r.have<19;)r.lens[I[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,E={bits:r.lenbits},x=inftrees(CODES$1,r.lens,0,19,r.lencode,0,r.work,E),r.lenbits=E.bits,x){t.msg="invalid code lengths set",r.mode=BAD$1;break}r.have=0,r.mode=CODELENS;case CODELENS:for(;r.have<r.nlen+r.ndist;){for(;w=(k=r.lencode[l&(1<<r.lenbits)-1])>>>16&255,v=65535&k,!((p=k>>>24)<=u);){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}if(v<16)l>>>=p,u-=p,r.lens[r.have++]=v;else{if(16===v){for(A=p+2;u<A;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}if(l>>>=p,u-=p,0===r.have){t.msg="invalid bit length repeat",r.mode=BAD$1;break}M=r.lens[r.have-1],d=3+(3&l),l>>>=2,u-=2}else if(17===v){for(A=p+3;u<A;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}u-=p,M=0,d=3+(7&(l>>>=p)),l>>>=3,u-=3}else{for(A=p+7;u<A;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}u-=p,M=0,d=11+(127&(l>>>=p)),l>>>=7,u-=7}if(r.have+d>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=BAD$1;break}for(;d--;)r.lens[r.have++]=M}}if(r.mode===BAD$1)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=BAD$1;break}if(r.lenbits=9,E={bits:r.lenbits},x=inftrees(LENS$1,r.lens,0,r.nlen,r.lencode,0,r.work,E),r.lenbits=E.bits,x){t.msg="invalid literal/lengths set",r.mode=BAD$1;break}if(r.distbits=6,r.distcode=r.distdyn,E={bits:r.distbits},x=inftrees(DISTS$1,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,E),r.distbits=E.bits,x){t.msg="invalid distances set",r.mode=BAD$1;break}if(r.mode=LEN_,e===Z_TREES)break t;case LEN_:r.mode=LEN;case LEN:if(s>=6&&h>=258){t.next_out=o,t.avail_out=h,t.next_in=a,t.avail_in=s,r.hold=l,r.bits=u,inffast(t,c),o=t.next_out,n=t.output,h=t.avail_out,a=t.next_in,i=t.input,s=t.avail_in,l=r.hold,u=r.bits,r.mode===TYPE$1&&(r.back=-1);break}for(r.back=0;w=(k=r.lencode[l&(1<<r.lenbits)-1])>>>16&255,v=65535&k,!((p=k>>>24)<=u);){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}if(w&&0==(240&w)){for(_=p,b=w,y=v;w=(k=r.lencode[y+((l&(1<<_+b)-1)>>_)])>>>16&255,v=65535&k,!(_+(p=k>>>24)<=u);){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}l>>>=_,u-=_,r.back+=_}if(l>>>=p,u-=p,r.back+=p,r.length=v,0===w){r.mode=LIT;break}if(32&w){r.back=-1,r.mode=TYPE$1;break}if(64&w){t.msg="invalid literal/length code",r.mode=BAD$1;break}r.extra=15&w,r.mode=LENEXT;case LENEXT:if(r.extra){for(A=r.extra;u<A;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST;case DIST:for(;w=(k=r.distcode[l&(1<<r.distbits)-1])>>>16&255,v=65535&k,!((p=k>>>24)<=u);){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}if(0==(240&w)){for(_=p,b=w,y=v;w=(k=r.distcode[y+((l&(1<<_+b)-1)>>_)])>>>16&255,v=65535&k,!(_+(p=k>>>24)<=u);){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}l>>>=_,u-=_,r.back+=_}if(l>>>=p,u-=p,r.back+=p,64&w){t.msg="invalid distance code",r.mode=BAD$1;break}r.offset=v,r.extra=15&w,r.mode=DISTEXT;case DISTEXT:if(r.extra){for(A=r.extra;u<A;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=BAD$1;break}r.mode=MATCH;case MATCH:if(0===h)break t;if(d=c-h,r.offset>d){if((d=r.offset-d)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=BAD$1;break}d>r.wnext?(d-=r.wnext,m=r.wsize-d):m=r.wnext-d,d>r.length&&(d=r.length),g=r.window}else g=n,m=o-r.offset,d=r.length;d>h&&(d=h),h-=d,r.length-=d;do{n[o++]=g[m++]}while(--d);0===r.length&&(r.mode=LEN);break;case LIT:if(0===h)break t;n[o++]=r.length,h--,r.mode=LEN;break;case CHECK:if(r.wrap){for(;u<32;){if(0===s)break t;s--,l|=i[a++]<<u,u+=8}if(c-=h,t.total_out+=c,r.total+=c,c&&(t.adler=r.check=r.flags?crc32_1(r.check,n,c,o-c):adler32_1(r.check,n,c,o-c)),c=h,(r.flags?l:zswap32(l))!==r.check){t.msg="incorrect data check",r.mode=BAD$1;break}l=0,u=0}r.mode=LENGTH;case LENGTH:if(r.wrap&&r.flags){for(;u<32;){if(0===s)break t;s--,l+=i[a++]<<u,u+=8}if(l!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=BAD$1;break}l=0,u=0}r.mode=DONE;case DONE:x=Z_STREAM_END$2;break t;case BAD$1:x=Z_DATA_ERROR$1;break t;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR$1}return t.next_out=o,t.avail_out=h,t.next_in=a,t.avail_in=s,r.hold=l,r.bits=u,(r.wsize||c!==t.avail_out&&r.mode<BAD$1&&(r.mode<CHECK||e!==Z_FINISH$2))&&updatewindow(t,t.output,t.next_out,c-t.avail_out),f-=t.avail_in,c-=t.avail_out,t.total_in+=f,t.total_out+=c,r.total+=c,r.wrap&&c&&(t.adler=r.check=r.flags?crc32_1(r.check,n,c,t.next_out-c):adler32_1(r.check,n,c,t.next_out-c)),t.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE$1?128:0)+(r.mode===LEN_||r.mode===COPY_?256:0),(0===f&&0===c||e===Z_FINISH$2)&&x===Z_OK$2&&(x=Z_BUF_ERROR$1),x}function inflateEnd(t){if(!t||!t.state)return Z_STREAM_ERROR$1;var e=t.state;return e.window&&(e.window=null),t.state=null,Z_OK$2}function inflateGetHeader(t,e){var r;return t&&t.state?0==(2&(r=t.state).wrap)?Z_STREAM_ERROR$1:(r.head=e,e.done=!1,Z_OK$2):Z_STREAM_ERROR$1}function inflateSetDictionary(t,e){var r,i=e.length;return t&&t.state?0!==(r=t.state).wrap&&r.mode!==DICT?Z_STREAM_ERROR$1:r.mode===DICT&&adler32_1(1,e,i,0)!==r.check?Z_DATA_ERROR$1:updatewindow(t,e,i,i)?(r.mode=MEM,Z_MEM_ERROR):(r.havedict=1,Z_OK$2):Z_STREAM_ERROR$1}var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2=inflate,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo:inflateInfo},constants$1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader,toString$1=Object.prototype.toString;function Inflate(t){if(!(this instanceof Inflate))return new Inflate(t);this.options=common.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var r=inflate_1.inflateInit2(this.strm,e.windowBits);if(r!==constants$1.Z_OK)throw new Error(messages[r]);if(this.header=new gzheader,inflate_1.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=strings.string2buf(e.dictionary):"[object ArrayBuffer]"===toString$1.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=inflate_1.inflateSetDictionary(this.strm,e.dictionary))!==constants$1.Z_OK))throw new Error(messages[r])}function inflate$1(t,e){var r=new Inflate(e);if(r.push(t,!0),r.err)throw r.msg||messages[r.err];return r.result}function inflateRaw(t,e){return(e=e||{}).raw=!0,inflate$1(t,e)}Inflate.prototype.push=function(t,e){var r,i,n,a,o,s=this.strm,h=this.options.chunkSize,l=this.options.dictionary,u=!1;if(this.ended)return!1;i=e===~~e?e:!0===e?constants$1.Z_FINISH:constants$1.Z_NO_FLUSH,"string"==typeof t?s.input=strings.binstring2buf(t):"[object ArrayBuffer]"===toString$1.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new common.Buf8(h),s.next_out=0,s.avail_out=h),(r=inflate_1.inflate(s,constants$1.Z_NO_FLUSH))===constants$1.Z_NEED_DICT&&l&&(r=inflate_1.inflateSetDictionary(this.strm,l)),r===constants$1.Z_BUF_ERROR&&!0===u&&(r=constants$1.Z_OK,u=!1),r!==constants$1.Z_STREAM_END&&r!==constants$1.Z_OK)return this.onEnd(r),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&r!==constants$1.Z_STREAM_END&&(0!==s.avail_in||i!==constants$1.Z_FINISH&&i!==constants$1.Z_SYNC_FLUSH)||("string"===this.options.to?(n=strings.utf8border(s.output,s.next_out),a=s.next_out-n,o=strings.buf2string(s.output,n),s.next_out=a,s.avail_out=h-a,a&&common.arraySet(s.output,s.output,n,a,0),this.onData(o)):this.onData(common.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(u=!0)}while((s.avail_in>0||0===s.avail_out)&&r!==constants$1.Z_STREAM_END);return r===constants$1.Z_STREAM_END&&(i=constants$1.Z_FINISH),i===constants$1.Z_FINISH?(r=inflate_1.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===constants$1.Z_OK):i!==constants$1.Z_SYNC_FLUSH||(this.onEnd(constants$1.Z_OK),s.avail_out=0,!0)},Inflate.prototype.onData=function(t){this.chunks.push(t)},Inflate.prototype.onEnd=function(t){t===constants$1.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Inflate_1=Inflate,inflate_2$1=inflate$1,inflateRaw_1=inflateRaw,ungzip=inflate$1,inflate_1$1={Inflate:Inflate_1,inflate:inflate_2$1,inflateRaw:inflateRaw_1,ungzip:ungzip},assign=common.assign,pako={};assign(pako,deflate_1$1,inflate_1$1,constants$1);var pako_1=pako,pako_2=pako_1.Inflate,pako_3=pako_1.deflate;const pngSignature=[137,80,78,71,13,10,26,10],crcTable$1=[];for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;crcTable$1[t]=e}const initialCrc=4294967295;function updateCrc(t,e,r){let i=t;for(let t=0;t<r;t++)i=crcTable$1[255&(i^e[t])]^i>>>8;return i}function crc(t,e){return(updateCrc(initialCrc,t,e)^initialCrc)>>>0}var ColorType,CompressionMethod,FilterMethod,InterlaceMethod;!function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.GREYSCALE=0]="GREYSCALE",t[t.TRUECOLOUR=2]="TRUECOLOUR",t[t.INDEXED_COLOUR=3]="INDEXED_COLOUR",t[t.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",t[t.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"}(ColorType||(ColorType={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.DEFLATE=0]="DEFLATE"}(CompressionMethod||(CompressionMethod={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.ADAPTIVE=0]="ADAPTIVE"}(FilterMethod||(FilterMethod={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.NO_INTERLACE=0]="NO_INTERLACE",t[t.ADAM7=1]="ADAM7"}(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=255===uint8[0];class PNGDecoder extends IOBuffer$1{constructor(t,e={}){super(t);const{checkCrc:r=!1}=e;this._checkCrc=r,this._inflator=new pako_2,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<pngSignature.length;t++)if(this.readUint8()!==pngSignature[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${pngSignature[t]}.`)}decodeChunk(){const t=this.readUint32(),e=this.readChars(4),r=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t)}if(this.offset-r!==t)throw new Error("Length mismatch while decoding chunk "+e);if(this._checkCrc){const r=this.readUint32(),i=t+4,n=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-i-4,i),i);if(n!==r)throw new Error(`CRC mismatch for chunk ${e}. Expected ${r}, found ${n}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=checkBitDepth(this.readUint8());const e=this.readUint8();let r;switch(this._colorType=e,e){case ColorType.GREYSCALE:r=1;break;case ColorType.TRUECOLOUR:r=3;break;case ColorType.INDEXED_COLOUR:r=1;break;case ColorType.GREYSCALE_ALPHA:r=2;break;case ColorType.TRUECOLOUR_ALPHA:r=4;break;default:throw new Error("Unknown color type: "+e)}if(this._png.channels=r,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error("Unsupported compression method: "+this._compressionMethod);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!=0)throw new RangeError("PLTE field length must be a multiple of 3. Got "+t);const e=t/3;this._hasPalette=!0;const r=[];this._palette=r;for(let t=0;t<e;t++)r.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t),!1),this.skip(t)}decodetRNS(t){if(3===this._colorType){if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let e=0;for(;e<t;e++){const t=this.readByte();this._palette[e].push(t)}for(;e<this._palette.length;e++)this._palette[e].push(255)}}decodetEXt(t){let e,r="";for(;(e=this.readChar())!==NULL;)r+=e;this._png.text[r]=this.readChars(t-r.length-1)}decodepHYs(){const t=this.readUint32(),e=this.readUint32(),r=this.readByte();this._png.resolution={x:t,y:e,unit:r}}decodeImage(){if(this._inflator.push(empty,!0),this._inflator.err)throw new Error("Error while decompressing the data: "+this._inflator.err);const t=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod!==InterlaceMethod.NO_INTERLACE)throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this.decodeInterlaceNull(t)}decodeInterlaceNull(t){const e=this._png.height,r=this._png.channels*this._png.depth/8,i=this._png.width*r,n=new Uint8Array(this._png.height*i);let a,o,s=empty,h=0;for(let l=0;l<e;l++){switch(a=t.subarray(h+1,h+1+i),o=n.subarray(l*i,(l+1)*i),t[h]){case 0:unfilterNone(a,o,i);break;case 1:unfilterSub(a,o,i,r);break;case 2:unfilterUp(a,o,s,i);break;case 3:unfilterAverage(a,o,s,i,r);break;case 4:unfilterPaeth(a,o,s,i,r);break;default:throw new Error("Unsupported filter: "+t[h])}s=o,h+=i+1}if(this._hasPalette&&(this._png.palette=this._palette),16===this._png.depth){const t=new Uint16Array(n.buffer);if(osIsLittleEndian)for(let e=0;e<t.length;e++)t[e]=swap16(t[e]);this._png.data=t}else this._png.data=n}}function unfilterNone(t,e,r){for(let i=0;i<r;i++)e[i]=t[i]}function unfilterSub(t,e,r,i){let n=0;for(;n<i;n++)e[n]=t[n];for(;n<r;n++)e[n]=t[n]+e[n-i]&255}function unfilterUp(t,e,r,i){let n=0;if(0===r.length)for(;n<i;n++)e[n]=t[n];else for(;n<i;n++)e[n]=t[n]+r[n]&255}function unfilterAverage(t,e,r,i,n){let a=0;if(0===r.length){for(;a<n;a++)e[a]=t[a];for(;a<i;a++)e[a]=t[a]+(e[a-n]>>1)&255}else{for(;a<n;a++)e[a]=t[a]+(r[a]>>1)&255;for(;a<i;a++)e[a]=t[a]+(e[a-n]+r[a]>>1)&255}}function unfilterPaeth(t,e,r,i,n){let a=0;if(0===r.length){for(;a<n;a++)e[a]=t[a];for(;a<i;a++)e[a]=t[a]+e[a-n]&255}else{for(;a<n;a++)e[a]=t[a]+r[a]&255;for(;a<i;a++)e[a]=t[a]+paethPredictor(e[a-n],r[a],r[a-n])&255}}function paethPredictor(t,e,r){const i=t+e-r,n=Math.abs(i-t),a=Math.abs(i-e),o=Math.abs(i-r);return n<=a&&n<=o?t:a<=o?e:r}function swap16(t){return(255&t)<<8|t>>8&255}function checkBitDepth(t){if(1!==t&&2!==t&&4!==t&&8!==t&&16!==t)throw new Error("invalid bit depth: "+t);return t}const defaultZlibOptions={level:3};class PNGEncoder extends IOBuffer$1{constructor(t,e={}){super(),this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,e.zlib),this._png=this._checkData(t),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),this.writeCrc(t.length+4)}encodeData(){const{width:t,height:e,channels:r,depth:i,data:n}=this._png,a=r*t,o=(new IOBuffer$1).setBigEndian();let s=0;for(let t=0;t<e;t++)if(o.writeByte(0),8===i)s=writeDataBytes(n,o,a,s);else{if(16!==i)throw new Error("unreachable");s=writeDataUint16(n,o,a,s)}const h=o.toArray(),l=pako_3(h,this._zlibOptions);this.encodeIDAT(l)}_checkData(t){const{colorType:e,channels:r,depth:i}=getColorType(t),n={width:checkInteger(t.width,"width"),height:checkInteger(t.height,"height"),channels:r,data:t.data,depth:i,text:{}};this._colorType=e;const a=n.width*n.height*r;if(n.data.length!==a)throw new RangeError(`wrong data size. Found ${n.data.length}, expected ${a}`);return n}writeCrc(t){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-t,t),t))}}function checkInteger(t,e){if(Number.isInteger(t)&&t>0)return t;throw new TypeError(e+" must be a positive integer")}function getColorType(t){const{channels:e=4,depth:r=8}=t;if(4!==e&&3!==e&&2!==e&&1!==e)throw new RangeError("unsupported number of channels: "+e);if(8!==r&&16!==r)throw new RangeError("unsupported bit depth: "+r);const i={channels:e,depth:r,colorType:ColorType.UNKNOWN};switch(e){case 4:i.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:i.colorType=ColorType.TRUECOLOUR;break;case 1:i.colorType=ColorType.GREYSCALE;break;case 2:i.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels: "+e)}return i}function writeDataBytes(t,e,r,i){for(let n=0;n<r;n++)e.writeByte(t[i++]);return i}function writeDataUint16(t,e,r,i){for(let n=0;n<r;n++)e.writeUint16(t[i++]);return i}var ResolutionUnitSpecifier;function decodePNG(t,e){return new PNGDecoder(t,e).decode()}function encodePNG(t,e){return new PNGEncoder(t,e).encode()}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"}(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));for(var encoder$1=createCommonjsModule((function(t){function e(t){var e,r,i,n,a,o=Math.floor,s=new Array(64),h=new Array(64),l=new Array(64),u=new Array(64),f=new Array(65535),c=new Array(65535),d=new Array(64),m=new Array(64),g=[],p=0,w=7,v=new Array(64),_=new Array(64),b=new Array(64),y=new Array(256),M=new Array(2048),x=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],E=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],A=[0,1,2,3,4,5,6,7,8,9,10,11],k=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],S=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],I=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],D=[0,1,2,3,4,5,6,7,8,9,10,11],T=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],R=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function B(t,e){for(var r=0,i=0,n=new Array,a=1;a<=16;a++){for(var o=1;o<=t[a];o++)n[e[i]]=[],n[e[i]][0]=r,n[e[i]][1]=a,i++,r++;r*=2}return n}function C(t){for(var e=t[0],r=t[1]-1;r>=0;)e&1<<r&&(p|=1<<w),r--,--w<0&&(255==p?(P(255),P(0)):P(p),w=7,p=0)}function P(t){g.push(t)}function O(t){P(t>>8&255),P(255&t)}function $(t,e,r,i,n){for(var a,o=n[0],s=n[240],h=function(t,e){var r,i,n,a,o,s,h,l,u,f,c=0;for(u=0;u<8;++u){r=t[c],i=t[c+1],n=t[c+2],a=t[c+3],o=t[c+4],s=t[c+5],h=t[c+6];var m=r+(l=t[c+7]),g=r-l,p=i+h,w=i-h,v=n+s,_=n-s,b=a+o,y=a-o,M=m+b,x=m-b,E=p+v,A=p-v;t[c]=M+E,t[c+4]=M-E;var k=.707106781*(A+x);t[c+2]=x+k,t[c+6]=x-k;var S=.382683433*((M=y+_)-(A=w+g)),I=.5411961*M+S,D=1.306562965*A+S,T=.707106781*(E=_+w),R=g+T,B=g-T;t[c+5]=B+I,t[c+3]=B-I,t[c+1]=R+D,t[c+7]=R-D,c+=8}for(c=0,u=0;u<8;++u){r=t[c],i=t[c+8],n=t[c+16],a=t[c+24],o=t[c+32],s=t[c+40],h=t[c+48];var C=r+(l=t[c+56]),P=r-l,O=i+h,$=i-h,N=n+s,L=n-s,F=a+o,U=a-o,Y=C+F,H=C-F,z=O+N,V=O-N;t[c]=Y+z,t[c+32]=Y-z;var X=.707106781*(V+H);t[c+16]=H+X,t[c+48]=H-X;var G=.382683433*((Y=U+L)-(V=$+P)),j=.5411961*Y+G,Z=1.306562965*V+G,K=.707106781*(z=L+$),q=P+K,W=P-K;t[c+40]=W+j,t[c+24]=W-j,t[c+8]=q+Z,t[c+56]=q-Z,c++}for(u=0;u<64;++u)f=t[u]*e[u],d[u]=f>0?f+.5|0:f-.5|0;return d}(t,e),l=0;l<64;++l)m[x[l]]=h[l];var u=m[0]-r;r=m[0],0==u?C(i[0]):(C(i[c[a=32767+u]]),C(f[a]));for(var g=63;g>0&&0==m[g];g--);if(0==g)return C(o),r;for(var p,w=1;w<=g;){for(var v=w;0==m[w]&&w<=g;++w);var _=w-v;if(_>=16){p=_>>4;for(var b=1;b<=p;++b)C(s);_&=15}a=32767+m[w],C(n[(_<<4)+c[a]]),C(f[a]),w++}return 63!=g&&C(o),r}function N(t){if(t<=0&&(t=1),t>100&&(t=100),a!=t){(function(t){for(var e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;r<64;r++){var i=o((e[r]*t+50)/100);i<1?i=1:i>255&&(i=255),s[x[r]]=i}for(var n=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],a=0;a<64;a++){var f=o((n[a]*t+50)/100);f<1?f=1:f>255&&(f=255),h[x[a]]=f}for(var c=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],d=0,m=0;m<8;m++)for(var g=0;g<8;g++)l[d]=1/(s[x[d]]*c[m]*c[g]*8),u[d]=1/(h[x[d]]*c[m]*c[g]*8),d++})(t<50?Math.floor(5e3/t):Math.floor(200-2*t)),a=t}}this.encode=function(t,a){(new Date).getTime();a&&N(a),g=new Array,p=0,w=7,O(65496),O(65504),O(16),P(74),P(70),P(73),P(70),P(0),P(1),P(1),P(0),O(1),O(1),P(0),P(0),function(t){if(t){O(65505),69===t[0]&&120===t[1]&&105===t[2]&&102===t[3]?O(t.length+2):(O(t.length+5+2),P(69),P(120),P(105),P(102),P(0));for(var e=0;e<t.length;e++)P(t[e])}}(t.exifBuffer),function(){O(65499),O(132),P(0);for(var t=0;t<64;t++)P(s[t]);P(1);for(var e=0;e<64;e++)P(h[e])}(),function(t,e){O(65472),O(17),P(8),O(e),O(t),P(3),P(1),P(17),P(0),P(2),P(17),P(1),P(3),P(17),P(1)}(t.width,t.height),function(){O(65476),O(418),P(0);for(var t=0;t<16;t++)P(E[t+1]);for(var e=0;e<=11;e++)P(A[e]);P(16);for(var r=0;r<16;r++)P(k[r+1]);for(var i=0;i<=161;i++)P(S[i]);P(1);for(var n=0;n<16;n++)P(I[n+1]);for(var a=0;a<=11;a++)P(D[a]);P(17);for(var o=0;o<16;o++)P(T[o+1]);for(var s=0;s<=161;s++)P(R[s])}(),O(65498),O(12),P(3),P(1),P(0),P(2),P(17),P(3),P(17),P(0),P(63),P(0);var o=0,f=0,c=0;p=0,w=7,this.encode.displayName="_encode_";for(var d,m,y,x,B,L,F,U,Y,H=t.data,z=t.width,V=t.height,X=4*z,G=0;G<V;){for(d=0;d<X;){for(L=B=X*G+d,F=-1,U=0,Y=0;Y<64;Y++)L=B+(U=Y>>3)*X+(F=4*(7&Y)),G+U>=V&&(L-=X*(G+1+U-V)),d+F>=X&&(L-=d+F-X+4),m=H[L++],y=H[L++],x=H[L++],v[Y]=(M[m]+M[y+256>>0]+M[x+512>>0]>>16)-128,_[Y]=(M[m+768>>0]+M[y+1024>>0]+M[x+1280>>0]>>16)-128,b[Y]=(M[m+1280>>0]+M[y+1536>>0]+M[x+1792>>0]>>16)-128;o=$(v,l,o,e,i),f=$(_,u,f,r,n),c=$(b,u,c,r,n),d+=32}G+=8}if(w>=0){var j=[];j[1]=w+1,j[0]=(1<<w+1)-1,C(j)}return O(65497),new Buffer(g)},function(){(new Date).getTime();t||(t=50),function(){for(var t=String.fromCharCode,e=0;e<256;e++)y[e]=t(e)}(),e=B(E,A),r=B(I,D),i=B(k,S),n=B(T,R),function(){for(var t=1,e=2,r=1;r<=15;r++){for(var i=t;i<e;i++)c[32767+i]=r,f[32767+i]=[],f[32767+i][1]=r,f[32767+i][0]=i;for(var n=-(e-1);n<=-t;n++)c[32767+n]=r,f[32767+n]=[],f[32767+n][1]=r,f[32767+n][0]=e-1+n;t<<=1,e<<=1}}(),function(){for(var t=0;t<256;t++)M[t]=19595*t,M[t+256>>0]=38470*t,M[t+512>>0]=7471*t+32768,M[t+768>>0]=-11059*t,M[t+1024>>0]=-21709*t,M[t+1280>>0]=32768*t+8421375,M[t+1536>>0]=-27439*t,M[t+1792>>0]=-5329*t}(),N(t),(new Date).getTime()}()}t.exports=function(t,r){void 0===r&&(r=50);return{data:new e(r).encode(t,r),width:t.width,height:t.height}}})),decoder$1=createCommonjsModule((function(t){var e=function(){var t=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);function e(){}function r(t,e){for(var r,i,n=0,a=[],o=16;o>0&&!t[o-1];)o--;a.push({children:[],index:0});var s,h=a[0];for(r=0;r<o;r++){for(i=0;i<t[r];i++){for((h=a.pop()).children[h.index]=e[n];h.index>0;){if(0===a.length)throw new Error("Could not recreate Huffman Table");h=a.pop()}for(h.index++,a.push(h);a.length<=r;)a.push(s={children:[],index:0}),h.children[h.index]=s.children,h=s;n++}r+1<o&&(a.push(s={children:[],index:0}),h.children[h.index]=s.children,h=s)}return a[0].children}function i(e,r,i,n,a,o,s,h,l,u){i.precision,i.samplesPerLine,i.scanLines;var f=i.mcusPerLine,c=i.progressive,d=(i.maxH,i.maxV,r),m=0,g=0;function p(){if(g>0)return g--,m>>g&1;if(255==(m=e[r++])){var t=e[r++];if(t)throw new Error("unexpected marker: "+(m<<8|t).toString(16))}return g=7,m>>>7}function w(t){for(var e,r=t;null!==(e=p());){if("number"==typeof(r=r[e]))return r;if("object"!=typeof r)throw new Error("invalid huffman sequence")}return null}function v(t){for(var e=0;t>0;){var r=p();if(null===r)return;e=e<<1|r,t--}return e}function _(t){var e=v(t);return e>=1<<t-1?e:e+(-1<<t)+1}var b=0;var y,M=0;function x(t,e,r,i,n){var a=r%f,o=(r/f|0)*t.v+i,s=a*t.h+n;void 0===t.blocks[o]&&u.tolerantDecoding||e(t,t.blocks[o][s])}function E(t,e,r){var i=r/t.blocksPerLine|0,n=r%t.blocksPerLine;void 0===t.blocks[i]&&u.tolerantDecoding||e(t,t.blocks[i][n])}var A,k,S,I,D,T,R=n.length;T=c?0===o?0===h?function(t,e){var r=w(t.huffmanTableDC),i=0===r?0:_(r)<<l;e[0]=t.pred+=i}:function(t,e){e[0]|=p()<<l}:0===h?function(e,r){if(b>0)b--;else for(var i=o,n=s;i<=n;){var a=w(e.huffmanTableAC),h=15&a,u=a>>4;if(0!==h){r[t[i+=u]]=_(h)*(1<<l),i++}else{if(u<15){b=v(u)+(1<<u)-1;break}i+=16}}}:function(e,r){for(var i=o,n=s,a=0;i<=n;){var h=t[i],u=r[h]<0?-1:1;switch(M){case 0:var f=w(e.huffmanTableAC),c=15&f;a=f>>4;if(0===c)a<15?(b=v(a)+(1<<a),M=4):(a=16,M=1);else{if(1!==c)throw new Error("invalid ACn encoding");y=_(c),M=a?2:3}continue;case 1:case 2:r[h]?r[h]+=(p()<<l)*u:0===--a&&(M=2==M?3:0);break;case 3:r[h]?r[h]+=(p()<<l)*u:(r[h]=y<<l,M=0);break;case 4:r[h]&&(r[h]+=(p()<<l)*u)}i++}4===M&&0===--b&&(M=0)}:function(e,r){var i=w(e.huffmanTableDC),n=0===i?0:_(i);r[0]=e.pred+=n;for(var a=1;a<64;){var o=w(e.huffmanTableAC),s=15&o,h=o>>4;if(0!==s){r[t[a+=h]]=_(s),a++}else{if(h<15)break;a+=16}}};var B,C,P,O,$=0;for(C=1==R?n[0].blocksPerLine*n[0].blocksPerColumn:f*i.mcusPerColumn,a||(a=C);$<C;){for(k=0;k<R;k++)n[k].pred=0;if(b=0,1==R)for(A=n[0],D=0;D<a;D++)E(A,T,$),$++;else for(D=0;D<a;D++){for(k=0;k<R;k++)for(P=(A=n[k]).h,O=A.v,S=0;S<O;S++)for(I=0;I<P;I++)x(A,T,$,S,I);if(++$===C)break}if($===C)do{if(255===e[r]&&0!==e[r+1])break;r+=1}while(r<e.length-2);if(g=0,(B=e[r]<<8|e[r+1])<65280)throw new Error("marker was not found");if(!(B>=65488&&B<=65495))break;r+=2}return r-d}function n(t,e){var r,i,n=[],a=e.blocksPerLine,o=e.blocksPerColumn,s=a<<3,l=new Int32Array(64),u=new Uint8Array(64);function f(t,r,i){var n,a,o,s,h,l,u,f,c,d,m=e.quantizationTable,g=i;for(d=0;d<64;d++)g[d]=t[d]*m[d];for(d=0;d<8;++d){var p=8*d;0!=g[1+p]||0!=g[2+p]||0!=g[3+p]||0!=g[4+p]||0!=g[5+p]||0!=g[6+p]||0!=g[7+p]?(n=5793*g[0+p]+128>>8,a=5793*g[4+p]+128>>8,o=g[2+p],s=g[6+p],h=2896*(g[1+p]-g[7+p])+128>>8,f=2896*(g[1+p]+g[7+p])+128>>8,l=g[3+p]<<4,c=n-a+1>>1,n=n+a+1>>1,a=c,c=3784*o+1567*s+128>>8,o=1567*o-3784*s+128>>8,s=c,c=h-(u=g[5+p]<<4)+1>>1,h=h+u+1>>1,u=c,c=f+l+1>>1,l=f-l+1>>1,f=c,c=n-s+1>>1,n=n+s+1>>1,s=c,c=a-o+1>>1,a=a+o+1>>1,o=c,c=2276*h+3406*f+2048>>12,h=3406*h-2276*f+2048>>12,f=c,c=799*l+4017*u+2048>>12,l=4017*l-799*u+2048>>12,u=c,g[0+p]=n+f,g[7+p]=n-f,g[1+p]=a+u,g[6+p]=a-u,g[2+p]=o+l,g[5+p]=o-l,g[3+p]=s+h,g[4+p]=s-h):(c=5793*g[0+p]+512>>10,g[0+p]=c,g[1+p]=c,g[2+p]=c,g[3+p]=c,g[4+p]=c,g[5+p]=c,g[6+p]=c,g[7+p]=c)}for(d=0;d<8;++d){var w=d;0!=g[8+w]||0!=g[16+w]||0!=g[24+w]||0!=g[32+w]||0!=g[40+w]||0!=g[48+w]||0!=g[56+w]?(n=5793*g[0+w]+2048>>12,a=5793*g[32+w]+2048>>12,o=g[16+w],s=g[48+w],h=2896*(g[8+w]-g[56+w])+2048>>12,f=2896*(g[8+w]+g[56+w])+2048>>12,l=g[24+w],c=n-a+1>>1,n=n+a+1>>1,a=c,c=3784*o+1567*s+2048>>12,o=1567*o-3784*s+2048>>12,s=c,c=h-(u=g[40+w])+1>>1,h=h+u+1>>1,u=c,c=f+l+1>>1,l=f-l+1>>1,f=c,c=n-s+1>>1,n=n+s+1>>1,s=c,c=a-o+1>>1,a=a+o+1>>1,o=c,c=2276*h+3406*f+2048>>12,h=3406*h-2276*f+2048>>12,f=c,c=799*l+4017*u+2048>>12,l=4017*l-799*u+2048>>12,u=c,g[0+w]=n+f,g[56+w]=n-f,g[8+w]=a+u,g[48+w]=a-u,g[16+w]=o+l,g[40+w]=o-l,g[24+w]=s+h,g[32+w]=s-h):(c=5793*i[d+0]+8192>>14,g[0+w]=c,g[8+w]=c,g[16+w]=c,g[24+w]=c,g[32+w]=c,g[40+w]=c,g[48+w]=c,g[56+w]=c)}for(d=0;d<64;++d){var v=128+(g[d]+8>>4);r[d]=v<0?0:v>255?255:v}}h(s*o*8);for(var c=0;c<o;c++){var d=c<<3;for(r=0;r<8;r++)n.push(new Uint8Array(s));for(var m=0;m<a;m++){f(e.blocks[c][m],u,l);var g=0,p=m<<3;for(i=0;i<8;i++){var w=n[d+i];for(r=0;r<8;r++)w[p+r]=u[g++]}}}return n}function a(t){return t<0?0:t>255?255:t}e.prototype={load:function(t){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){var t=new Uint8Array(e.response||e.mozResponseArrayBuffer);this.parse(t),this.onload&&this.onload()}.bind(this),e.send(null)},parse:function(e){var a=1e3*this.opts.maxResolutionInMP*1e3,o=0;e.length;function s(){var t=e[o]<<8|e[o+1];return o+=2,t}function l(){var t=s(),r=e.subarray(o,o+t-2);return o+=r.length,r}function u(t){var e,r,i=0,n=0;for(r in t.components)t.components.hasOwnProperty(r)&&(i<(e=t.components[r]).h&&(i=e.h),n<e.v&&(n=e.v));var a=Math.ceil(t.samplesPerLine/8/i),o=Math.ceil(t.scanLines/8/n);for(r in t.components)if(t.components.hasOwnProperty(r)){e=t.components[r];var s=Math.ceil(Math.ceil(t.samplesPerLine/8)*e.h/i),l=Math.ceil(Math.ceil(t.scanLines/8)*e.v/n),u=a*e.h,f=o*e.v,c=[];h(256*(f*u));for(var d=0;d<f;d++){for(var m=[],g=0;g<u;g++)m.push(new Int32Array(64));c.push(m)}e.blocksPerLine=s,e.blocksPerColumn=l,e.blocks=c}t.maxH=i,t.maxV=n,t.mcusPerLine=a,t.mcusPerColumn=o}var f,c,d=null,m=null,g=[],p=[],w=[],v=[],_=s();if(65496!=_)throw new Error("SOI not found");for(_=s();65497!=_;){switch(_){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var b=l();65504===_&&74===b[0]&&70===b[1]&&73===b[2]&&70===b[3]&&0===b[4]&&(d={version:{major:b[5],minor:b[6]},densityUnits:b[7],xDensity:b[8]<<8|b[9],yDensity:b[10]<<8|b[11],thumbWidth:b[12],thumbHeight:b[13],thumbData:b.subarray(14,14+3*b[12]*b[13])}),65505===_&&69===b[0]&&120===b[1]&&105===b[2]&&102===b[3]&&0===b[4]&&(this.exifBuffer=b.subarray(5,b.length)),65518===_&&65===b[0]&&100===b[1]&&111===b[2]&&98===b[3]&&101===b[4]&&0===b[5]&&(m={version:b[6],flags0:b[7]<<8|b[8],flags1:b[9]<<8|b[10],transformCode:b[11]});break;case 65499:for(var y=s()+o-2;o<y;){var M=e[o++];h(256);var x=new Int32Array(64);if(M>>4==0)for(X=0;X<64;X++){x[t[X]]=e[o++]}else{if(M>>4!=1)throw new Error("DQT: invalid table spec");for(X=0;X<64;X++){x[t[X]]=s()}}g[15&M]=x}break;case 65472:case 65473:case 65474:s(),(f={}).extended=65473===_,f.progressive=65474===_,f.precision=e[o++],f.scanLines=s(),f.samplesPerLine=s(),f.components={},f.componentsOrder=[];var E=f.scanLines*f.samplesPerLine;if(E>a){var A=Math.ceil((E-a)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${A}MP`)}var k,S=e[o++];for(z=0;z<S;z++){k=e[o];var I=e[o+1]>>4,D=15&e[o+1],T=e[o+2];f.componentsOrder.push(k),f.components[k]={h:I,v:D,quantizationIdx:T},o+=3}u(f),p.push(f);break;case 65476:var R=s();for(z=2;z<R;){var B=e[o++],C=new Uint8Array(16),P=0;for(X=0;X<16;X++,o++)P+=C[X]=e[o];h(16+P);var O=new Uint8Array(P);for(X=0;X<P;X++,o++)O[X]=e[o];z+=17+P,(B>>4==0?v:w)[15&B]=r(C,O)}break;case 65501:s(),c=s();break;case 65498:s();var $=e[o++],N=[];for(z=0;z<$;z++){G=f.components[e[o++]];var L=e[o++];G.huffmanTableDC=v[L>>4],G.huffmanTableAC=w[15&L],N.push(G)}var F=e[o++],U=e[o++],Y=e[o++],H=i(e,o,f,N,c,F,U,Y>>4,15&Y,this.opts);o+=H;break;case 65535:255!==e[o]&&o--;break;default:if(255==e[o-3]&&e[o-2]>=192&&e[o-2]<=254){o-=3;break}throw new Error("unknown JPEG marker "+_.toString(16))}_=s()}if(1!=p.length)throw new Error("only single frame JPEGs supported");for(var z=0;z<p.length;z++){var V=p[z].components;for(var X in V)V[X].quantizationTable=g[V[X].quantizationIdx],delete V[X].quantizationIdx}this.width=f.samplesPerLine,this.height=f.scanLines,this.jfif=d,this.adobe=m,this.components=[];for(z=0;z<f.componentsOrder.length;z++){var G=f.components[f.componentsOrder[z]];this.components.push({lines:n(0,G),scaleX:G.h/f.maxH,scaleY:G.v/f.maxV})}},getData:function(t,e){var r,i,n,o,s,l,u,f,c,d,m,g,p,w,v,_,b,y,M,x,E,A=this.width/t,k=this.height/e,S=0,I=t*e*this.components.length;h(I);var D=new Uint8Array(I);switch(this.components.length){case 1:for(r=this.components[0],d=0;d<e;d++)for(s=r.lines[0|d*r.scaleY*k],c=0;c<t;c++)m=s[0|c*r.scaleX*A],D[S++]=m;break;case 2:for(r=this.components[0],i=this.components[1],d=0;d<e;d++)for(s=r.lines[0|d*r.scaleY*k],l=i.lines[0|d*i.scaleY*k],c=0;c<t;c++)m=s[0|c*r.scaleX*A],D[S++]=m,m=l[0|c*i.scaleX*A],D[S++]=m;break;case 3:for(E=!0,this.adobe&&this.adobe.transformCode?E=!0:void 0!==this.opts.colorTransform&&(E=!!this.opts.colorTransform),r=this.components[0],i=this.components[1],n=this.components[2],d=0;d<e;d++)for(s=r.lines[0|d*r.scaleY*k],l=i.lines[0|d*i.scaleY*k],u=n.lines[0|d*n.scaleY*k],c=0;c<t;c++)E?(m=s[0|c*r.scaleX*A],g=l[0|c*i.scaleX*A],y=a(m+1.402*((p=u[0|c*n.scaleX*A])-128)),M=a(m-.3441363*(g-128)-.71413636*(p-128)),x=a(m+1.772*(g-128))):(y=s[0|c*r.scaleX*A],M=l[0|c*i.scaleX*A],x=u[0|c*n.scaleX*A]),D[S++]=y,D[S++]=M,D[S++]=x;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(E=!1,this.adobe&&this.adobe.transformCode?E=!0:void 0!==this.opts.colorTransform&&(E=!!this.opts.colorTransform),r=this.components[0],i=this.components[1],n=this.components[2],o=this.components[3],d=0;d<e;d++)for(s=r.lines[0|d*r.scaleY*k],l=i.lines[0|d*i.scaleY*k],u=n.lines[0|d*n.scaleY*k],f=o.lines[0|d*o.scaleY*k],c=0;c<t;c++)E?(m=s[0|c*r.scaleX*A],g=l[0|c*i.scaleX*A],p=u[0|c*n.scaleX*A],w=f[0|c*o.scaleX*A],v=255-a(m+1.402*(p-128)),_=255-a(m-.3441363*(g-128)-.71413636*(p-128)),b=255-a(m+1.772*(g-128))):(v=s[0|c*r.scaleX*A],_=l[0|c*i.scaleX*A],b=u[0|c*n.scaleX*A],w=f[0|c*o.scaleX*A]),D[S++]=255-v,D[S++]=255-_,D[S++]=255-b,D[S++]=255-w;break;default:throw new Error("Unsupported color mode")}return D},copyToImageData:function(t,e){var r,i,n,o,s,h,l,u,f,c=t.width,d=t.height,m=t.data,g=this.getData(c,d),p=0,w=0;switch(this.components.length){case 1:for(i=0;i<d;i++)for(r=0;r<c;r++)n=g[p++],m[w++]=n,m[w++]=n,m[w++]=n,e&&(m[w++]=255);break;case 3:for(i=0;i<d;i++)for(r=0;r<c;r++)l=g[p++],u=g[p++],f=g[p++],m[w++]=l,m[w++]=u,m[w++]=f,e&&(m[w++]=255);break;case 4:for(i=0;i<d;i++)for(r=0;r<c;r++)s=g[p++],h=g[p++],n=g[p++],l=255-a(s*(1-(o=g[p++])/255)+o),u=255-a(h*(1-o/255)+o),f=255-a(n*(1-o/255)+o),m[w++]=l,m[w++]=u,m[w++]=f,e&&(m[w++]=255);break;default:throw new Error("Unsupported color mode")}}};var o=0,s=0;function h(t=0){var e=o+t;if(e>s){var r=Math.ceil((e-s)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${r}MB`)}o=e}return e.resetMaxMemoryUsage=function(t){o=0,s=t},e.getBytesAllocated=function(){return o},e.requestMemoryAllocation=h,e}();t.exports=function(t,r={}){var i={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...r},n=new Uint8Array(t),a=new e;a.opts=i,e.resetMaxMemoryUsage(1024*i.maxMemoryUsageInMB*1024),a.parse(n);var o=i.formatAsRGBA?4:3,s=a.width*a.height*o;try{e.requestMemoryAllocation(s);var h={width:a.width,height:a.height,exifBuffer:a.exifBuffer,data:i.useTArray?new Uint8Array(s):new Buffer(s)}}catch(t){throw t instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+s):t}return a.copyToImageData(h,i.formatAsRGBA),h}})),jpegJs={encode:encoder$1,decode:decoder$1},jpegJs_1=jpegJs.encode,jpegJs_2=jpegJs.decode,chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256),i$1=0;i$1<chars.length;i$1++)lookup[chars.charCodeAt(i$1)]=i$1;function encode$3(t){var e,r=t.length,i="";for(e=0;e<r;e+=3)i+=chars[t[e]>>2],i+=chars[(3&t[e])<<4|t[e+1]>>4],i+=chars[(15&t[e+1])<<2|t[e+2]>>6],i+=chars[63&t[e+2]];return r%3==2?i=i.substring(0,i.length-1)+"=":r%3==1&&(i=i.substring(0,i.length-2)+"=="),i}function decode$1(t){var e,r,i,n,a=.75*t.length,o=t.length,s=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);for(var h=new Uint8Array(a),l=0;l<o;l+=4)e=lookup[t.charCodeAt(l)],r=lookup[t.charCodeAt(l+1)],i=lookup[t.charCodeAt(l+2)],n=lookup[t.charCodeAt(l+3)],h[s++]=e<<2|r>>4,h[s++]=(15&r)<<4|i>>2,h[s++]=(3&i)<<6|63&n;return h}function toBase64URL(t,e){return`data:${e};base64,${encode$3(t)}`}var ImageData=self.ImageData,DOMImage=self.Image;function createCanvas(t,e){var r=self.document.createElement("canvas");return r.width=t,r.height=e,r}function fetchBinary(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.withCredentials,i=void 0!==r&&r;return new Promise((function(e,r){var n=new self.XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.withCredentials=i,n.onload=function(t){200!==this.status?r(t):e(this.response)},n.onerror=r,n.send()}))}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(t){return t.includes("/")||(t="image/"+t),t}function encodeJpeg(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={width:t.width,height:t.height,data:t.getRGBAData()};return jpegJs_1(r,e.quality).data}function encodePng(t,e){var r={width:t.width,height:t.height,channels:t.channels,depth:t.bitDepth,data:t.data};return 1!==r.depth&&32!==r.depth||(r.depth=8,r.channels=4,r.data=t.getRGBAData()),encodePNG(r,e)}var exportMethods={save(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.useCanvas,i=void 0!==r&&r,n=e.encoder,a=void 0===n?void 0:n,o=e.format;if(!o){var s=/\.([a-zA-Z]+)$/.exec(t);s&&(o=s[1].toLowerCase())}if(!o)throw new Error("file format not provided");return new Promise((t,e)=>{var r,n;switch(o.toLowerCase()){case"png":i?r=this.getCanvas().pngStream():n=encodePng(this,a);break;case"jpg":case"jpeg":i?r=this.getCanvas().jpegStream():n=encodeJpeg(this,a);break;case"bmp":n=encode$1(this);break;default:throw new RangeError("invalid output format: "+o)}if(r){var s=createWriteStream();s.on("finish",t),s.on("error",e),r.pipe(s)}else n&&writeFile()})},toDataURL(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"object"==typeof t&&(e=t,t="image/png");var r=e,i=r.useCanvas,n=void 0!==i&&i,a=r.encoder,o=void 0===a?void 0:a;function s(e,r){return toBase64URL(e(r,o),t)}return"image/bmp"===(t=getType(t))?s(encode$1,this):"image/png"!==t||n?"image/jpeg"!==t||n?this.getCanvas().toDataURL(t):s(encodeJpeg,this):s(encodePng,this)},toBuffer(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.format,r=void 0===e?"png":e,i=t.encoder,n=void 0===i?void 0:i;switch(r.toLowerCase()){case"png":return encodePng(this,n);case"jpeg":case"jpg":return encodeJpeg(this,n);case"bmp":return encode$1(this);default:throw new RangeError("invalid output format: "+r)}},toBase64(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.async)return this.toDataURL(t,e).then((function(t){return t.substring(t.indexOf(",")+1)}));var r=this.toDataURL(t,e);return r.substring(r.indexOf(",")+1)},toBlob(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.8;return canvasToBlob(this.getCanvas(),t,e)},getCanvas(){var t=new ImageData(this.getRGBAData({clamped:!0}),this.width,this.height),e=createCanvas(this.width,this.height);return e.getContext("2d").putImageData(t,0,0),e}};function setExportMethods(t){for(var e in exportMethods)t.prototype[e]=exportMethods[e]}var _from="has-own@^1.0.1",_id="has-own@1.0.1",_inBundle=!1,_integrity="sha512-RDKhzgQTQfMaLvIFhjahU+2gGnRBK6dYOd5Gd9BzkmnBneOCRYjRC003RIMrdAbH52+l+CnMS4bBCXGer8tEhg==",_location="/has-own",_phantomChildren={},_requested={type:"range",registry:!0,raw:"has-own@^1.0.1",name:"has-own",escapedName:"has-own",rawSpec:"^1.0.1",saveSpec:null,fetchSpec:"^1.0.1"},_requiredBy=["/"],_resolved="https://registry.npmjs.org/has-own/-/has-own-1.0.1.tgz",_shasum="7cc78a63e5ffde330fa8d0a6ddaca4a70c495579",_spec="has-own@^1.0.1",_where="/usr/local/www/sites/www.lactame.com/node/grm-data/git/image-js/image-js",author={name:"Aaron Heckmann",email:"aaron.heckmann+github@gmail.com"},bugs={url:"https://github.com/aheckmann/has-own/issues"},bundleDependencies=!1,deprecated=!1,description="A safer .hasOwnProperty() - hasOwn(name, obj)",devDependencies={mocha:"^6.2.2"},homepage="https://github.com/aheckmann/has-own/",license="MIT",main="index.js",name="has-own",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},scripts={test:"make test"},version="1.0.1",_package={_from:_from,_id:_id,_inBundle:_inBundle,_integrity:_integrity,_location:_location,_phantomChildren:_phantomChildren,_requested:_requested,_requiredBy:_requiredBy,_resolved:_resolved,_shasum:_shasum,_spec:_spec,_where:_where,author:author,bugs:bugs,bundleDependencies:bundleDependencies,deprecated:deprecated,description:description,devDependencies:devDependencies,homepage:homepage,license:license,main:main,name:name,repository:repository,scripts:scripts,version:version},_package$1=Object.freeze({__proto__:null,_from:_from,_id:_id,_inBundle:_inBundle,_integrity:_integrity,_location:_location,_phantomChildren:_phantomChildren,_requested:_requested,_requiredBy:_requiredBy,_resolved:_resolved,_shasum:_shasum,_spec:_spec,_where:_where,author:author,bugs:bugs,bundleDependencies:bundleDependencies,deprecated:deprecated,description:description,devDependencies:devDependencies,homepage:homepage,license:license,main:main,name:name,repository:repository,scripts:scripts,version:version,default:_package}),require$$0=getCjsExportFromNamespace(_package$1),hasOwn=createCommonjsModule((function(t,e){var r=Object.prototype.hasOwnProperty;t.exports=e=function(t,e){return r.call(e,t)},e.version=require$$0.version})),hasOwn_1=hasOwn.version,computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};function extendMethod(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.inPlace,n=void 0!==i&&i,a=r.returnThis,o=void 0===a||a,s=r.partialArgs,h=void 0===s?[]:s;return Image.prototype[t]=n?function(){this.computed=null;for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var n=e.apply(this,[...h,...r]);return o?this:n}:function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e.apply(this,[...h,...r])},Image}function extendProperty(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.partialArgs,n=void 0===i?[]:i;return computedPropertyDescriptor.get=function(){if(null===this.computed)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];var r=e.apply(this,n);return this.computed[t]=r,r},Object.defineProperty(Image.prototype,t,computedPropertyDescriptor),Image}var GREY="GREY",RGB="RGB",HSL="HSL",HSV="HSV",CMYK="CMYK",ColorModel=Object.freeze({__proto__:null,GREY:GREY,RGB:RGB,HSL:HSL,HSV:HSV,CMYK:CMYK});function getRGBAData(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.clamped;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});var r=this.width*this.height*4,i=e?new Uint8ClampedArray(r):new Uint8Array(r);return 1===this.bitDepth?fillDataFromBinary(this,i):32===this.bitDepth?(this.checkProcessable("getRGBAData",{alpha:0}),1===this.components?fillDataFromGrey32(this,i):3===this.components&&(this.checkProcessable("getRGBAData",{colorModel:[RGB]}),fillDataFromRGB32(this,i))):1===this.components?fillDataFromGrey(this,i):3===this.components&&(this.checkProcessable("getRGBAData",{colorModel:[RGB]}),fillDataFromRGB(this,i)),1===this.alpha?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,i)):fillAlpha(this,i),i}function fillDataFromBinary(t,e){for(var r=0;r<t.size;r++){var i=t.getBit(r);e[4*r]=255*i,e[4*r+1]=255*i,e[4*r+2]=255*i}}function fillDataFromGrey32(t,e){for(var r=t.min[0],i=t.max[0]-r,n=0;n<t.size;n++){var a=Math.floor(255*(t.data[n]-r)/i);e[4*n]=a,e[4*n+1]=a,e[4*n+2]=a}}function fillDataFromRGB32(t,e){for(var r=Math.min(...t.min),i=Math.max(...t.max)-r,n=0;n<t.size;n++){var a=Math.floor(255*(t.data[3*n]-r)/i),o=Math.floor(255*(t.data[3*n+1]-r)/i),s=Math.floor(255*(t.data[3*n+2]-r)/i);e[4*n]=a,e[4*n+1]=o,e[4*n+2]=s}}function fillDataFromGrey(t,e){for(var r=0;r<t.size;r++)e[4*r]=t.data[r*t.channels]>>>t.bitDepth-8,e[4*r+1]=t.data[r*t.channels]>>>t.bitDepth-8,e[4*r+2]=t.data[r*t.channels]>>>t.bitDepth-8}function fillDataFromRGB(t,e){for(var r=0;r<t.size;r++)e[4*r]=t.data[r*t.channels]>>>t.bitDepth-8,e[4*r+1]=t.data[r*t.channels+1]>>>t.bitDepth-8,e[4*r+2]=t.data[r*t.channels+2]>>>t.bitDepth-8}function copyAlpha(t,e){for(var r=0;r<t.size;r++)e[4*r+3]=t.data[r*t.channels+t.components]>>t.bitDepth-8}function fillAlpha(t,e){for(var r=0;r<t.size;r++)e[4*r+3]=255}var BINARY="BINARY",GREY$1="GREY",GREYA="GREYA",RGB$1="RGB",RGBA="RGBA",CMYK$1="CMYK",CMYKA="CMYKA",kinds={};function getKind(t){var e=kinds[t];if(!e)throw new RangeError("invalid image kind: "+t);return e}kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY},kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY},kinds[GREY$1]={components:1,alpha:0,bitDepth:8,colorModel:GREY},kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB},kinds[RGB$1]={components:3,alpha:0,bitDepth:8,colorModel:RGB},kinds[CMYK$1]={components:4,alpha:0,bitDepth:8,colorModel:CMYK},kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK};var validBitDepth=[1,8,16,32];function verifyKindDefinition(t){var e=t.components,r=t.alpha,i=t.bitDepth,n=t.colorModel;if(!Number.isInteger(e)||e<=0)throw new RangeError(`invalid components: ${e}. Must be a positive integer`);if(0!==r&&1!==r&&"boolean"!=typeof r)throw new TypeError(`invalid alpha: ${r}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(i))throw new RangeError(`invalid bitDepth: ${i}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[n])throw new RangeError(`invalid colorModel: ${n}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(t,e,r){var i=e*t;return 1===r&&(i=Math.ceil(i/8)),i}function createPixelArray(t,e,r,i,n,a){var o,s=i*t;switch(n){case 1:o=new Uint8Array(Math.ceil(s/8));break;case 8:o=new Uint8Array(s);break;case 16:o=new Uint16Array(s);break;case 32:o=new Float32Array(s);break;default:throw new Error("Cannot create pixel array for bit depth "+n)}if(r)for(var h=e;h<o.length;h+=i)o[h]=a;return o}const defaultByteLength$2=8192,charArray$1=[];class IOBuffer$2{constructor(t,e){e=e||{},void 0===t&&(t=defaultByteLength$2),"number"==typeof t&&(t=new ArrayBuffer(t));let r=t.byteLength;const i=e.offset?e.offset>>>0:0;t.buffer&&(r=t.byteLength-i,t=t.byteLength!==t.buffer.byteLength?t.buffer.slice(t.byteOffset+i,t.byteOffset+t.byteLength):i?t.buffer.slice(i):t.buffer),this.buffer=t,this.length=r,this.byteLength=r,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=r||defaultByteLength$2,this._mark=0}available(t){return void 0===t&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(t){void 0===t&&(t=1),this.offset+=t}seek(t){this.offset=t}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(t){if(void 0===t&&(t=1),!this.available(t)){const t=this._increment+this._increment;this._increment=t;const e=this.length+t,r=new Uint8Array(e);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=e,this._data=new DataView(this.buffer)}}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){void 0===t&&(t=1);for(var e=new Uint8Array(t),r=0;r<t;r++)e[r]=this.readByte();return e}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){void 0===t&&(t=1),charArray$1.length=t;for(var e=0;e<t;e++)charArray$1[e]=this.readChar();return charArray$1.join("")}writeBoolean(t){this.writeUint8(t?255:0)}writeInt8(t){this.ensureAvailable(1),this._data.setInt8(this.offset++,t)}writeUint8(t){this.ensureAvailable(1),this._data.setUint8(this.offset++,t)}writeByte(t){this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e])}writeInt16(t){this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2}writeUint16(t){this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2}writeInt32(t){this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4}writeUint32(t){this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat32(t){this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat64(t){this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8}writeChar(t){this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}}var IOBuffer_1$1=IOBuffer$2;const tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(var i$2 in tagsById)tagsByName[tagsById[i$2]]=i$2;var standard={tagsById:tagsById,tagsByName:tagsByName};const tagsById$1={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$1={};for(var i$3 in tagsById$1)tagsByName$1[tagsById$1[i$3]]=i$3;var exif={tagsById:tagsById$1,tagsByName:tagsByName$1};const tagsById$2={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$2={};for(var i$4 in tagsById$2)tagsByName$2[tagsById$2[i$4]]=i$4;var gps={tagsById:tagsById$2,tagsByName:tagsByName$2};const tags={standard:standard,exif:exif,gps:gps};class IFD{constructor(t){if(!t)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=t,this._map=null}get(t){if("number"==typeof t)return this.fields.get(t);if("string"==typeof t)return this.fields.get(tags[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const e=tags[this.kind].tagsById;for(var t of this.fields.keys())e[t]&&(this._map[e[t]]=this.fields.get(t))}return this._map}}var ifd=IFD;const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var t=new Date,e=dateTimeRegex.exec(this.dateTime);return t.setFullYear(e[1],e[2]-1,e[3]),t.setHours(e[4],e[5],e[6]),t}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}function alwaysArray(t){return"number"==typeof t?[t]:t}var tiffIfd=TiffIfd,types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]),getByteLength=function(t,e){return types.get(t)[0]*e},readData=function(t,e,r){return types.get(e)[1](t,r)};function readByte(t,e){if(1===e)return t.readUint8();for(var r=new Uint8Array(e),i=0;i<e;i++)r[i]=t.readUint8();return r}function readASCII(t,e){for(var r=[],i="",n=0;n<e;n++){var a=String.fromCharCode(t.readUint8());"\0"===a?(r.push(i),i=""):i+=a}return 1===r.length?r[0]:r}function readShort(t,e){if(1===e)return t.readUint16();for(var r=new Uint16Array(e),i=0;i<e;i++)r[i]=t.readUint16();return r}function readLong(t,e){if(1===e)return t.readUint32();for(var r=new Uint32Array(e),i=0;i<e;i++)r[i]=t.readUint32();return r}function readRational(t,e){if(1===e)return t.readUint32()/t.readUint32();for(var r=new Array(e),i=0;i<e;i++)r[i]=t.readUint32()/t.readUint32();return r}function readSByte(t,e){if(1===e)return t.readInt8();for(var r=new Int8Array(e),i=0;i<e;i++)r[i]=t.readInt8();return r}function readSShort(t,e){if(1===e)return t.readInt16();for(var r=new Int16Array(e),i=0;i<e;i++)r[i]=t.readInt16();return r}function readSLong(t,e){if(1===e)return t.readInt32();for(var r=new Int32Array(e),i=0;i<e;i++)r[i]=t.readInt32();return r}function readSRational(t,e){if(1===e)return t.readInt32()/t.readInt32();for(var r=new Array(e),i=0;i<e;i++)r[i]=t.readInt32()/t.readInt32();return r}function readFloat(t,e){if(1===e)return t.readFloat32();for(var r=new Float32Array(e),i=0;i<e;i++)r[i]=t.readFloat32();return r}function readDouble(t,e){if(1===e)return t.readFloat64();for(var r=new Float64Array(e),i=0;i<e;i++)r[i]=t.readFloat64();return r}var ifdValue={getByteLength:getByteLength,readData:readData};const defaultOptions={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer_1$1{constructor(t,e){super(t,e),this._nextIFD=0}decode(t){t=Object.assign({},defaultOptions,t);const e=[];for(this.decodeHeader();this._nextIFD;)if(e.push(this.decodeIFD(t)),t.onlyFirst)return e[0];return e}decodeHeader(){let t=this.readUint16();if(18761===t)this.setLittleEndian();else{if(19789!==t)throw new Error("invalid byte order: 0x"+t.toString(16));this.setBigEndian()}if(t=this.readUint16(),42!==t)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t){var e;this.seek(this._nextIFD),e=t.kind?new ifd(t.kind):new tiffIfd;const r=this.readUint16();for(var i=0;i<r;i++)this.decodeIFDEntry(e);return t.ignoreImageData||this.decodeImageData(e),this._nextIFD=this.readUint32(),e}decodeIFDEntry(t){const e=this.offset,r=this.readUint16(),i=this.readUint16(),n=this.readUint32();if(i<1||i>12)return void this.skip(4);ifdValue.getByteLength(i,n)>4&&this.seek(this.readUint32());const a=ifdValue.readData(this,i,n);if(t.fields.set(r,a),34665===r||34853===r){let e,i=this.offset;34665===r?e="exif":34853===r&&(e="gps"),this._nextIFD=a,t[e]=this.decodeIFD({kind:e,ignoreImageData:!0}),this.offset=i}this.seek(e),this.skip(12)}decodeImageData(t){const e=t.orientation;switch(e&&1!==e&&unsupported("orientation",e),t.type){case 1:case 2:this.readStripData(t);break;default:unsupported("image type",t.type)}}readStripData(t){const e=t.width,r=t.height,i=validateBitDepth(t.bitsPerSample),n=t.sampleFormat;let a=e*r;const o=getDataArray(a,1,i,n),s=t.compression,h=t.rowsPerStrip*e,l=t.stripOffsets,u=t.stripByteCounts;for(var f=0,c=0;c<l.length;c++){var d=this.getStripData(s,l[c],u[c]),m=a>h?h:a;a-=m,8===i?f=fill8bit(o,d,f,m):16===i?f=fill16bit(o,d,f,m,this.isLittleEndian()):32===i&&3===n?f=fillFloat32(o,d,f,m,this.isLittleEndian()):unsupported("bitDepth",i)}t.data=o}getStripData(t,e,r){switch(t){case 1:return new DataView(this.buffer,e,r);case 2:case 32773:return unsupported("Compression",t);default:throw new Error("invalid compression: "+t)}}}var tiffDecoder=TIFFDecoder;function getDataArray(t,e,r,i){return 8===r?new Uint8Array(t*e):16===r?new Uint16Array(t*e):32===r&&3===i?new Float32Array(t*e):unsupported("bit depth / sample format",r+" / "+i)}function fill8bit(t,e,r,i){for(var n=0;n<i;n++)t[r++]=e.getUint8(n);return r}function fill16bit(t,e,r,i,n){for(var a=0;a<2*i;a+=2)t[r++]=e.getUint16(a,n);return r}function fillFloat32(t,e,r,i,n){for(var a=0;a<4*i;a+=4)t[r++]=e.getFloat32(a,n);return r}function unsupported(t,e){throw new Error("Unsupported "+t+": "+e)}function validateBitDepth(t){if(t.length){const r=t;t=r[0];for(var e=0;e<r.length;e++)r[e]!==t&&unsupported("bit depth",r)}return t}var decode$2=function(t,e){return new tiffDecoder(t,e).decode(e)},decode$3=decode$2,src={decode:decode$3};function decode$4(t){const e=new IOBuffer_1$1(t),r={};e.setBigEndian();if(65496!==e.readUint16())throw new Error("SOI marker not found. Not a valid JPEG file");if(65505===e.readUint16()){e.readUint16();const t=e.readBytes(6);if(69===t[0]&&120===t[1]&&105===t[2]&&102===t[3]&&0===t[4]&&0===t[5]){const t=src.decode(e,{onlyFirst:!0,ignoreImageData:!0,offset:e.offset});r.exif=t}}return r}var decode_1=decode$4,decode$5=decode_1,fileType_1=createCommonjsModule((function(module){const toBytes=t=>[...t].map(t=>t.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(t,e=0){let r=t[e],i=1,n=0;for(;++n<8;)i*=256,r+=t[e+n]*i;return r}const fileType=t=>{if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Buffer.isBuffer(t)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof t}\``);const e=t instanceof Uint8Array?t:new Uint8Array(t);if(!(e&&e.length>1))return null;const r=(t,r)=>{r=Object.assign({offset:0},r);for(let i=0;i<t.length;i++)if(r.mask){if(t[i]!==(r.mask[i]&e[i+r.offset]))return!1}else if(t[i]!==e[i+r.offset])return!1;return!0},i=(t,e)=>r(toBytes(t),e);if(r([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(r([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(r([71,73,70]))return{ext:"gif",mime:"image/gif"};if(r([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(r([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((r([73,73,42,0])||r([77,77,0,42]))&&r([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r([73,73,42,0])||r([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(r([66,77]))return{ext:"bmp",mime:"image/bmp"};if(r([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(r([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(r([80,75,3,4])){if(r([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(r(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(i("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(i("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(i("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const t=(t,e=0)=>t.findIndex((t,r,i)=>r>=e&&80===i[r]&&75===i[r+1]&&3===i[r+2]&&4===i[r+3]);let n=0,a=!1,o=null;do{const s=n+30;if(a||(a=r(oxmlContentTypes,{offset:s})||r(oxmlRels,{offset:s})),o||(i("word/",{offset:s})?o={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:i("ppt/",{offset:s})?o={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:i("xl/",{offset:s})&&(o={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),a&&o)return o;n=t(e,s)}while(n>=0);if(o)return o}if(r([80,75])&&(3===e[2]||5===e[2]||7===e[2])&&(4===e[3]||6===e[3]||8===e[3]))return{ext:"zip",mime:"application/zip"};if(r([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(r([82,97,114,33,26,7])&&(0===e[6]||1===e[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(r([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(r([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(r([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(r([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(r([51,103,112,53])||r([0,0,0])&&r([102,116,121,112],{offset:4})&&(r([109,112,52,49],{offset:8})||r([109,112,52,50],{offset:8})||r([105,115,111,109],{offset:8})||r([105,115,111,50],{offset:8})||r([109,109,112,52],{offset:8})||r([77,52,86],{offset:8})||r([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(r([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(r([26,69,223,163])){const t=e.subarray(4,4100),r=t.findIndex((t,e,r)=>66===r[e]&&130===r[e+1]);if(-1!==r){const e=r+3,i=r=>[...r].every((r,i)=>t[e+i]===r.charCodeAt(0));if(i("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(i("webm"))return{ext:"webm",mime:"video/webm"}}}if(r([0,0,0,20,102,116,121,112,113,116,32,32])||r([102,114,101,101],{offset:4})||r([102,116,121,112,113,116,32,32],{offset:4})||r([109,100,97,116],{offset:4})||r([109,111,111,118],{offset:4})||r([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(r([82,73,70,70])){if(r([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(r([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(r([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(r([48,38,178,117,142,102,207,17,166,217])){let t=30;do{const i=readUInt64LE(e,t+16);if(r([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:t})){if(r([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:t+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(r([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:t+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}t+=i}while(t+24<=e.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(r([0,0,1,186])||r([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(r([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let t=0;t<2&&t<e.length-16;t++){if(r([73,68,51],{offset:t})||r([255,226],{offset:t,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(r([255,228],{offset:t,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,248],{offset:t,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,240],{offset:t,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(r([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(r([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(r([79,103,103,83]))return r([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:r([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:r([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:r([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:r([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(r([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(r([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(r([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(r([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(r([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(r([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((67===e[0]||70===e[0])&&r([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(r([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(r([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(r([119,79,70,70])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(r([119,79,70,50])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(r([76,80],{offset:34})&&(r([0,0,1],{offset:8})||r([1,0,2],{offset:8})||r([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(r([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(r([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(r([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(r([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(r([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(r([37,33]))return{ext:"ps",mime:"application/postscript"};if(r([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(r([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(r([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(r([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(r([77,83,67,70])||r([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(r([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(r([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(r([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(r([31,160])||r([31,157]))return{ext:"Z",mime:"application/x-compress"};if(r([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(r([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(r([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(r([71],{offset:4})&&(r([71],{offset:192})||r([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(r([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(r([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(r([0,0,0,12,106,80,32,32,13,10,135,10])){if(r([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(r([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(r([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(r([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(r([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(i("<?xml "))return{ext:"xml",mime:"application/xml"};if(r([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(r([102,116,121,112],{offset:4})){if(r([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(r([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(r([104,101,105,99],{offset:8})||r([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(r([104,101,118,99],{offset:8})||r([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return r([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:r([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:r([77,80,43])||r([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:r([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:r([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:r([212,195,178,161])||r([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const t=new stream.PassThrough,e=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{t.fileType=fileType(e)}catch(t){reject(t)}readableStream.unshift(e),stream.pipeline?resolve(stream.pipeline(readableStream,t,()=>{})):resolve(readableStream.pipe(t))})})})),fileType_2=fileType_1.stream;const imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=t=>{const e=fileType_1(t);return imageExts.has(e&&e.ext)?e:null};var imageType_1=imageType,default_1=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType_1.minimumBytes}),imageType_1.default=default_1,function(t){if(t.TextEncoder&&t.TextDecoder)return!1;function e(t="utf-8"){if("utf-8"!==t)throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${t}') is invalid.`)}function r(t="utf-8",e={fatal:!1}){if("utf-8"!==t)throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${t}') is invalid.`);if(e.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let r=0;const i=t.length;let n=0,a=Math.max(32,i+(i>>1)+7),o=new Uint8Array(a>>3<<3);for(;r<i;){let e=t.charCodeAt(r++);if(e>=55296&&e<=56319){if(r<i){const i=t.charCodeAt(r);56320==(64512&i)&&(++r,e=((1023&e)<<10)+(1023&i)+65536)}if(e>=55296&&e<=56319)continue}if(n+4>o.length){a+=8,a*=1+r/t.length*2,a=a>>3<<3;const e=new Uint8Array(a);e.set(o),o=e}if(0!=(4294967168&e)){if(0==(4294965248&e))o[n++]=e>>6&31|192;else if(0==(4294901760&e))o[n++]=e>>12&15|224,o[n++]=e>>6&63|128;else{if(0!=(4292870144&e))continue;o[n++]=e>>18&7|240,o[n++]=e>>12&63|128,o[n++]=e>>6&63|128}o[n++]=63&e|128}else o[n++]=e}return o.slice(0,n)},Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(r.prototype,"fatal",{value:!1}),Object.defineProperty(r.prototype,"ignoreBOM",{value:!1}),r.prototype.decode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const r=new Uint8Array(t);let i=0;const n=r.length,a=[];for(;i<n;){const t=r[i++];if(0===t)break;if(0==(128&t))a.push(t);else if(192==(224&t)){const e=63&r[i++];a.push((31&t)<<6|e)}else if(224==(240&t)){const e=63&r[i++],n=63&r[i++];a.push((31&t)<<12|e<<6|n)}else if(240==(248&t)){let e=(7&t)<<18|(63&r[i++])<<12|(63&r[i++])<<6|63&r[i++];e>65535&&(e-=65536,a.push(e>>>10&1023|55296),e=56320|1023&e),a.push(e)}}return String.fromCharCode.apply(null,a)},t.TextEncoder=e,t.TextDecoder=r}("undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0);const decoder$2=new TextDecoder("utf-8");function decode$6(t){return decoder$2.decode(t)}const encoder$2=new TextEncoder;function encode$4(t){return encoder$2.encode(t)}const defaultByteLength$3=8192;class IOBuffer$3{constructor(t=defaultByteLength$3,e={}){let r=!1;"number"==typeof t?t=new ArrayBuffer(t):(r=!0,this.lastWrittenByte=t.byteLength);const i=e.offset?e.offset>>>0:0,n=t.byteLength-i;let a=i;(ArrayBuffer.isView(t)||t instanceof IOBuffer$3)&&(t.byteLength!==t.buffer.byteLength&&(a=t.byteOffset+i),t=t.buffer),this.lastWrittenByte=r?n:0,this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=a,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,a,n),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const e=2*(this.offset+t),r=new Uint8Array(e);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){const e=new Uint8Array(t);for(let r=0;r<t;r++)e[r]=this.readByte();return e}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let r=0;r<t;r++)e+=this.readChar();return e}readUtf8(t=1){return decode$6(this.readBytes(t))}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(encode$4(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}const tagsById$3={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$3={};for(let t in tagsById$3)tagsByName$3[tagsById$3[t]]=Number(t);var standard$1=Object.freeze({__proto__:null,tagsById:tagsById$3,tagsByName:tagsByName$3});const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(let t in tagsById$4)tagsByName$4[tagsById$4[t]]=Number(t);var exif$1=Object.freeze({__proto__:null,tagsById:tagsById$4,tagsByName:tagsByName$4});const tagsById$5={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$5={};for(let t in tagsById$5)tagsByName$5[tagsById$5[t]]=Number(t);var gps$1=Object.freeze({__proto__:null,tagsById:tagsById$5,tagsByName:tagsByName$5});const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};class IFD$1{constructor(t){if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if("number"==typeof t)return this.fields.get(t);if("string"==typeof t)return this.fields.get(tags$1[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=tags$1[this.kind].tagsById;for(let e of this.fields.keys())t[e]&&(this._map[t[e]]=this.fields.get(e));this._hasMap=!0}return this._map}}let types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);function getByteLength$1(t,e){const r=types$1.get(t);if(!r)throw new Error("type not found: "+t);return r[0]*e}function readData$1(t,e,r){const i=types$1.get(e);if(!i)throw new Error("type not found: "+e);return i[1](t,r)}function readByte$1(t,e){if(1===e)return t.readUint8();let r=new Uint8Array(e);for(let i=0;i<e;i++)r[i]=t.readUint8();return r}function readASCII$1(t,e){let r=[],i="";for(let n=0;n<e;n++){let e=String.fromCharCode(t.readUint8());"\0"===e?(r.push(i),i=""):i+=e}return 1===r.length?r[0]:r}function readShort$1(t,e){if(1===e)return t.readUint16();let r=new Uint16Array(e);for(let i=0;i<e;i++)r[i]=t.readUint16();return r}function readLong$1(t,e){if(1===e)return t.readUint32();let r=new Uint32Array(e);for(let i=0;i<e;i++)r[i]=t.readUint32();return r}function readRational$1(t,e){if(1===e)return t.readUint32()/t.readUint32();let r=new Array(e);for(let i=0;i<e;i++)r[i]=t.readUint32()/t.readUint32();return r}function readSByte$1(t,e){if(1===e)return t.readInt8();let r=new Int8Array(e);for(let i=0;i<e;i++)r[i]=t.readInt8();return r}function readSShort$1(t,e){if(1===e)return t.readInt16();let r=new Int16Array(e);for(let i=0;i<e;i++)r[i]=t.readInt16();return r}function readSLong$1(t,e){if(1===e)return t.readInt32();let r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.readInt32();return r}function readSRational$1(t,e){if(1===e)return t.readInt32()/t.readInt32();let r=new Array(e);for(let i=0;i<e;i++)r[i]=t.readInt32()/t.readInt32();return r}function readFloat$1(t,e){if(1===e)return t.readFloat32();let r=new Float32Array(e);for(let i=0;i<e;i++)r[i]=t.readFloat32();return r}function readDouble$1(t,e){if(1===e)return t.readFloat64();let r=new Float64Array(e);for(let i=0;i<e;i++)r[i]=t.readFloat64();return r}const dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd$1 extends IFD$1{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let t=new Date,e=dateTimeRegex$1.exec(this.dateTime);if(null===e)throw new Error("invalid dateTime: "+this.dateTime);return t.setFullYear(Number(e[1]),Number(e[2])-1,Number(e[3])),t.setHours(Number(e[4]),Number(e[5]),Number(e[6])),t}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,e=this.get(320);if(!e)return;if(e.length!==3*t)throw new Error("ColorMap size must be "+t);const r=[];for(let i=0;i<t;i++)r.push([e[i],e[i+t],e[i+2*t]]);return r}}function alwaysArray$1(t){return"number"==typeof t?[t]:t}const defaultOptions$1={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder$1 extends IOBuffer$3{constructor(t){super(t),this._nextIFD=0}get isMultiPage(){let t=0;for(this.decodeHeader();this._nextIFD;)if(t++,this.decodeIFD({ignoreImageData:!0},!0),2===t)return!0;if(1===t)return!1;throw unsupported$1("ifdCount",t)}get pageCount(){let t=0;for(this.decodeHeader();this._nextIFD;)t++,this.decodeIFD({ignoreImageData:!0},!0);if(t>0)return t;throw unsupported$1("ifdCount",t)}decode(t={}){t=Object.assign({},defaultOptions$1,t);const e=[];for(this.decodeHeader();this._nextIFD;)if(e.push(this.decodeIFD(t,!0)),t.onlyFirst)return[e[0]];return e}decodeHeader(){const t=this.readUint16();if(18761===t)this.setLittleEndian();else{if(19789!==t)throw new Error("invalid byte order: 0x"+t.toString(16));this.setBigEndian()}if(42!==this.readUint16())throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t,e){let r;if(this.seek(this._nextIFD),e)r=new TiffIfd$1;else{if(!t.kind)throw new Error("kind is missing");r=new IFD$1(t.kind)}const i=this.readUint16();for(let t=0;t<i;t++)this.decodeIFDEntry(r);if(!t.ignoreImageData){if(!(r instanceof TiffIfd$1))throw new Error("must be a tiff ifd");this.decodeImageData(r)}return this._nextIFD=this.readUint32(),r}decodeIFDEntry(t){const e=this.offset,r=this.readUint16(),i=this.readUint16(),n=this.readUint32();if(i<1||i>12)return void this.skip(4);getByteLength$1(i,n)>4&&this.seek(this.readUint32());const a=readData$1(this,i,n);if(t.fields.set(r,a),34665===r||34853===r){let e=this.offset,i="exif";34665===r?i="exif":34853===r&&(i="gps"),this._nextIFD=a,t[i]=this.decodeIFD({kind:i,ignoreImageData:!0},!1),this.offset=e}this.seek(e),this.skip(12)}decodeImageData(t){const e=t.orientation;if(e&&1!==e)throw unsupported$1("orientation",e);switch(t.type){case 0:case 1:case 2:case 3:this.readStripData(t);break;default:throw unsupported$1("image type",t.type)}if(0===t.type){const e=validateBitDepth$1(t.bitsPerSample),r=Math.pow(2,e)-1;for(let e=0;e<t.data.length;e++)t.data[e]=r-t.data[e]}}readStripData(t){const e=t.width,r=t.height,i=validateBitDepth$1(t.bitsPerSample),n=t.sampleFormat,a=e*r,o=getDataArray$1(a,1,i,n),s=t.compression,h=t.rowsPerStrip*e,l=t.stripOffsets,u=t.stripByteCounts;let f=a,c=0;for(let t=0;t<l.length;t++){let e=new DataView(this.buffer,l[t],u[t]),r=f>h?h:f;switch(f-=r,s){case 1:c=this.fillUncompressed(i,n,o,e,c,r);break;case 5:throw unsupported$1("Compression","LZW");case 2:case 32773:throw unsupported$1("Compression",s);default:throw new Error("invalid compression: "+s)}}t.data=o}fillUncompressed(t,e,r,i,n,a){if(8===t)return fill8bit$1(r,i,n,a);if(16===t)return fill16bit$1(r,i,n,a,this.isLittleEndian());if(32===t&&3===e)return fillFloat32$1(r,i,n,a,this.isLittleEndian());throw unsupported$1("bitDepth",t)}}function getDataArray$1(t,e,r,i){if(8===r)return new Uint8Array(t*e);if(16===r)return new Uint16Array(t*e);if(32===r&&3===i)return new Float32Array(t*e);throw unsupported$1("bit depth / sample format",`${r} / ${i}`)}function fill8bit$1(t,e,r,i){for(let n=0;n<i;n++)t[r++]=e.getUint8(n);return r}function fill16bit$1(t,e,r,i,n){for(let a=0;a<2*i;a+=2)t[r++]=e.getUint16(a,n);return r}function fillFloat32$1(t,e,r,i,n){for(let a=0;a<4*i;a+=4)t[r++]=e.getFloat32(a,n);return r}function unsupported$1(t,e){return new Error(`Unsupported ${t}: ${e}`)}function validateBitDepth$1(t){if("number"!=typeof t){const e=t;t=e[0];for(let r=0;r<e.length;r++)if(e[r]!==t)throw unsupported$1("bit depth",e)}return t}function decodeTIFF(t,e){return new TIFFDecoder$1(t).decode(e)}function matchAndCrop(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.algorithm,r=void 0===e?"matchToPrevious":e,i=t.ignoreBorder,n=void 0===i?[0,0]:i;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});var a="matchToPrevious"===r,o=this[0],s=[];s[0]={position:[0,0],image:this[0]};for(var h=[0,0],l=1;l<this.length;l++){var u=o.getBestMatch(this[l],{border:n});s[l]={position:[u[0]+h[0],u[1]+h[1]],image:this[l]},a&&(h[0]+=u[0],h[1]+=u[1],o=this[l])}for(var f=0,c=0,d=0,m=0,g=0;g<s.length;g++){var p=s[g];p.position[0]>f&&(f=p.position[0]),p.position[0]<c&&(c=p.position[0]),p.position[1]>d&&(d=p.position[1]),p.position[1]<m&&(m=p.position[1])}c=0-c,m=0-m;for(var w=0;w<s.length;w++){var v=s[w];v.crop=v.image.crop({x:f-v.position[0],y:d-v.position[1],width:o.width-c-f,height:o.height-m-d})}for(var _=[],b=0;b<s.length;b++)_[b]=s[b].crop;return new Stack(_)}function min(){this.checkProcessable("min",{bitDepth:[8,16]});for(var t=this[0].min,e=1;e<this.length;e++)for(var r=0;r<t.length;r++)t[r]=Math.min(t[r],this[e].min[r]);return t}function max(){this.checkProcessable("min",{bitDepth:[8,16]});for(var t=this[0].max,e=1;e<this.length;e++)for(var r=0;r<t.length;r++)t[r]=Math.max(t[r],this[e].max[r]);return t}function median(t){var e=t.reduce((t,e)=>t+e);if(0===e)throw new Error("unreachable");for(var r,i=0,n=0,a=e/2;;){if(t[i]>0){if(void 0!==r)return(r+i)/2;if((n+=t[i])>a)return i;n===a&&(r=i)}i++}}function mean(t){for(var e=0,r=0,i=0;i<t.length;i++)e+=t[i],r+=t[i]*i;return 0===e?0:r/e}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});for(var t=this.getHistograms({maxSlots:this[0].maxValue+1}),e=new Array(t.length),r=0;r<t.length;r++){var i=t[r];e[r]=median(i)}return e}function histogram(t){this.checkProcessable("min",{bitDepth:[8,16]});for(var e=this[0].getHistogram(t),r=1;r<this.length;r++)for(var i=this[r].getHistogram(t),n=0;n<e.length;n++)e[n]+=i[n];return e}function histograms(t){this.checkProcessable("min",{bitDepth:[8,16]});for(var e=this[0].getHistograms(t),r=e[0].length,i=1;i<this.length;i++)for(var n=this[i].getHistograms(t),a=0;a<e.length;a++)for(var o=0;o<r;o++)e[a][o]+=n[a][o];return e}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});for(var t=new Uint32Array(this[0].data.length),e=0;e<this.length;e++)for(var r=this[e],i=0;i<this[0].data.length;i++)t[i]+=r.data[i];for(var n=Image.createFrom(this[0]),a=n.data,o=0;o<this[0].data.length;o++)a[o]=t[o]/this.length;return n}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});var t=Image.createFrom(this[0]);for(var e of(t.data.fill(0),this))for(var r=0;r<t.data.length;r++)t.data[r]=Math.max(e.data[r],t.data[r]);return t}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});var t=Image.createFrom(this[0]);for(var e of(t.data.fill(t.maxValue),this))for(var r=0;r<t.data.length;r++)t.data[r]=Math.min(e.data[r],t.data[r]);return t}function extend(t){t.extendMethod("matchAndCrop",matchAndCrop),t.extendMethod("getMin",min),t.extendMethod("getMax",max),t.extendMethod("getMedian",median$1),t.extendMethod("getHistogram",histogram),t.extendMethod("getHistograms",histograms),t.extendMethod("getAverage",averageImage),t.extendMethod("getAverageImage",averageImage),t.extendMethod("getMaxImage",maxImage),t.extendMethod("getMinImage",minImage)}var computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(t){if(Array.isArray(t)){super(t.length);for(var e=0;e<t.length;e++)this[e]=t[e]}else"number"==typeof t?super(t):super();this.computed=null}static load(t){return Promise.all(t.map(Image.load)).then(t=>new Stack(t))}static extendMethod(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.inPlace,n=void 0!==i&&i,a=r.returnThis,o=void 0===a||a,s=r.partialArgs,h=void 0===s?[]:s;return Stack.prototype[t]=n?function(){this.computed=null;for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var n=e.apply(this,[...h,...r]);return o?this:n}:function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e.apply(this,[...h,...r])},Stack}static extendProperty(t,e){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).partialArgs,i=void 0===r?[]:r;return computedPropertyDescriptor$1.get=function(){if(null===this.computed)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];var r=e.apply(this,i);return this.computed[t]=r,r},Object.defineProperty(Stack.prototype,t,computedPropertyDescriptor$1),Stack}checkProcessable(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof t)throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(0===this.size)throw new TypeError(`The process: ${t} can not be applied on an empty stack`);this[0].checkProcessable(t,e);for(var r=1;r<this.length;r++){if((void 0===e.sameSize||e.sameSize)&&this[0].width!==this[r].width)throw new TypeError(`The process: ${t} can not be applied if width is not identical in all images`);if((void 0===e.sameSize||e.sameSize)&&this[0].height!==this[r].height)throw new TypeError(`The process: ${t} can not be applied if height is not identical in all images`);if((void 0===e.sameAlpha||e.sameAlpha)&&this[0].alpha!==this[r].alpha)throw new TypeError(`The process: ${t} can not be applied if alpha is not identical in all images`);if((void 0===e.sameBitDepth||e.sameBitDepth)&&this[0].bitDepth!==this[r].bitDepth)throw new TypeError(`The process: ${t} can not be applied if bitDepth is not identical in all images`);if((void 0===e.sameColorModel||e.sameColorModel)&&this[0].colorModel!==this[r].colorModel)throw new TypeError(`The process: ${t} can not be applied if colorModel is not identical in all images`);if((void 0===e.sameNumberChannels||e.sameNumberChannels)&&this[0].channels!==this[r].channels)throw new TypeError(`The process: ${t} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(t,e){if("function"!=typeof t)throw new TypeError(t+" is not a function");for(var r=new Stack(this.length),i=0;i<this.length;i++)r[i]=t.call(e,this[i],i,this);return r}),extend(Stack);var isDataURL=/^data:[a-z]+\/([a-z]+);base64,/;function load(t,e){if("string"==typeof t)return loadURL(t,e);if(t instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(t)));if(t.buffer)return Promise.resolve(loadBinary(t));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(t,e){var r=imageType_1(t);if(r)switch(r.mime){case"image/png":return loadPNG(t);case"image/jpeg":return loadJPEG(t);case"image/tiff":return loadTIFF(t);default:return loadGeneric(i(r.mime))}return loadGeneric(i("application/octet-stream"));function i(r){return e||toBase64URL(t,r)}}function loadURL(t,e){var r=t.slice(0,64).match(isDataURL);return(null!==r?Promise.resolve(decode$1(t.slice(r[0].length))):fetchBinary(t,e)).then(e=>loadBinary(new Uint8Array(e),r?t:void 0))}function loadPNG(t){var e,r=decodePNG(t),i=r.channels,n=0;return 2===i||4===i?(e=i-1,n=1):e=i,r.palette?loadPNGFromPalette(r):new Image(r.width,r.height,r.data,{components:e,alpha:n,bitDepth:r.depth})}function loadPNGFromPalette(t){for(var e=t.width*t.height,r=t.palette[0].length,i=new Uint8Array(e*r),n=8/t.depth,a=t.depth<8?n:1,o=parseInt("1".repeat(t.depth),2),s=4===r,h=0,l=0;l<e;l++){var u=Math.floor(l/a),f=t.data[u];t.depth<8&&(f=f>>>t.depth*(n-1-l%n)&o);var c=t.palette[f];i[h++]=c[0],i[h++]=c[1],i[h++]=c[2],s&&(i[h++]=c[3])}return new Image(t.width,t.height,i,{components:3,alpha:s,bitDepth:8})}function loadJPEG(t){var e,r=decode$5(t);r.exif&&(e=getMetadata(r.exif));var i=jpegJs_2(t,{useTArray:!0});return new Image(i.width,i.height,i.data,{meta:e})}function loadTIFF(t){var e=decodeTIFF(t);return 1===e.length?getImageFromIFD(e[0]):new Stack(e.map(getImageFromIFD))}function getMetadata(t){var e={tiff:t};return t.exif&&(e.exif=t.exif),t.gps&&(e.gps=t.gps),e}function getImageFromIFD(t){if(3===t.type){for(var e=new Uint16Array(3*t.width*t.height),r=t.palette,i=0,n=0;n<t.data.length;n++){var a=r[t.data[n]];e[i++]=a[0],e[i++]=a[1],e[i++]=a[2]}return new Image(t.width,t.height,e,{components:3,alpha:0,colorModel:RGB,bitDepth:16,meta:getMetadata(t)})}return new Image(t.width,t.height,t.data,{components:1,alpha:0,colorModel:GREY,bitDepth:t.bitsPerSample.length?t.bitsPerSample[0]:t.bitsPerSample,meta:getMetadata(t)})}function loadGeneric(t,e){return e=e||{},new Promise((function(r,i){var n=new DOMImage;n.onload=function(){var t=n.width,i=n.height,a=createCanvas(t,i).getContext("2d");a.drawImage(n,0,0,t,i);var o=a.getImageData(0,0,t,i).data;r(new Image(t,i,o,e))},n.onerror=function(){i(new Error("Could not load "+t))},n.src=t}))}var valueMethods={getValueXY(t,e,r){return this.data[(e*this.width+t)*this.channels+r]},setValueXY(t,e,r,i){return this.data[(e*this.width+t)*this.channels+r]=i,this.computed=null,this},getValue(t,e){return this.data[t*this.channels+e]},setValue(t,e,r){return this.data[t*this.channels+e]=r,this.computed=null,this},getPixelXY(t,e){return this.getPixel(e*this.width+t)},setPixelXY(t,e,r){return this.setPixel(e*this.width+t,r)},getPixel(t){for(var e=new Array(this.channels),r=t*this.channels,i=0;i<this.channels;i++)e[i]=this.data[r+i];return e},setPixel(t,e){for(var r=t*this.channels,i=0;i<e.length;i++)this.data[r+i]=e[i];return this.computed=null,this}};function setValueMethods(t){for(var e in valueMethods)t.prototype[e]=valueMethods[e]}function getImageParameters(t){return{width:t.width,height:t.height,components:t.components,alpha:t.alpha,colorModel:t.colorModel,bitDepth:t.bitDepth}}function getOutputImage(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=e.out;if(void 0===n)return i.copy?t.clone():Image.createFrom(t,r);if(!Image.isImage(n))throw new TypeError("out must be an Image object");var a=Object.assign(getImageParameters(t),r);for(var o in a)if(n[o]!==a[o])throw new RangeError(`cannot use out. Its ${o} must be "${a[o]}" (found "${n[o]}")`);return n}function getOutputImageOrInPlace(t,e,r){if(void 0!==e.inPlace&&"boolean"!=typeof e.inPlace)throw new TypeError("inPlace option must be a boolean");if(e.inPlace){if(void 0!==e.out)throw new TypeError("out option must not be set if inPlace option is true");return t}return getOutputImage(t,e,null,r)}function abs(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.checkProcessable("abs",{bitDepth:[32]});var e=getOutputImageOrInPlace(this,t);return absolute(this,e),e}function absolute(t,e){for(var r=0;r<t.data.length;r++)e.data[r]=Math.abs(t.data[r])}function copyAlphaChannel(t,e){if(1===t.alpha&&1===e.alpha)for(var r=0;r<t.size;r++)e.data[r*e.channels+e.components]=t.data[r*t.channels+t.components]}function invert(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.checkProcessable("invert",{bitDepth:[1,8,16]});var e=getOutputImageOrInPlace(this,t);return 1===this.bitDepth?invertBinary(this,e):(invertColor(this,e),this!==e&&copyAlphaChannel(this,e)),e}function invertBinary(t,e){for(var r=0;r<t.data.length;r++)e.data[r]=~t.data[r]}function invertColor(t,e){for(var r=0;r<t.data.length;r+=t.channels)for(var i=0;i<t.components;i++)e.data[r+i]=t.maxValue-t.data[r+i]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(var t=0;t<this.height;t++)for(var e=t*this.width*this.channels,r=0;r<Math.floor(this.width/2);r++)for(var i=r*this.channels+e,n=(this.width-r-1)*this.channels+e,a=0;a<this.channels;a++){var o=this.data[i+a];this.data[i+a]=this.data[n+a],this.data[n+a]=o}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(var t=0;t<Math.floor(this.height/2);t++)for(var e=0;e<this.width;e++)for(var r=e*this.channels+t*this.width*this.channels,i=e*this.channels+(this.height-1-t)*this.channels*this.width,n=0;n<this.channels;n++){var a=this.data[r+n];this.data[r+n]=this.data[i+n],this.data[i+n]=a}return this}function blurFilter(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.radius,r=void 0===e?1:e;if(r<1)throw new Error("radius must be greater than 1");for(var i=2*r+1,n=new Array(i),a=0;a<i;a++){n[a]=new Array(i);for(var o=0;o<i;o++)n[a][o]=1/(i*i)}return this.convolution(n)}function assertNumber(t){if("number"!=typeof t)throw new TypeError("Expected a number")}var ascending=(t,e)=>(assertNumber(t),assertNumber(e),Number.isNaN(t)?-1:Number.isNaN(e)?1:t-e);function validateArrayOfChannels(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.channels,i=e.allowAlpha,n=e.defaultAlpha;return"boolean"!=typeof i&&(i=!0),void 0===r?allChannels(t,n):validateChannels(t,r,i)}function allChannels(t,e){for(var r=e?t.channels:t.components,i=new Array(r),n=0;n<r;n++)i[n]=n;return i}function validateChannels(t,e,r){Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++)e[i]=validateChannel(t,e[i],r);return e}function validateChannel(t,e){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(void 0===e)throw new RangeError("validateChannel : the channel has to be >=0 and <"+t.channels);if("string"==typeof e){switch(t.colorModel){case GREY:break;case RGB:if("rgb".includes(e))switch(e){case"r":e=0;break;case"g":e=1;break;case"b":e=2}break;case HSL:if("hsl".includes(e))switch(e){case"h":e=0;break;case"s":e=1;break;case"l":e=2}break;case HSV:if("hsv".includes(e))switch(e){case"h":e=0;break;case"s":e=1;break;case"v":e=2}break;case CMYK:if("cmyk".includes(e))switch(e){case"c":e=0;break;case"m":e=1;break;case"y":e=2;break;case"k":e=3}break;default:throw new Error("Unexpected color model: "+t.colorModel)}if("a"===e){if(!t.alpha)throw new Error("validateChannel : the image does not contain alpha channel");e=t.components}if("string"==typeof e)throw new Error("validateChannel : undefined channel: "+e)}if(e>=t.channels)throw new RangeError("validateChannel : the channel has to be >=0 and <"+t.channels);if(!r&&e>=t.components)throw new RangeError("validateChannel : alpha channel may not be selected");return e}function medianFilter(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.radius,r=void 0===e?1:e,i=t.border,n=void 0===i?"copy":i,a=t.channels;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),r<1)throw new Error("radius must be greater than 0");a=validateArrayOfChannels(this,a,!0);for(var o=r,s=r,h=Image.createFrom(this),l=(2*o+1)*(2*s+1),u=Math.floor(l/2),f=new Array(l),c=0;c<a.length;c++)for(var d=a[c],m=s;m<this.height-s;m++)for(var g=o;g<this.width-o;g++){for(var p=0,w=-s;w<=s;w++)for(var v=-o;v<=o;v++){var _=((m+w)*this.width+g+v)*this.channels+d;f[p++]=this.data[_]}var b=(m*this.width+g)*this.channels+d,y=f.sort(ascending)[u];h.data[b]=y}if(this.alpha&&!a.includes(this.channels))for(var M=this.components;M<this.data.length;M+=this.channels)h.data[M]=this.data[M];return h.setBorder({size:[o,s],algorithm:n}),h}function gaussianFilter(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.radius,r=void 0===e?1:e,i=t.sigma,n=t.channels,a=t.border,o=void 0===a?"copy":a;this.checkProcessable("gaussian",{bitDepth:[8,16]});var s=getKernel(r,i);return this.convolution([s,s],{border:o,channels:n,algorithm:"separable"})}function getKernel(t,e){for(var r=2*t+1,i=new Array(r),n=e||.3*(.5*(r-1)-1)+.8,a=-.5/(n*n),o=0,s=0;s<r;s++){var h=s-t,l=Math.exp(a*h*h);i[s]=l,o+=l}for(var u=0;u<r;u++)i[u]/=o;return i}var DISCRETE_LAPLACE_4=[[0,1,0],[1,-4,1],[0,1,0]],DISCRETE_LAPLACE_8=[[1,1,1],[1,-8,1],[1,1,1]],SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]],SECOND_DERIVATIVE=[[-1,-2,0,2,1],[-2,-4,0,4,2],[0,0,0,0,0],[1,2,0,-2,-1],[2,4,0,-4,-2]],SECOND_DERIVATIVE_INV=[[1,2,0,-2,-1],[2,4,0,-4,-2],[0,0,0,0,0],[-2,-4,0,4,2],[-1,-2,0,2,1]],fftlib=createCommonjsModule((function(t,e){(function(){var t,r="0.3.0",i="2013-03";(t=e).toString=function(){return"version "+r+", released "+i};for(var n=0,a=null,o=null,s={init:function(t){if(0===t||0!=(t&t-1))throw new Error("init: radix-2 required");n=t,s._initArray(),s._makeBitReversalTable(),s._makeCosSinTable()},fft1d:function(t,e){s.fft(t,e,1)},ifft1d:function(t,e){var r=1/n;s.fft(t,e,-1);for(var i=0;i<n;i++)t[i]*=r,e[i]*=r},bt1d:function(t,e){s.fft(t,e,-1)},fft2d:function(t,e){for(var r=[],i=[],a=0,o=0;o<n;o++){a=o*n;for(var h=0;h<n;h++)r[h]=t[h+a],i[h]=e[h+a];s.fft1d(r,i);for(var l=0;l<n;l++)t[l+a]=r[l],e[l+a]=i[l]}for(var u=0;u<n;u++){for(var f=0;f<n;f++)a=u+f*n,r[f]=t[a],i[f]=e[a];s.fft1d(r,i);for(var c=0;c<n;c++)t[a=u+c*n]=r[c],e[a]=i[c]}},ifft2d:function(t,e){for(var r=[],i=[],a=0,o=0;o<n;o++){a=o*n;for(var h=0;h<n;h++)r[h]=t[h+a],i[h]=e[h+a];s.ifft1d(r,i);for(var l=0;l<n;l++)t[l+a]=r[l],e[l+a]=i[l]}for(var u=0;u<n;u++){for(var f=0;f<n;f++)a=u+f*n,r[f]=t[a],i[f]=e[a];s.ifft1d(r,i);for(var c=0;c<n;c++)t[a=u+c*n]=r[c],e[a]=i[c]}},fft:function(t,e,r){for(var i,s,h,l,u,f,c,d,m,g=n>>2,p=0;p<n;p++)p<(l=a[p])&&(u=t[p],t[p]=t[l],t[l]=u,u=e[p],e[p]=e[l],e[l]=u);for(var w=1;w<n;w<<=1){s=0,i=n/(w<<1);for(var v=0;v<w;v++){f=o[s+g],c=r*o[s];for(var _=v;_<n;_+=w<<1)d=f*t[h=_+w]+c*e[h],m=f*e[h]-c*t[h],t[h]=t[_]-d,t[_]+=d,e[h]=e[_]-m,e[_]+=m;s+=i}}},_initArray:function(){a="undefined"!=typeof Uint32Array?new Uint32Array(n):[],o="undefined"!=typeof Float64Array?new Float64Array(1.25*n):[]},_paddingZero:function(){},_makeBitReversalTable:function(){var t=0,e=0,r=0;for(a[0]=0;++t<n;){for(r=n>>1;r<=e;)e-=r,r>>=1;e+=r,a[t]=e}},_makeCosSinTable:function(){var t=n>>1,e=n>>2,r=n>>3,i=t+e,a=Math.sin(Math.PI/n),s=2*a*a,h=Math.sqrt(s*(2-s)),l=o[e]=1,u=o[0]=0;a=2*s;for(var f=1;f<r;f++)s+=a*(l-=s),h-=a*(u+=h),o[f]=u,o[e-f]=l;0!==r&&(o[r]=Math.sqrt(.5));for(var c=0;c<e;c++)o[t-c]=o[c];for(var d=0;d<i;d++)o[d+t]=-o[d]}},h=["init","fft1d","ifft1d","fft2d","ifft2d"],l=0;l<h.length;l++)t[h[l]]=s[h[l]];return t.bt=s.bt1d,t.fft=s.fft1d,t.ifft=s.ifft1d,t}).call(commonjsGlobal)})),FFTUtils={DEBUG:!1,ifft2DArray:function(t,e,r){var i=new Array(e*r),n=e/2,a=2*(r-1);fftlib.init(n);for(var o={re:new Array(n),im:new Array(n)},s=0;s<r;s++){for(var h=n-1;h>=0;h--)o.re[h]=t[2*h*r+s],o.im[h]=t[(2*h+1)*r+s];fftlib.bt(o.re,o.im);for(h=n-1;h>=0;h--)i[2*h*r+s]=o.re[h],i[(2*h+1)*r+s]=o.im[h]}var l=new Array(n*a);fftlib.init(a);var u={re:new Array(a),im:new Array(a)},f=a*n;for(h=0;h<e;h+=2){u.re[0]=i[h*r],u.im[0]=i[(h+1)*r];for(s=1;s<r;s++)u.re[s]=i[h*r+s],u.im[s]=i[(h+1)*r+s],u.re[a-s]=i[h*r+s],u.im[a-s]=-i[(h+1)*r+s];fftlib.bt(u.re,u.im);var c=h/2*a;for(s=a-1;s>=0;s--)l[c+s]=u.re[s]/f}return l},fft2DArray:function(t,e,r,i){Object.assign({},{inplace:!0});var n=r/2+1,a=2*e,o=new Array(a*n);fftlib.init(r);for(var s,h,l,u,f,c={re:new Array(r),im:new Array(r)},d={re:new Array(r),im:new Array(r)},m={re:new Array(r),im:new Array(r)},g=0;g<e/2;g++){s=2*g*r,c.re=t.slice(s,s+r),s=(2*g+1)*r,c.im=t.slice(s,s+r),fftlib.fft1d(c.re,c.im),this.reconstructTwoRealFFT(c,d,m),h=4*g*n,l=(4*g+1)*n,u=(4*g+2)*n,f=(4*g+3)*n;for(var p=n-1;p>=0;p--)o[h+p]=d.re[p],o[l+p]=d.im[p],o[u+p]=m.re[p],o[f+p]=m.im[p]}d=null,m=null;var w=new Array(a*n);fftlib.init(e);for(var v={re:new Array(e),im:new Array(e)},_=n-1;_>=0;_--){for(g=e-1;g>=0;g--)v.re[g]=o[2*g*n+_],v.im[g]=o[(2*g+1)*n+_],isNaN(v.re[g])&&(v.re[g]=0),isNaN(v.im[g])&&(v.im[g]=0);fftlib.fft1d(v.re,v.im);for(g=e-1;g>=0;g--)w[2*g*n+_]=v.re[g],w[(2*g+1)*n+_]=v.im[g]}return w},reconstructTwoRealFFT:function(t,e,r){var i,n,a,o,s,h=t.re.length;e.re[0]=t.re[0],e.im[0]=0,r.re[0]=t.im[0],r.im[0]=0;for(var l=h/2;l>0;l--)s=h-l,i=.5*(t.re[l]-t.re[s]),n=.5*(t.re[l]+t.re[s]),a=.5*(t.im[l]-t.im[s]),o=.5*(t.im[l]+t.im[s]),e.re[l]=n,e.im[l]=a,e.re[s]=n,e.im[s]=-a,r.re[l]=o,r.im[l]=-i,r.re[s]=o,r.im[s]=i},convolute2DI:function(t,e,r,i){for(var n,a,o=0;o<r/2;o++)for(var s=0;s<i;s++)n=t[2*o*i+s]*e[2*o*i+s]-t[(2*o+1)*i+s]*e[(2*o+1)*i+s],a=t[2*o*i+s]*e[(2*o+1)*i+s]+t[(2*o+1)*i+s]*e[2*o*i+s],t[2*o*i+s]=n,t[(2*o+1)*i+s]=a},convolute:function(t,e,r,i,n){for(var a=new Array(i*r),o=0;o<r*i;o++)a[o]=t[o];a=this.fft2DArray(a,r,i);var s,h=e.length,l=e[0].length,u=new Array(i*r);for(o=0;o<i*r;o++)u[o]=0;for(var f=Math.floor((h-1)/2),c=Math.floor((l-1)/2),d=0;d<h;d++){s=(d-f+r)%r;for(var m=0;m<l;m++)u[s*i+(m-c+i)%i]=e[d][m]}u=this.fft2DArray(u,r,i);var g=2*r,p=i/2+1;return this.convolute2DI(a,u,g,p),this.ifft2DArray(a,g,p)},toRadix2:function(t,e,r){var i,n,a,o,s=r,h=e;if(0===r||0!=(r&r-1)){for(s=0;r>>++s!=0;);s=1<<s}if(0===e||0!=(e&e-1)){for(h=0;e>>++h!=0;);h=1<<h}if(h==e&&s==r)return{data:t,rows:e,cols:r};var l=new Array(h*s),u=Math.floor((h-e)/2)-e,f=Math.floor((s-r)/2)-r;for(i=0;i<h;i++)for(a=i*s,o=(i-u)%e*r,n=0;n<s;n++)l[a+n]=t[o+(n-f)%r];return{data:l,rows:h,cols:s}},crop:function(t,e,r,i,n,a){if(e==i&&r==n)return t;Object.assign({},a);var o,s,h,l,u=new Array(n*i),f=Math.floor((e-i)/2),c=Math.floor((r-n)/2);for(h=0;h<i;h++)for(o=h*n,s=(h+f)*r,l=0;l<n;l++)u[o+l]=t[s+(l+c)];return u}},FFTUtils_1=FFTUtils,FFTUtils$1=FFTUtils_1,FFT=fftlib,src$1={FFTUtils:FFTUtils$1,FFT:FFT},FFTUtils$2=src$1.FFTUtils;function convolutionFFT(t,e,r){var i,n,a=matrix2Array(t),o=a.data,s=Object.assign({normalize:!1,divisor:1,rows:a.rows,cols:a.cols},r);if(!s.rows||!s.cols)throw new Error("Invalid number of rows or columns "+i+" "+n);i=s.rows,n=s.cols;var h,l,u=s.divisor,f=e.length,c=e[0].length;if(s.normalize)for(u=0,h=0;h<f;h++)for(l=0;l<c;l++)u+=e[h][l];if(0===u)throw new RangeError("convolution: The divisor is equal to zero");var d=FFTUtils$2.toRadix2(o,i,n),m=FFTUtils$2.convolute(d.data,e,d.rows,d.cols);if(m=FFTUtils$2.crop(m,d.rows,d.cols,i,n),0!=u&&1!=u)for(h=0;h<m.length;h++)m[h]/=u;return m}function convolutionDirect(t,e,r){var i,n,a=matrix2Array(t),o=a.data,s=Object.assign({normalize:!1,divisor:1,rows:a.rows,cols:a.cols},r);if(!s.rows||!s.cols)throw new Error("Invalid number of rows or columns "+i+" "+n);i=s.rows,n=s.cols;var h,l,u,f,c,d,m=s.divisor,g=e.length,p=e[0].length;if(s.normalize)for(m=0,h=0;h<g;h++)for(l=0;l<p;l++)m+=e[h][l];if(0===m)throw new RangeError("convolution: The divisor is equal to zero");var w=new Array(i*n),v=Math.floor(g/2),_=Math.floor(p/2);for(f=0;f<i;f++)for(u=0;u<n;u++){for(c=0,l=0;l<g;l++)for(h=0;h<p;h++)d=e[g-l-1][p-h-1],c+=o[(f+l-v+i)%i*n+(u+h-_+n)%n]*d;w[f*n+u]=c/m}return w}function LoG(t,e,r){var i=1e3;r&&r.factor&&(i=r.factor);var n,a,o,s,h=new Array(e);i*=-1;var l=(e-1)/2,u=2*t*t;for(n=0;n<e;n++)for(h[n]=new Array(e),s=(n-l)*(n-l),a=0;a<e;a++)o=-((a-l)*(a-l)+s)/u,h[n][a]=Math.round(i*(1+o)*Math.exp(o));return h}function matrix2Array(t){var e,r,i=t;if("number"!=typeof t[0]){e=t.length,r=t[0].length,i=new Array(e*r);for(var n=0;n<e;n++)for(var a=0;a<r;a++)i[n*r+a]=t[n][a]}else{var o=Math.sqrt(t.length);Number.isInteger(o)&&(e=o,r=o)}return{data:i,rows:e,cols:r}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG:LoG},matrix2Array:matrix2Array},src_1=src$2.fft,src_2=src$2.direct,numberIsNan=Number.isNaN||function(t){return t!=t},_isFinite=Number.isFinite||function(t){return!("number"!=typeof t||numberIsNan(t)||t===1/0||t===-1/0)},isInteger=Number.isInteger||function(t){return"number"==typeof t&&_isFinite(t)&&Math.floor(t)===t};function validateKernel(t){var e,r;if(!Array.isArray(t))throw new Error("validateKernel: Invalid Kernel: "+t);if(Array.isArray(t[0])){if(0==(1&t.length)||0==(1&t[0].length))throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");e=Math.floor(t.length/2),r=Math.floor(t[0].length/2)}else{var i=Math.sqrt(t.length);if(!isInteger(i))throw new RangeError("validateKernel: Kernel array should be a square");r=e=Math.floor(Math.sqrt(t.length)/2);for(var n=new Array(i),a=0;a<i;a++){n[a]=new Array(i);for(var o=0;o<i;o++)n[a][o]=t[a*i+o]}t=n}return{kernel:t,kWidth:r,kHeight:e}}function clamp(t,e){return Math.round(Math.min(Math.max(t,0),e.maxValue))}function directConvolution(t,e,r){if(void 0===r){const i=t.length+e.length-1;r=new Array(i)}fill(r);for(var i=0;i<t.length;i++)for(var n=0;n<e.length;n++)r[i+n]+=t[i]*e[n];return r}function fill(t){for(var e=0;e<t.length;e++)t[e]=0}function convolutionSeparable(t,e,r,i){var n,a,o,s,h=new Array(t.length);o=((s=e[1]).length-1)/2,a=new Array(r+s.length-1),n=new Array(r);for(var l=0;l<i;l++){for(var u=0;u<r;u++)n[u]=t[l*r+u];directConvolution(n,s,a);for(var f=0;f<r;f++)h[l*r+f]=a[o+f]}o=((s=e[0]).length-1)/2,a=new Array(i+s.length-1),n=new Array(i);for(var c=0;c<r;c++){for(var d=0;d<i;d++)n[d]=h[d*r+c];directConvolution(n,s,a);for(var m=0;m<i;m++)h[m*r+c]=a[o+m]}return h}const toString$2=Object.prototype.toString;function isAnyArray(t){return toString$2.call(t).endsWith("Array]")}var src$3=isAnyArray;function max$1(t){if(!src$3(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],r=1;r<t.length;r++)t[r]>e&&(e=t[r]);return e}function min$1(t){if(!src$3(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],r=1;r<t.length;r++)t[r]<e&&(e=t[r]);return e}function rescale(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!src$3(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==r.output){if(!src$3(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(t.length);var i=min$1(t),n=max$1(t);if(i===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var a=r.min,o=void 0===a?r.autoMinMax?i:0:a,s=r.max,h=void 0===s?r.autoMinMax?n:1:s;if(o>=h)throw new RangeError("min option must be smaller than max option");for(var l=(h-o)/(n-i),u=0;u<t.length;u++)e[u]=(t[u]-i)*l+o;return e}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(t,e={}){const{maxRows:r=15,maxColumns:i=10,maxNumSize:n=8}=e;return`${t.constructor.name} {\n${indent}[\n${indentData}${inspectData(t,r,i,n)}\n${indent}]\n${indent}rows: ${t.rows}\n${indent}columns: ${t.columns}\n}`}function inspectData(t,e,r,i){const{rows:n,columns:a}=t,o=Math.min(n,e),s=Math.min(a,r),h=[];for(let e=0;e<o;e++){let r=[];for(let n=0;n<s;n++)r.push(formatNumber(t.get(e,n),i));h.push(""+r.join(" "))}return s!==a&&(h[h.length-1]+=` ... ${a-r} more columns`),o!==n&&h.push(`... ${n-e} more rows`),h.join("\n"+indentData)}function formatNumber(t,e){const r=String(t);if(r.length<=e)return r.padEnd(e," ");const i=t.toPrecision(e-2);if(i.length<=e)return i;const n=t.toExponential(e-2),a=n.indexOf("e"),o=n.slice(a);return n.slice(0,e-o.length)+o}function installMathOperations(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},t.add=function(t,r){return new e(t).add(r)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},t.sub=function(t,r){return new e(t).sub(r)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},t.mul=function(t,r){return new e(t).mul(r)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},t.div=function(t,r){return new e(t).div(r)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},t.mod=function(t,r){return new e(t).mod(r)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},t.and=function(t,r){return new e(t).and(r)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},t.or=function(t,r){return new e(t).or(r)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},t.xor=function(t,r){return new e(t).xor(r)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},t.leftShift=function(t,r){return new e(t).leftShift(r)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},t.signPropagatingRightShift=function(t,r){return new e(t).signPropagatingRightShift(r)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},t.rightShift=function(t,r){return new e(t).rightShift(r)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,r){return new e(t).pow(r)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t.get(e,r)));return this}}function checkRowIndex(t,e,r){let i=r?t.rows:t.rows-1;if(e<0||e>i)throw new RangeError("Row index out of range")}function checkColumnIndex(t,e,r){let i=r?t.columns:t.columns-1;if(e<0||e>i)throw new RangeError("Column index out of range")}function checkRowVector(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function checkColumnVector(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function checkIndices(t,e,r){return{row:checkRowIndices(t,e),column:checkColumnIndices(t,r)}}function checkRowIndices(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for row indices");if(e.some(e=>e<0||e>=t.rows))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function checkColumnIndices(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for column indices");if(e.some(e=>e<0||e>=t.columns))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function checkRange(t,e,r,i,n){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",e),checkNumber("endRow",r),checkNumber("startColumn",i),checkNumber("endColumn",n),e>r||i>n||e<0||e>=t.rows||r<0||r>=t.rows||i<0||i>=t.columns||n<0||n>=t.columns)throw new RangeError("Submatrix indices are out of range")}function newArray(t,e=0){let r=[];for(let i=0;i<t;i++)r.push(e);return r}function checkNumber(t,e){if("number"!=typeof e)throw new TypeError(t+" must be a number")}function sumByRow(t){let e=newArray(t.rows);for(let r=0;r<t.rows;++r)for(let i=0;i<t.columns;++i)e[r]+=t.get(r,i);return e}function sumByColumn(t){let e=newArray(t.columns);for(let r=0;r<t.rows;++r)for(let i=0;i<t.columns;++i)e[i]+=t.get(r,i);return e}function sumAll(t){let e=0;for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)e+=t.get(r,i);return e}function productByRow(t){let e=newArray(t.rows,1);for(let r=0;r<t.rows;++r)for(let i=0;i<t.columns;++i)e[r]*=t.get(r,i);return e}function productByColumn(t){let e=newArray(t.columns,1);for(let r=0;r<t.rows;++r)for(let i=0;i<t.columns;++i)e[i]*=t.get(r,i);return e}function productAll(t){let e=1;for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)e*=t.get(r,i);return e}function varianceByRow(t,e,r){const i=t.rows,n=t.columns,a=[];for(let o=0;o<i;o++){let i=0,s=0,h=0;for(let e=0;e<n;e++)h=t.get(o,e)-r[o],i+=h,s+=h*h;e?a.push((s-i*i/n)/(n-1)):a.push((s-i*i/n)/n)}return a}function varianceByColumn(t,e,r){const i=t.rows,n=t.columns,a=[];for(let o=0;o<n;o++){let n=0,s=0,h=0;for(let e=0;e<i;e++)h=t.get(e,o)-r[o],n+=h,s+=h*h;e?a.push((s-n*n/i)/(i-1)):a.push((s-n*n/i)/i)}return a}function varianceAll(t,e,r){const i=t.rows,n=t.columns,a=i*n;let o=0,s=0,h=0;for(let e=0;e<i;e++)for(let i=0;i<n;i++)h=t.get(e,i)-r,o+=h,s+=h*h;return e?(s-o*o/a)/(a-1):(s-o*o/a)/a}function centerByRow(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)-e[r])}function centerByColumn(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)-e[i])}function centerAll(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)-e)}function getScaleByRow(t){const e=[];for(let r=0;r<t.rows;r++){let i=0;for(let e=0;e<t.columns;e++)i+=Math.pow(t.get(r,e),2)/(t.columns-1);e.push(Math.sqrt(i))}return e}function scaleByRow(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)/e[r])}function getScaleByColumn(t){const e=[];for(let r=0;r<t.columns;r++){let i=0;for(let e=0;e<t.rows;e++)i+=Math.pow(t.get(e,r),2)/(t.rows-1);e.push(Math.sqrt(i))}return e}function scaleByColumn(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)/e[i])}function getScaleAll(t){const e=t.size-1;let r=0;for(let i=0;i<t.columns;i++)for(let n=0;n<t.rows;n++)r+=Math.pow(t.get(n,i),2)/e;return Math.sqrt(r)}function scaleAll(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)/e)}class AbstractMatrix{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let i=new Matrix(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++)i.set(n,t,r[n*e+t]);return i}static rowVector(t){let e=new Matrix(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new Matrix(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new Matrix(t,e)}static ones(t,e){return new Matrix(t,e).fill(1)}static rand(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{random:i=Math.random}=r;let n=new Matrix(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)n.set(r,t,i());return n}static randInt(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{min:i=0,max:n=1e3,random:a=Math.random}=r;if(!Number.isInteger(i))throw new TypeError("min must be an integer");if(!Number.isInteger(n))throw new TypeError("max must be an integer");if(i>=n)throw new RangeError("min must be smaller than max");let o=n-i,s=new Matrix(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=i+Math.round(a()*o);s.set(r,t,e)}return s}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let i=Math.min(t,e),n=this.zeros(t,e);for(let t=0;t<i;t++)n.set(t,t,r);return n}static diag(t,e,r){let i=t.length;void 0===e&&(e=i),void 0===r&&(r=e);let n=Math.min(i,e,r),a=this.zeros(e,r);for(let e=0;e<n;e++)a.set(e,e,t[e]);return a}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,i=t.columns,n=new Matrix(r,i);for(let a=0;a<r;a++)for(let r=0;r<i;r++)n.set(a,r,Math.min(t.get(a,r),e.get(a,r)));return n}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,i=t.columns,n=new this(r,i);for(let a=0;a<r;a++)for(let r=0;r<i;r++)n.set(a,r,Math.max(t.get(a,r),e.get(a,r)));return n}static checkMatrix(t){return AbstractMatrix.isMatrix(t)?t:new Matrix(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,r=-1,i=!0,n=!1;for(;t<this.rows&&i;){for(e=0,n=!1;e<this.columns&&!1===n;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(n=!0,r=e):(i=!1,n=!0);t++}return i}isReducedEchelonForm(){let t=0,e=0,r=-1,i=!0,n=!1;for(;t<this.rows&&i;){for(e=0,n=!1;e<this.columns&&!1===n;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(n=!0,r=e):(i=!1,n=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(i=!1);t++}return i}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let i=e;for(let n=e;n<t.rows;n++)t.get(n,r)>t.get(i,r)&&(i=n);if(0===t.get(i,r))r++;else{t.swapRows(e,i);let n=t.get(e,r);for(let i=r;i<t.columns;i++)t.set(e,i,t.get(e,i)/n);for(let i=e+1;i<t.rows;i++){let n=t.get(i,r)/t.get(e,r);t.set(i,r,0);for(let a=r+1;a<t.columns;a++)t.set(i,a,t.get(i,a)-t.get(e,a)*n)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,i=r-1;for(;i>=0;)if(0===t.maxRow(i))i--;else{let n=0,a=!1;for(;n<r&&!1===a;)1===t.get(i,n)?a=!0:n++;for(let r=0;r<i;r++){let a=t.get(r,n);for(let o=n;o<e;o++){let e=t.get(r,o)-a*t.get(i,o);t.set(r,o,e)}}i--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let i=new Matrix(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)i.setSubMatrix(this,this.rows*t,this.columns*e);return i}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){checkRowIndex(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return Matrix.rowVector(this.getRow(t))}setRow(t,e){checkRowIndex(this,t),e=checkRowVector(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){checkRowIndex(this,t),checkRowIndex(this,e);for(let r=0;r<this.columns;r++){let i=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,i)}return this}getColumn(t){checkColumnIndex(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return Matrix.columnVector(this.getColumn(t))}setColumn(t,e){checkColumnIndex(this,t),e=checkColumnVector(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){checkColumnIndex(this,t),checkColumnIndex(this,e);for(let r=0;r<this.rows;r++){let i=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,i)}return this}addRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){checkRowIndex(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){checkColumnIndex(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxIndex(){let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)>t&&(t=this.get(r,i),e[0]=r,e[1]=i);return e}min(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minIndex(){let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)<t&&(t=this.get(r,i),e[0]=r,e[1]=i);return e}maxRow(t){checkRowIndex(this,t);let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){checkRowIndex(this,t);let e=this.get(t,0),r=[t,0];for(let i=1;i<this.columns;i++)this.get(t,i)>e&&(e=this.get(t,i),r[1]=i);return r}minRow(t){checkRowIndex(this,t);let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){checkRowIndex(this,t);let e=this.get(t,0),r=[t,0];for(let i=1;i<this.columns;i++)this.get(t,i)<e&&(e=this.get(t,i),r[1]=i);return r}maxColumn(t){checkColumnIndex(this,t);let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){checkColumnIndex(this,t);let e=this.get(0,t),r=[0,t];for(let i=1;i<this.rows;i++)this.get(i,t)>e&&(e=this.get(i,t),r[0]=i);return r}minColumn(t){checkColumnIndex(this,t);let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){checkColumnIndex(this,t);let e=this.get(0,t),r=[0,t];for(let i=1;i<this.rows;i++)this.get(i,t)<e&&(e=this.get(i,t),r[0]=i);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){let e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r)*this.get(t,r);return Math.sqrt(e)}throw new RangeError("unknown norm type: "+t)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){AbstractMatrix.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let i=0;i<e.length;i++)r+=e[i]*t[i];return r}mmul(t){t=Matrix.checkMatrix(t);let e=this.rows,r=this.columns,i=t.columns,n=new Matrix(e,i),a=new Float64Array(r);for(let o=0;o<i;o++){for(let e=0;e<r;e++)a[e]=t.get(e,o);for(let t=0;t<e;t++){let e=0;for(let i=0;i<r;i++)e+=this.get(t,i)*a[i];n.set(t,o,e)}}return n}strassen2x2(t){t=Matrix.checkMatrix(t);let e=new Matrix(2,2);const r=this.get(0,0),i=t.get(0,0),n=this.get(0,1),a=t.get(0,1),o=this.get(1,0),s=t.get(1,0),h=this.get(1,1),l=t.get(1,1),u=(r+h)*(i+l),f=(o+h)*i,c=r*(a-l),d=h*(s-i),m=(r+n)*l,g=u+d-m+(n-h)*(s+l),p=c+m,w=f+d,v=u-f+c+(o-r)*(i+a);return e.set(0,0,g),e.set(0,1,p),e.set(1,0,w),e.set(1,1,v),e}strassen3x3(t){t=Matrix.checkMatrix(t);let e=new Matrix(3,3);const r=this.get(0,0),i=this.get(0,1),n=this.get(0,2),a=this.get(1,0),o=this.get(1,1),s=this.get(1,2),h=this.get(2,0),l=this.get(2,1),u=this.get(2,2),f=t.get(0,0),c=t.get(0,1),d=t.get(0,2),m=t.get(1,0),g=t.get(1,1),p=t.get(1,2),w=t.get(2,0),v=t.get(2,1),_=t.get(2,2),b=(r-a)*(-c+g),y=(-r+a+o)*(f-c+g),M=(a+o)*(-f+c),x=r*f,E=(-r+h+l)*(f-d+p),A=(-r+h)*(d-p),k=(h+l)*(-f+d),S=(-n+l+u)*(g+w-v),I=(n-u)*(g-v),D=n*w,T=(l+u)*(-w+v),R=(-n+o+s)*(p+w-_),B=(n-s)*(p-_),C=(o+s)*(-w+_),P=x+D+i*m,O=(r+i+n-a-o-l-u)*g+y+M+x+S+D+T,$=x+E+k+(r+i+n-o-s-h-l)*p+D+R+C,N=b+o*(-f+c+m-g-p-w+_)+y+x+D+R+B,L=b+y+M+x+s*v,F=D+R+B+C+a*d,U=x+E+A+l*(-f+d+m-g-p-w+v)+S+I+D,Y=S+I+D+T+h*c,H=x+E+A+k+u*_;return e.set(0,0,P),e.set(0,1,O),e.set(0,2,$),e.set(1,0,N),e.set(1,1,L),e.set(1,2,F),e.set(2,0,U),e.set(2,1,Y),e.set(2,2,H),e}mmulStrassen(t){t=Matrix.checkMatrix(t);let e=this.clone(),r=e.rows,i=e.columns,n=t.rows,a=t.columns;function o(t,e,r){let i=t.rows,n=t.columns;if(i===e&&n===r)return t;{let i=AbstractMatrix.zeros(e,r);return i=i.setSubMatrix(t,0,0),i}}i!==n&&console.warn(`Multiplying ${r} x ${i} and ${n} x ${a} matrix: dimensions do not match.`);let s=Math.max(r,n),h=Math.max(i,a);return e=o(e,s,h),function t(e,r,i,n){if(i<=512||n<=512)return e.mmul(r);i%2==1&&n%2==1?(e=o(e,i+1,n+1),r=o(r,i+1,n+1)):i%2==1?(e=o(e,i+1,n),r=o(r,i+1,n)):n%2==1&&(e=o(e,i,n+1),r=o(r,i,n+1));let a=parseInt(e.rows/2,10),s=parseInt(e.columns/2,10),h=e.subMatrix(0,a-1,0,s-1),l=r.subMatrix(0,a-1,0,s-1),u=e.subMatrix(0,a-1,s,e.columns-1),f=r.subMatrix(0,a-1,s,r.columns-1),c=e.subMatrix(a,e.rows-1,0,s-1),d=r.subMatrix(a,r.rows-1,0,s-1),m=e.subMatrix(a,e.rows-1,s,e.columns-1),g=r.subMatrix(a,r.rows-1,s,r.columns-1),p=t(AbstractMatrix.add(h,m),AbstractMatrix.add(l,g),a,s),w=t(AbstractMatrix.add(c,m),l,a,s),v=t(h,AbstractMatrix.sub(f,g),a,s),_=t(m,AbstractMatrix.sub(d,l),a,s),b=t(AbstractMatrix.add(h,u),g,a,s),y=t(AbstractMatrix.sub(c,h),AbstractMatrix.add(l,f),a,s),M=t(AbstractMatrix.sub(u,m),AbstractMatrix.add(d,g),a,s),x=AbstractMatrix.add(p,_);x.sub(b),x.add(M);let E=AbstractMatrix.add(v,b),A=AbstractMatrix.add(w,_),k=AbstractMatrix.sub(p,w);k.add(v),k.add(y);let S=AbstractMatrix.zeros(2*x.rows,2*x.columns);return S=S.setSubMatrix(x,0,0),S=S.setSubMatrix(E,x.rows,0),S=S.setSubMatrix(A,0,x.columns),S=S.setSubMatrix(k,x.rows,x.columns),S.subMatrix(0,i-1,0,n-1)}(e,t=o(t,s,h),s,h)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let i=new Matrix(this.rows,this.columns);for(let t=0;t<this.rows;t++){const n=this.getRow(t);rescale(n,{min:e,max:r,output:n}),i.setRow(t,n)}return i}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let i=new Matrix(this.rows,this.columns);for(let t=0;t<this.columns;t++){const n=this.getColumn(t);rescale(n,{min:e,max:r,output:n}),i.setColumn(t,n)}return i}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),i=this.get(e,this.columns-1-r);this.set(e,r,i),this.set(e,this.columns-1-r,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),i=this.get(this.rows-1-r,e);this.set(r,e,i),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=Matrix.checkMatrix(t);let e=this.rows,r=this.columns,i=t.rows,n=t.columns,a=new Matrix(e*i,r*n);for(let o=0;o<e;o++)for(let e=0;e<r;e++)for(let r=0;r<i;r++)for(let s=0;s<n;s++)a.set(i*o+r,n*e+s,this.get(o,e)*t.get(r,s));return a}transpose(){let t=new Matrix(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=compareNumbers){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=compareNumbers){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,i){checkRange(this,t,e,r,i);let n=new Matrix(e-t+1,i-r+1);for(let a=t;a<=e;a++)for(let e=r;e<=i;e++)n.set(a-t,e-r,this.get(a,e));return n}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let i=new Matrix(t.length,r-e+1);for(let n=0;n<t.length;n++)for(let a=e;a<=r;a++){if(t[n]<0||t[n]>=this.rows)throw new RangeError("Row index out of range: "+t[n]);i.set(n,a-e,this.get(t[n],a))}return i}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let i=new Matrix(r-e+1,t.length);for(let n=0;n<t.length;n++)for(let a=e;a<=r;a++){if(t[n]<0||t[n]>=this.columns)throw new RangeError("Column index out of range: "+t[n]);i.set(a-e,n,this.get(a,t[n]))}return i}setSubMatrix(t,e,r){checkRange(this,e,e+(t=Matrix.checkMatrix(t)).rows-1,r,r+t.columns-1);for(let i=0;i<t.rows;i++)for(let n=0;n<t.columns;n++)this.set(e+i,r+n,t.get(i,n));return this}selection(t,e){let r=checkIndices(this,t,e),i=new Matrix(t.length,e.length);for(let t=0;t<r.row.length;t++){let e=r.row[t];for(let n=0;n<r.column.length;n++){let a=r.column[n];i.set(t,n,this.get(e,a))}}return i}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){let t=new Matrix(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(e,r,this.get(e,r));return t}sum(t){switch(t){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error("invalid option: "+t)}}product(t){switch(t){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error("invalid option: "+t)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error("invalid option: "+t)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:r=!0,mean:i=this.mean(t)}=e;if("boolean"!=typeof r)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Array.isArray(i))throw new TypeError("mean must be an array");return varianceByRow(this,r,i);case"column":if(!Array.isArray(i))throw new TypeError("mean must be an array");return varianceByColumn(this,r,i);case void 0:if("number"!=typeof i)throw new TypeError("mean must be a number");return varianceAll(this,r,i);default:throw new Error("invalid option: "+t)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":if(!Array.isArray(r))throw new TypeError("center must be an array");return centerByRow(this,r),this;case"column":if(!Array.isArray(r))throw new TypeError("center must be an array");return centerByColumn(this,r),this;case void 0:if("number"!=typeof r)throw new TypeError("center must be a number");return centerAll(this,r),this;default:throw new Error("invalid option: "+t)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":if(void 0===r)r=getScaleByRow(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return scaleByRow(this,r),this;case"column":if(void 0===r)r=getScaleByColumn(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return scaleByColumn(this,r),this;case void 0:if(void 0===r)r=getScaleAll(this);else if("number"!=typeof r)throw new TypeError("scale must be a number");return scaleAll(this,r),this;default:throw new Error("invalid option: "+t)}}toString(t){return inspectMatrixWithOptions(this,t)}}function compareNumbers(t,e){return t-e}AbstractMatrix.prototype.klass="Matrix","undefined"!=typeof Symbol&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix),AbstractMatrix.random=AbstractMatrix.rand,AbstractMatrix.randomInt=AbstractMatrix.randInt,AbstractMatrix.diagonal=AbstractMatrix.diag,AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag,AbstractMatrix.identity=AbstractMatrix.eye,AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg,AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;class Matrix extends AbstractMatrix{constructor(t,e){if(super(),Matrix.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>0){if(this.data=[],!(Number.isInteger(e)&&e>0))throw new TypeError("nColumns must be a positive integer");for(let r=0;r<t;r++)this.data.push(new Float64Array(e))}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const r=t;if(t=r.length,"number"!=typeof(e=r[0].length)||0===e)throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let i=0;i<t;i++){if(r[i].length!==e)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(r[i]))}}}return this.rows=t,this.columns=e,this}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){if(checkRowIndex(this,t),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),checkRowIndex(this,t,!0),e=Float64Array.from(checkRowVector(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){if(checkColumnIndex(this,t),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let i=0;i<t;i++)r[i]=this.data[e][i];for(let i=t+1;i<this.columns;i++)r[i-1]=this.data[e][i];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),checkColumnIndex(this,t,!0),e=checkColumnVector(this,e);for(let r=0;r<this.rows;r++){const i=new Float64Array(this.columns+1);let n=0;for(;n<t;n++)i[n]=this.data[r][n];for(i[n++]=e[r];n<this.columns+1;n++)i[n]=this.data[r][n-1];this.data[r]=i}return this.columns+=1,this}}installMathOperations(AbstractMatrix,Matrix);class WrapperMatrix2D extends AbstractMatrix{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}class LuDecomposition{constructor(t){let e,r,i,n,a,o,s,h,l,u=(t=WrapperMatrix2D.checkMatrix(t)).clone(),f=u.rows,c=u.columns,d=new Float64Array(f),m=1;for(e=0;e<f;e++)d[e]=e;for(h=new Float64Array(f),r=0;r<c;r++){for(e=0;e<f;e++)h[e]=u.get(e,r);for(e=0;e<f;e++){for(l=Math.min(e,r),a=0,i=0;i<l;i++)a+=u.get(e,i)*h[i];h[e]-=a,u.set(e,r,h[e])}for(n=r,e=r+1;e<f;e++)Math.abs(h[e])>Math.abs(h[n])&&(n=e);if(n!==r){for(i=0;i<c;i++)o=u.get(n,i),u.set(n,i,u.get(r,i)),u.set(r,i,o);s=d[n],d[n]=d[r],d[r]=s,m=-m}if(r<f&&0!==u.get(r,r))for(e=r+1;e<f;e++)u.set(e,r,u.get(e,r)/u.get(r,r))}this.LU=u,this.pivotVector=d,this.pivotSign=m}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(0===t.get(r,r))return!0;return!1}solve(t){t=Matrix.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r,i,n,a=t.columns,o=t.subMatrixRow(this.pivotVector,0,a-1),s=e.columns;for(n=0;n<s;n++)for(r=n+1;r<s;r++)for(i=0;i<a;i++)o.set(r,i,o.get(r,i)-o.get(n,i)*e.get(r,n));for(n=s-1;n>=0;n--){for(i=0;i<a;i++)o.set(n,i,o.get(n,i)/e.get(n,n));for(r=0;r<n;r++)for(i=0;i<a;i++)o.set(r,i,o.get(r,i)-o.get(n,i)*e.get(r,n))}return o}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let i=0;i<r;i++)e*=t.get(i,i);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,i=new Matrix(e,r);for(let n=0;n<e;n++)for(let e=0;e<r;e++)n>e?i.set(n,e,t.get(n,e)):n===e?i.set(n,e,1):i.set(n,e,0);return i}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,i=new Matrix(e,r);for(let n=0;n<e;n++)for(let e=0;e<r;e++)n<=e?i.set(n,e,t.get(n,e)):i.set(n,e,0);return i}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0!==e?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class QrDecomposition{constructor(t){let e,r,i,n,a=(t=WrapperMatrix2D.checkMatrix(t)).clone(),o=t.rows,s=t.columns,h=new Float64Array(s);for(i=0;i<s;i++){let t=0;for(e=i;e<o;e++)t=hypotenuse(t,a.get(e,i));if(0!==t){for(a.get(i,i)<0&&(t=-t),e=i;e<o;e++)a.set(e,i,a.get(e,i)/t);for(a.set(i,i,a.get(i,i)+1),r=i+1;r<s;r++){for(n=0,e=i;e<o;e++)n+=a.get(e,i)*a.get(e,r);for(n=-n/a.get(i,i),e=i;e<o;e++)a.set(e,r,a.get(e,r)+n*a.get(e,i))}}h[i]=-t}this.QR=a,this.Rdiag=h}solve(t){t=Matrix.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let i,n,a,o,s=t.columns,h=t.clone(),l=e.columns;for(a=0;a<l;a++)for(n=0;n<s;n++){for(o=0,i=a;i<r;i++)o+=e.get(i,a)*h.get(i,n);for(o=-o/e.get(a,a),i=a;i<r;i++)h.set(i,n,h.get(i,n)+o*e.get(i,a))}for(a=l-1;a>=0;a--){for(n=0;n<s;n++)h.set(a,n,h.get(a,n)/this.Rdiag[a]);for(i=0;i<a;i++)for(n=0;n<s;n++)h.set(i,n,h.get(i,n)-h.get(a,n)*e.get(i,a))}return h.subMatrix(0,l-1,0,s-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,r=this.QR,i=r.columns,n=new Matrix(i,i);for(t=0;t<i;t++)for(e=0;e<i;e++)t<e?n.set(t,e,r.get(t,e)):t===e?n.set(t,e,this.Rdiag[t]):n.set(t,e,0);return n}get orthogonalMatrix(){let t,e,r,i,n=this.QR,a=n.rows,o=n.columns,s=new Matrix(a,o);for(r=o-1;r>=0;r--){for(t=0;t<a;t++)s.set(t,r,0);for(s.set(r,r,1),e=r;e<o;e++)if(0!==n.get(r,r)){for(i=0,t=r;t<a;t++)i+=n.get(t,r)*s.get(t,e);for(i=-i/n.get(r,r),t=r;t<a;t++)s.set(t,e,s.get(t,e)+i*n.get(t,r))}}return s}}class SingularValueDecomposition{constructor(t,e={}){let r=(t=WrapperMatrix2D.checkMatrix(t)).rows,i=t.columns;const{computeLeftSingularVectors:n=!0,computeRightSingularVectors:a=!0,autoTranspose:o=!1}=e;let s,h=Boolean(n),l=Boolean(a),u=!1;if(r<i)if(o){s=t.transpose(),r=s.rows,i=s.columns,u=!0;let e=h;h=l,l=e}else s=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else s=t.clone();let f=Math.min(r,i),c=Math.min(r+1,i),d=new Float64Array(c),m=new Matrix(r,f),g=new Matrix(i,i),p=new Float64Array(i),w=new Float64Array(r),v=new Float64Array(c);for(let t=0;t<c;t++)v[t]=t;let _=Math.min(r-1,i),b=Math.max(0,Math.min(i-2,r)),y=Math.max(_,b);for(let t=0;t<y;t++){if(t<_){d[t]=0;for(let e=t;e<r;e++)d[t]=hypotenuse(d[t],s.get(e,t));if(0!==d[t]){s.get(t,t)<0&&(d[t]=-d[t]);for(let e=t;e<r;e++)s.set(e,t,s.get(e,t)/d[t]);s.set(t,t,s.get(t,t)+1)}d[t]=-d[t]}for(let e=t+1;e<i;e++){if(t<_&&0!==d[t]){let i=0;for(let n=t;n<r;n++)i+=s.get(n,t)*s.get(n,e);i=-i/s.get(t,t);for(let n=t;n<r;n++)s.set(n,e,s.get(n,e)+i*s.get(n,t))}p[e]=s.get(t,e)}if(h&&t<_)for(let e=t;e<r;e++)m.set(e,t,s.get(e,t));if(t<b){p[t]=0;for(let e=t+1;e<i;e++)p[t]=hypotenuse(p[t],p[e]);if(0!==p[t]){p[t+1]<0&&(p[t]=0-p[t]);for(let e=t+1;e<i;e++)p[e]/=p[t];p[t+1]+=1}if(p[t]=-p[t],t+1<r&&0!==p[t]){for(let e=t+1;e<r;e++)w[e]=0;for(let e=t+1;e<r;e++)for(let r=t+1;r<i;r++)w[e]+=p[r]*s.get(e,r);for(let e=t+1;e<i;e++){let i=-p[e]/p[t+1];for(let n=t+1;n<r;n++)s.set(n,e,s.get(n,e)+i*w[n])}}if(l)for(let e=t+1;e<i;e++)g.set(e,t,p[e])}}let M=Math.min(i,r+1);if(_<i&&(d[_]=s.get(_,_)),r<M&&(d[M-1]=0),b+1<M&&(p[b]=s.get(b,M-1)),p[M-1]=0,h){for(let t=_;t<f;t++){for(let e=0;e<r;e++)m.set(e,t,0);m.set(t,t,1)}for(let t=_-1;t>=0;t--)if(0!==d[t]){for(let e=t+1;e<f;e++){let i=0;for(let n=t;n<r;n++)i+=m.get(n,t)*m.get(n,e);i=-i/m.get(t,t);for(let n=t;n<r;n++)m.set(n,e,m.get(n,e)+i*m.get(n,t))}for(let e=t;e<r;e++)m.set(e,t,-m.get(e,t));m.set(t,t,1+m.get(t,t));for(let e=0;e<t-1;e++)m.set(e,t,0)}else{for(let e=0;e<r;e++)m.set(e,t,0);m.set(t,t,1)}}if(l)for(let t=i-1;t>=0;t--){if(t<b&&0!==p[t])for(let e=t+1;e<i;e++){let r=0;for(let n=t+1;n<i;n++)r+=g.get(n,t)*g.get(n,e);r=-r/g.get(t+1,t);for(let n=t+1;n<i;n++)g.set(n,e,g.get(n,e)+r*g.get(n,t))}for(let e=0;e<i;e++)g.set(e,t,0);g.set(t,t,1)}let x=M-1,E=Number.EPSILON;for(;M>0;){let t,e;for(t=M-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+E*Math.abs(d[t]+Math.abs(d[t+1]));if(Math.abs(p[t])<=e||Number.isNaN(p[t])){p[t]=0;break}}if(t===M-2)e=4;else{let r;for(r=M-1;r>=t&&r!==t;r--){let e=(r!==M?Math.abs(p[r]):0)+(r!==t+1?Math.abs(p[r-1]):0);if(Math.abs(d[r])<=E*e){d[r]=0;break}}r===t?e=3:r===M-1?e=1:(e=2,t=r)}switch(t++,e){case 1:{let e=p[M-2];p[M-2]=0;for(let r=M-2;r>=t;r--){let n=hypotenuse(d[r],e),a=d[r]/n,o=e/n;if(d[r]=n,r!==t&&(e=-o*p[r-1],p[r-1]=a*p[r-1]),l)for(let t=0;t<i;t++)n=a*g.get(t,r)+o*g.get(t,M-1),g.set(t,M-1,-o*g.get(t,r)+a*g.get(t,M-1)),g.set(t,r,n)}break}case 2:{let e=p[t-1];p[t-1]=0;for(let i=t;i<M;i++){let n=hypotenuse(d[i],e),a=d[i]/n,o=e/n;if(d[i]=n,e=-o*p[i],p[i]=a*p[i],h)for(let e=0;e<r;e++)n=a*m.get(e,i)+o*m.get(e,t-1),m.set(e,t-1,-o*m.get(e,i)+a*m.get(e,t-1)),m.set(e,i,n)}break}case 3:{const e=Math.max(Math.abs(d[M-1]),Math.abs(d[M-2]),Math.abs(p[M-2]),Math.abs(d[t]),Math.abs(p[t])),n=d[M-1]/e,a=d[M-2]/e,o=p[M-2]/e,s=d[t]/e,u=p[t]/e,f=((a+n)*(a-n)+o*o)/2,c=n*o*(n*o);let w=0;0===f&&0===c||(w=f<0?0-Math.sqrt(f*f+c):Math.sqrt(f*f+c),w=c/(f+w));let v=(s+n)*(s-n)+w,_=s*u;for(let e=t;e<M-1;e++){let n=hypotenuse(v,_);0===n&&(n=Number.MIN_VALUE);let a=v/n,o=_/n;if(e!==t&&(p[e-1]=n),v=a*d[e]+o*p[e],p[e]=a*p[e]-o*d[e],_=o*d[e+1],d[e+1]=a*d[e+1],l)for(let t=0;t<i;t++)n=a*g.get(t,e)+o*g.get(t,e+1),g.set(t,e+1,-o*g.get(t,e)+a*g.get(t,e+1)),g.set(t,e,n);if(n=hypotenuse(v,_),0===n&&(n=Number.MIN_VALUE),a=v/n,o=_/n,d[e]=n,v=a*p[e]+o*d[e+1],d[e+1]=-o*p[e]+a*d[e+1],_=o*p[e+1],p[e+1]=a*p[e+1],h&&e<r-1)for(let t=0;t<r;t++)n=a*m.get(t,e)+o*m.get(t,e+1),m.set(t,e+1,-o*m.get(t,e)+a*m.get(t,e+1)),m.set(t,e,n)}p[M-2]=v;break}case 4:if(d[t]<=0&&(d[t]=d[t]<0?-d[t]:0,l))for(let e=0;e<=x;e++)g.set(e,t,-g.get(e,t));for(;t<x&&!(d[t]>=d[t+1]);){let e=d[t];if(d[t]=d[t+1],d[t+1]=e,l&&t<i-1)for(let r=0;r<i;r++)e=g.get(r,t+1),g.set(r,t+1,g.get(r,t)),g.set(r,t,e);if(h&&t<r-1)for(let i=0;i<r;i++)e=m.get(i,t+1),m.set(i,t+1,m.get(i,t)),m.set(i,t,e);t++}M--}}if(u){let t=g;g=m,m=t}this.m=r,this.n=i,this.s=d,this.U=m,this.V=g}solve(t){let e=t,r=this.threshold,i=this.s.length,n=Matrix.zeros(i,i);for(let t=0;t<i;t++)Math.abs(this.s[t])<=r?n.set(t,t,0):n.set(t,t,1/this.s[t]);let a=this.U,o=this.rightSingularVectors,s=o.mmul(n),h=o.rows,l=a.rows,u=Matrix.zeros(h,l);for(let t=0;t<h;t++)for(let e=0;e<l;e++){let r=0;for(let n=0;n<i;n++)r+=s.get(t,n)*a.get(e,n);u.set(t,e,r)}return u.mmul(e)}solveForDiagonal(t){return this.solve(Matrix.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,i=t.columns,n=new Matrix(r,this.s.length);for(let a=0;a<r;a++)for(let r=0;r<i;r++)Math.abs(this.s[r])>e&&n.set(a,r,t.get(a,r)/this.s[r]);let a=this.U,o=a.rows,s=a.columns,h=new Matrix(r,o);for(let t=0;t<r;t++)for(let e=0;e<o;e++){let r=0;for(let i=0;i<s;i++)r+=n.get(t,i)*a.get(e,i);h.set(t,e,r)}return h}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let i=0,n=r.length;i<n;i++)r[i]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix.diag(this.s)}}function inverse(t,e=!1){return t=WrapperMatrix2D.checkMatrix(t),e?new SingularValueDecomposition(t).inverse():solve(t,Matrix.eye(t.rows))}function solve(t,e,r=!1){return t=WrapperMatrix2D.checkMatrix(t),e=WrapperMatrix2D.checkMatrix(e),r?new SingularValueDecomposition(t).solve(e):t.isSquare()?new LuDecomposition(t).solve(e):new QrDecomposition(t).solve(e)}function getSeparatedKernel(t){var e=new SingularValueDecomposition(t,{autoTranspose:!0});if(1!==e.rank)return null;var r=Math.sqrt(e.s[0]);return[e.U.to2DArray().map(t=>t[0]*r),e.V.to2DArray().map(t=>t[0]*r)]}function convolution(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.channels,i=e.bitDepth,n=e.normalize,a=void 0!==n&&n,o=e.divisor,s=void 0===o?1:o,h=e.border,l=void 0===h?"copy":h,u=e.algorithm,f=void 0===u?"auto":u,c={};i&&(c.bitDepth=i);var d,m,g=Image.createFrom(this,c);if(r=validateArrayOfChannels(this,r,!0),"separable"!==f){var p=validateKernel(t);t=p.kernel}else if(!Array.isArray(t)||2!==t.length)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if("auto"===f){var w=getSeparatedKernel(t);null!==w?(f="separable",t=w):f=(t.length>9||t[0].length>9)&&this.width<=4096&&this.height<=4096?"fft":"direct"}"separable"===f?(d=Math.floor(t[0].length/2),m=Math.floor(t[1].length/2)):(d=Math.floor(t.length/2),m=Math.floor(t[0].length/2));var v,_,b,y,M,x,E=g.isClamped,A=new Array(this.height*this.width);for(y=0;y<r.length;y++){for(M=r[y],b=0;b<this.height;b++)for(_=0;_<this.width;_++)A[v=b*this.width+_]=this.data[v*this.channels+M];if("direct"===f)x=src_2(A,t,{rows:this.height,cols:this.width,normalize:a,divisor:s});else if("separable"===f){if(x=convolutionSeparable(A,t,this.width,this.height),a){s=0;for(var k=0;k<t[0].length;k++)for(var S=0;S<t[1].length;S++)s+=t[0][k]*t[1][S]}if(1!==s)for(var I=0;I<x.length;I++)x[I]/=s}else x=src_1(A,t,{rows:this.height,cols:this.width,normalize:a,divisor:s});for(b=0;b<this.height;b++)for(_=0;_<this.width;_++)v=b*this.width+_,g.data[v*this.channels+M]=E?clamp(x[v],g):x[v]}if(this.alpha&&!r.includes(this.channels))for(_=this.components;_<this.data.length;_+=this.channels)g.data[_]=this.data[_];return"periodic"!==l&&g.setBorder({size:[m,d],algorithm:l}),g}function gradientFilter(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.direction,r=void 0===e?"xy":e,i=t.border,n=void 0===i?"copy":i,a=t.kernelX,o=t.kernelY,s=t.channels,h=t.bitDepth,l=void 0===h?this.bitDepth:h;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),r){case"x":if(!a)throw new Error("kernelX option is missing");return convolution.call(this,a,{channels:s,border:n,bitDepth:l});case"y":if(!o)throw new Error("kernelY option is missing");return convolution.call(this,o,{channels:s,border:n,bitDepth:l});case"xy":if(!a)throw new Error("kernelX option is missing");if(!o)throw new Error("kernelY option is missing");var u=convolution.call(this,a,{channels:s,border:n,bitDepth:32}),f=convolution.call(this,o,{channels:s,border:n,bitDepth:32});return u.hypotenuse(f,{bitDepth:l,channels:s});default:throw new Error("Unknown parameter direction: "+r)}}function sobelFilter(t){return gradientFilter.call(this,Object.assign({},t,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(t){return gradientFilter.call(this,Object.assign({},t,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray$1;function newArray$1(t,e){t=t||0;for(var r=new Array(t),i=0;i<t;i++)r[i]=e;return r}function level(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.algorithm,r=void 0===e?"range":e,i=t.channels,n=t.min,a=void 0===n?this.min:n,o=t.max,s=void 0===o?this.max:o;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),(i=validateArrayOfChannels(this,{channels:i})).length!==this.channel&&(Array.isArray(a)&&a.length===this.channels&&(a=a.filter((t,e)=>i.includes(e))),Array.isArray(s)&&s.length===this.channels&&(s=s.filter((t,e)=>i.includes(e)))),r){case"range":a<0&&(a=0),s>this.maxValue&&(s=this.maxValue),Array.isArray(a)||(a=newArray_1(i.length,a)),Array.isArray(s)||(s=newArray_1(i.length,s)),processImage(this,a,s,i);break;default:throw new Error("level: algorithm not implement: "+r)}return this}function processImage(t,e,r,i){for(var n=new Array(i.length),a=0;a<i.length;a++)0===e[a]&&r[a]===t.maxValue||r[a]===e[a]?n[a]=0:n[a]=(t.maxValue+1-1e-5)/(r[a]-e[a]),e[a]+=.499995/n[a];for(var o=0;o<i.length;o++){var s=i[o];if(0!==n[o])for(var h=0;h<t.data.length;h+=t.channels)t.data[h+s]=Math.min(Math.max(0,(t.data[h+s]-e[o])*n[o]+.5|0),t.maxValue)}}var toString$3=Object.prototype.toString,isArrayType=function(t){return"Array"===toString$3.call(t).substr(-6,5)};function checkNumberArray(t){if(isNaN(t)){if(t instanceof Image)return t.data;if(!isArrayType(t))throw new Error("checkNumberArray: the value should be either a number, array or Image");return t}if(t<=0)throw new Error("checkNumberArray: the value must be greater than 0");return t}function add(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.channels;if(this.checkProcessable("add",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("add: the data size is different");for(var i=0;i<r.length;i++)for(var n=r[i],a=0;a<this.data.length;a+=this.channels)this.data[a+n]=Math.max(0,Math.min(this.maxValue,this.data[a+n]+t[a+n]>>0))}else for(var o=0;o<r.length;o++)for(var s=r[o],h=0;h<this.data.length;h+=this.channels)this.data[h+s]=Math.min(this.maxValue,this.data[h+s]+t>>0);return this}function subtract(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.channels;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("subtract: the data size is different");for(var i=0;i<r.length;i++)for(var n=r[i],a=0;a<this.data.length;a+=this.channels)this.data[a+n]=Math.max(0,Math.min(this.maxValue,this.data[a+n]-t[a+n]>>0))}else for(var o=0;o<r.length;o++)for(var s=r[o],h=0;h<this.data.length;h+=this.channels)this.data[h+s]=Math.max(0,this.data[h+s]-t>>0);return this}function subtractImage(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.bitDepth,i=void 0===r?this.bitDepth:r,n=e.channels,a=e.absolute,o=void 0!==a&&a;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==t.width||this.height!==t.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==t.alpha||this.bitDepth!==t.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==t.channels)throw new Error("subtractImage: both images must have the same number of channels");var s=Image.createFrom(this,{bitDepth:i});n=validateArrayOfChannels(this,{channels:n});for(var h=0;h<n.length;h++)for(var l=n[h],u=l;u<this.data.length;u+=this.channels){var f=this.data[u]-t.data[u];s.data[u]=o?Math.abs(f):Math.max(f,0)}return s}function hypotenuse$1(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.bitDepth,i=void 0===r?this.bitDepth:r,n=e.channels;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==t.width||this.height!==t.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==t.alpha||this.bitDepth!==t.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==t.channels)throw new Error("hypotenuse: both images must have the same number of channels");var a=Image.createFrom(this,{bitDepth:i});n=validateArrayOfChannels(this,{channels:n});for(var o=a.isClamped,s=0;s<n.length;s++)for(var h=n[s],l=h;l<this.data.length;l+=this.channels){var u=Math.hypot(this.data[l],t.data[l]);a.data[l]=o?Math.min(Math.max(Math.round(u),0),a.maxValue):u}return a}function multiply(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.channels;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),t<=0)throw new Error("multiply: the value must be greater than 0");if(r=validateArrayOfChannels(this,{channels:r}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("multiply: the data size is different");for(var i=0;i<r.length;i++)for(var n=r[i],a=0;a<this.data.length;a+=this.channels)this.data[a+n]=Math.max(0,Math.min(this.maxValue,this.data[a+n]*t[a+n]>>0))}else for(var o=0;o<r.length;o++)for(var s=r[o],h=0;h<this.data.length;h+=this.channels)this.data[h+s]=Math.min(this.maxValue,this.data[h+s]*t>>0);return this}function divide(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.channels;if(this.checkProcessable("divide",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("divide: the: the data size is different");for(var i=0;i<r.length;i++)for(var n=r[i],a=0;a<this.data.length;a+=this.channels)this.data[a+n]=Math.max(0,Math.min(this.maxValue,this.data[a+n]/t[a+n]>>0))}else for(var o=0;o<r.length;o++)for(var s=r[o],h=0;h<this.data.length;h+=this.channels)this.data[h+s]=Math.min(this.maxValue,this.data[h+s]/t>>0);return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(t){if("number"==typeof t)return this._predict(t);if(src$3(t)){const e=[];for(let r=0;r<t.length;r++)e.push(this._predict(t[r]));return e}throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(t,e){if(!src$3(t)||!src$3(e)||t.length!==e.length)throw new Error("x and y must be arrays of the same length");const r=t.length,i=new Array(r);for(let e=0;e<r;e++)i[e]=this._predict(t[e]);let n=0,a=0,o=0,s=0,h=0,l=0,u=0;for(let t=0;t<r;t++)n+=i[t],a+=e[t],h+=i[t]*i[t],l+=e[t]*e[t],u+=i[t]*e[t],0!==e[t]&&(o+=(e[t]-i[t])*(e[t]-i[t])/e[t]),s+=(e[t]-i[t])*(e[t]-i[t]);const f=(r*u-n*a)/Math.sqrt((r*h-n*n)*(r*l-a*a));return{r:f,r2:f*f,chi2:o,rmsd:Math.sqrt(s/r)}}}function squaredEuclidean(t,e){let r=0;for(let i=0;i<t.length;i++)r+=(t[i]-e[i])*(t[i]-e[i]);return r}function euclidean(t,e){return Math.sqrt(squaredEuclidean(t,e))}var euclidean$1=Object.freeze({__proto__:null,squaredEuclidean:squaredEuclidean,euclidean:euclidean}),require$$0$1=getCjsExportFromNamespace(euclidean$1);const{squaredEuclidean:squaredEuclidean$1}=require$$0$1,defaultOptions$2={sigma:1};class GaussianKernel{constructor(t){t=Object.assign({},defaultOptions$2,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,e){const r=squaredEuclidean$1(t,e);return Math.exp(-r/this.divisor)}}var gaussianKernel=GaussianKernel;const defaultOptions$3={degree:1,constant:1,scale:1};class PolynomialKernel{constructor(t){t=Object.assign({},defaultOptions$3,t),this.degree=t.degree,this.constant=t.constant,this.scale=t.scale}compute(t,e){for(var r=0,i=0;i<t.length;i++)r+=t[i]*e[i];return Math.pow(this.scale*r+this.constant,this.degree)}}var polynomialKernel=PolynomialKernel;const defaultOptions$4={alpha:.01,constant:-Math.E};class SigmoidKernel{constructor(t){t=Object.assign({},defaultOptions$4,t),this.alpha=t.alpha,this.constant=t.constant}compute(t,e){for(var r=0,i=0;i<t.length;i++)r+=t[i]*e[i];return Math.tanh(this.alpha*r+this.constant)}}var sigmoidKernel=SigmoidKernel;const defaultOptions$5={sigma:1,degree:1};class ANOVAKernel{constructor(t){t=Object.assign({},defaultOptions$5,t),this.sigma=t.sigma,this.degree=t.degree}compute(t,e){for(var r=0,i=Math.min(t.length,e.length),n=1;n<=i;++n)r+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(t[n-1],n)-Math.pow(e[n-1],n),2)),this.degree);return r}}var anovaKernel=ANOVAKernel;const{squaredEuclidean:squaredEuclidean$2}=require$$0$1,defaultOptions$6={sigma:1};class CauchyKernel{constructor(t){t=Object.assign({},defaultOptions$6,t),this.sigma=t.sigma}compute(t,e){return 1/(1+squaredEuclidean$2(t,e)/(this.sigma*this.sigma))}}var cauchyKernel=CauchyKernel;const{euclidean:euclidean$2}=require$$0$1,defaultOptions$7={sigma:1};class ExponentialKernel{constructor(t){t=Object.assign({},defaultOptions$7,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,e){const r=euclidean$2(t,e);return Math.exp(-r/this.divisor)}}var exponentialKernel=ExponentialKernel;class HistogramIntersectionKernel{compute(t,e){for(var r=Math.min(t.length,e.length),i=0,n=0;n<r;++n)i+=Math.min(t[n],e[n]);return i}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean:euclidean$3}=require$$0$1,defaultOptions$8={sigma:1};class LaplacianKernel{constructor(t){t=Object.assign({},defaultOptions$8,t),this.sigma=t.sigma}compute(t,e){const r=euclidean$3(t,e);return Math.exp(-r/this.sigma)}}var laplacianKernel=LaplacianKernel;const{squaredEuclidean:squaredEuclidean$3}=require$$0$1,defaultOptions$9={constant:1};class MultiquadraticKernel{constructor(t){t=Object.assign({},defaultOptions$9,t),this.constant=t.constant}compute(t,e){return Math.sqrt(squaredEuclidean$3(t,e)+this.constant*this.constant)}}var multiquadraticKernel=MultiquadraticKernel;const{squaredEuclidean:squaredEuclidean$4}=require$$0$1,defaultOptions$a={constant:1};class RationalQuadraticKernel{constructor(t){t=Object.assign({},defaultOptions$a,t),this.constant=t.constant}compute(t,e){const r=squaredEuclidean$4(t,e);return 1-r/(r+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView:MatrixTransposeView}=Matrix,kernelType={gaussian:gaussianKernel,rbf:gaussianKernel,polynomial:polynomialKernel,poly:polynomialKernel,anova:anovaKernel,cauchy:cauchyKernel,exponential:exponentialKernel,histogram:histogramIntersectionKernel,min:histogramIntersectionKernel,laplacian:laplacianKernel,multiquadratic:multiquadraticKernel,rational:rationalQuadraticKernel,sigmoid:sigmoidKernel,mlp:sigmoidKernel};class Kernel{constructor(t,e){if(this.kernelType=t,"linear"!==t)if("string"==typeof t){t=t.toLowerCase();var r=kernelType[t];if(!r)throw new Error("unsupported kernel type: "+t);this.kernelFunction=new r(e)}else{if("object"!=typeof t||"function"!=typeof t.compute)throw new TypeError("first argument must be a valid kernel type or instance");this.kernelFunction=t}}compute(t,e){if(t=Matrix$1.checkMatrix(t),e=void 0===e?t:Matrix$1.checkMatrix(e),"linear"===this.kernelType)return t.mmul(new MatrixTransposeView(e));const r=new Matrix$1(t.rows,e.rows);if(t===e)for(let e=0;e<t.rows;e++)for(let i=e;i<t.rows;i++){const n=this.kernelFunction.compute(t.getRow(e),t.getRow(i));r.set(e,i,n),r.set(i,e,n)}else for(let i=0;i<t.rows;i++)for(let n=0;n<e.rows;n++)r.set(i,n,this.kernelFunction.compute(t.getRow(i),e.getRow(n)));return r}}var kernel=Kernel;const defaultOptions$b={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(t,e,r){if(super(),!0===t)this.alpha=e.alpha,this.inputs=e.inputs,this.kernelType=e.kernelType,this.kernelOptions=e.kernelOptions,this.kernel=new kernel(e.kernelType,e.kernelOptions);else{t=Matrix.checkMatrix(t),r=Object.assign({},defaultOptions$b,r);const i=new kernel(r.kernelType,r.kernelOptions),n=i.compute(t),a=t.rows;n.add(Matrix.eye(a,a).mul(r.lambda)),this.alpha=solve(n,e),this.inputs=t,this.kernelType=r.kernelType,this.kernelOptions=r.kernelOptions,this.kernel=i}}_predict(t){return this.kernel.compute([t],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(t){if("kernelRidgeRegression"!==t.name)throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,t)}}var medianQuickselect_min=createCommonjsModule((function(t){!function(){function e(t){for(var e=0,n=t.length-1,a=void 0,o=void 0,s=void 0,h=i(e,n);;){if(n<=e)return t[h];if(n==e+1)return t[e]>t[n]&&r(t,e,n),t[h];for(t[a=i(e,n)]>t[n]&&r(t,a,n),t[e]>t[n]&&r(t,e,n),t[a]>t[e]&&r(t,a,e),r(t,a,e+1),o=e+1,s=n;;){do{o++}while(t[e]>t[o]);do{s--}while(t[s]>t[e]);if(s<o)break;r(t,o,s)}r(t,e,s),s<=h&&(e=o),s>=h&&(n=s-1)}}var r=function(t,e,r){var i;return i=[t[r],t[e]],t[e]=i[0],t[r]=i[1],i},i=function(t,e){return~~((t+e)/2)};t.exports?t.exports=e:window.median=e}()}));function background(t,e,r){for(var i=new KernelRidgeRegression(t,e,r),n=new Array(this.size),a=0;a<this.width;a++)for(var o=0;o<this.height;o++)n[o*this.width+a]=[a,o];for(var s=i.predict(n),h=Image.createFrom(this),l=0;l<this.size;l++)h.data[l]=Math.min(this.maxValue,Math.max(0,s[l][0]));return h}function dilate(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.kernel,r=void 0===e?[[1,1,1],[1,1,1],[1,1,1]]:e,i=t.iterations,n=void 0===i?1:i;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),r.columns%2==0||r.rows%2==0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");var a=!0;t:for(var o of r)for(var s of o)if(1!==s){a=!1;break t}for(var h=this,l=0;l<n;l++)if(1===this.bitDepth)if(a){var u=h.clone();h=dilateOnceBinaryOnlyOnes(h,u,r.length,r[0].length)}else{var f=Image.createFrom(h);h=dilateOnceBinary(h,f,r)}else if(a){var c=Image.createFrom(h);h=dilateOnceGreyOnlyOnes(h,c,r.length,r[0].length)}else{var d=Image.createFrom(h);h=dilateOnceGrey(h,d,r)}return h}function dilateOnceGrey(t,e,r){for(var i=r.length,n=r[0].length,a=(i-1)/2,o=(n-1)/2,s=0;s<t.height;s++)for(var h=0;h<t.width;h++){for(var l=0,u=0;u<n;u++)for(var f=0;f<i;f++)if(1===r[f][u]){var c=f-a+h,d=u-o+s;if(!(c<0||d<0||c>=t.width||d>=t.height)){var m=t.getValueXY(c,d,0);m>l&&(l=m)}}e.setValueXY(h,s,0,l)}return e}function dilateOnceGreyOnlyOnes(t,e,r,i){for(var n=(r-1)/2,a=(i-1)/2,o=[],s=0;s<t.width;s++)o.push(0);for(var h=0;h<t.height;h++){for(var l=0;l<t.width;l++){for(var u=0,f=Math.max(0,h-a);f<Math.min(t.height,h+a+1);f++){var c=t.getValueXY(l,f,0);c>u&&(u=c)}o[l]=u}for(var d=0;d<t.width;d++){for(var m=0,g=Math.max(0,d-n);g<Math.min(t.width,d+n+1);g++)o[g]>m&&(m=o[g]);e.setValueXY(d,h,0,m)}}return e}function dilateOnceBinary(t,e,r){for(var i=r.length,n=r[0].length,a=(i-1)/2,o=(n-1)/2,s=0;s<t.height;s++)for(var h=0;h<t.width;h++){var l=0;t:for(var u=0;u<n;u++)for(var f=0;f<i;f++)if(1===r[f][u]){var c=f-a+h,d=u-o+s;if(!(d<0||c<0||c>=t.width||d>=t.height))if(1===t.getBitXY(c,d)){l=1;break t}}1===l&&e.setBitXY(h,s)}return e}function dilateOnceBinaryOnlyOnes(t,e,r,i){for(var n=(r-1)/2,a=(i-1)/2,o=[],s=0;s<t.width;s++)o.push(1);for(var h=0;h<t.height;h++){for(var l=0;l<t.width;l++){o[l]=0;for(var u=Math.max(0,h-a);u<Math.min(t.height,h+a+1);u++)if(1===t.getBitXY(l,u)){o[l]=1;break}}for(var f=0;f<t.width;f++)if(1!==e.getBitXY(f,h))for(var c=Math.max(0,f-n);c<Math.min(t.width,f+n+1);c++)if(1===o[c]){e.setBitXY(f,h);break}}return e}function erode(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.kernel,r=void 0===e?[[1,1,1],[1,1,1],[1,1,1]]:e,i=t.iterations,n=void 0===i?1:i;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),r.columns%2==0||r.rows%2==0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");var a=!0;t:for(var o of r)for(var s of o)if(1!==s){a=!1;break t}for(var h=this,l=0;l<n;l++)if(1===this.bitDepth)if(a){var u=h.clone();h=erodeOnceBinaryOnlyOnes(h,u,r.length,r[0].length)}else{var f=Image.createFrom(h);h=erodeOnceBinary(h,f,r)}else if(a){var c=Image.createFrom(h);h=erodeOnceGreyOnlyOnes(h,c,r.length,r[0].length)}else{var d=Image.createFrom(h);h=erodeOnceGrey(h,d,r)}return h}function erodeOnceGrey(t,e,r){for(var i=r.length,n=r[0].length,a=(i-1)/2,o=(n-1)/2,s=0;s<t.height;s++)for(var h=0;h<t.width;h++){for(var l=t.maxValue,u=0;u<n;u++)for(var f=0;f<i;f++)if(1===r[f][u]){var c=f-a+h,d=u-o+s;if(!(c<0||d<0||c>=t.width||d>=t.height)){var m=t.getValueXY(c,d,0);m<l&&(l=m)}}e.setValueXY(h,s,0,l)}return e}function erodeOnceGreyOnlyOnes(t,e,r,i){for(var n=(r-1)/2,a=(i-1)/2,o=[],s=0;s<t.width;s++)o.push(0);for(var h=0;h<t.height;h++){for(var l=0;l<t.width;l++){for(var u=t.maxValue,f=Math.max(0,h-a);f<Math.min(t.height,h+a+1);f++){var c=t.getValueXY(l,f,0);c<u&&(u=c)}o[l]=u}for(var d=0;d<t.width;d++){for(var m=t.maxValue,g=Math.max(0,d-n);g<Math.min(t.width,d+n+1);g++)o[g]<m&&(m=o[g]);e.setValueXY(d,h,0,m)}}return e}function erodeOnceBinary(t,e,r){for(var i=r.length,n=r[0].length,a=(i-1)/2,o=(n-1)/2,s=0;s<t.height;s++)for(var h=0;h<t.width;h++){var l=1;t:for(var u=0;u<n;u++)for(var f=0;f<i;f++)if(1===r[f][u]){var c=f-a+h,d=u-o+s;if(!(d<0||c<0||c>=t.width||d>=t.height))if(0===t.getBitXY(c,d)){l=0;break t}}1===l&&e.setBitXY(h,s)}return e}function erodeOnceBinaryOnlyOnes(t,e,r,i){for(var n=(r-1)/2,a=(i-1)/2,o=[],s=0;s<t.width;s++)o.push(0);for(var h=0;h<t.height;h++){for(var l=0;l<t.width;l++){o[l]=1;for(var u=Math.max(0,h-a);u<Math.min(t.height,h+a+1);u++)if(0===t.getBitXY(l,u)){o[l]=0;break}}for(var f=0;f<t.width;f++)if(0!==e.getBitXY(f,h))for(var c=Math.max(0,f-n);c<Math.min(t.width,f+n+1);c++)if(0===o[c]){e.clearBitXY(f,h);break}}return e}function open(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.kernel,r=void 0===e?[[1,1,1],[1,1,1],[1,1,1]]:e,i=t.iterations,n=void 0===i?1:i;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),r.columns%2==0||r.rows%2==0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");for(var a=this,o=0;o<n;o++)a=(a=a.erode({kernel:r})).dilate({kernel:r});return a}function close(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.kernel,r=void 0===e?[[1,1,1],[1,1,1],[1,1,1]]:e,i=t.iterations,n=void 0===i?1:i;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),r.columns%2==0||r.rows%2==0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");for(var a=this,o=0;o<n;o++)a=a.dilate({kernel:r}).erode({kernel:r});return a}function topHat(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.kernel,r=void 0===e?[[1,1,1],[1,1,1],[1,1,1]]:e,i=t.iterations,n=void 0===i?1:i;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),r.length%2==0||r[0].length%2==0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");for(var a=this,o=0;o<n;o++){var s=a.open({kernel:r});a=s.subtractImage(a,{absolute:!0})}return a}function blackHat(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.kernel,r=void 0===e?[[1,1,1],[1,1,1],[1,1,1]]:e,i=t.iterations,n=void 0===i?1:i;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),r.columns%2==0||r.rows%2==0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");for(var a=this,o=0;o<n;o++){var s=a.close({kernel:r});a=s.subtractImage(a,{absolute:!0})}return a}function morphologicalGradient(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.kernel,r=void 0===e?[[1,1,1],[1,1,1],[1,1,1]]:e,i=t.iterations,n=void 0===i?1:i;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),r.columns%2==0||r.rows%2==0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");for(var a=this,o=0;o<n;o++){var s=a.dilate({kernel:r}),h=a.erode({kernel:r});a=s.subtractImage(h,{absolute:!0})}return a}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return r}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function order4Points(t){for(var e=0,r=0,i=0,n=0,a=t[0][0],o=0,s=1;s<t.length;s++)t[s][0]<a&&(a=t[s][0],o=s);for(var h=t[(o+1)%t.length][0],l=(o+1)%t.length,u=1;u<t.length;u++)t[u][0]<h&&u!==o&&(h=t[u][0],l=u);return t[l][1]<t[o][1]?(e=t[l],n=t[o],o!==(l+1)%4?(r=t[(l+1)%4],i=t[(l+2)%4]):(r=t[(l+2)%4],i=t[(l+3)%4])):(n=t[l],e=t[o],l!==(o+1)%4?(r=t[(o+1)%4],i=t[(o+2)%4]):(r=t[(o+2)%4],i=t[(o+3)%4])),[e,r,i,n]}function distance2Points(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function crossVect(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function dotVect(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function computeWidthAndHeigth(t,e,r,i,n,a){var o=Math.max(distance2Points(t,e),distance2Points(i,r)),s=Math.max(distance2Points(t,i),distance2Points(e,r)),h=0,l=0,u=Math.ceil(n/2),f=Math.ceil(a/2),c=o/s,d=[t[0],t[1],1],m=[e[0],e[1],1],g=[i[0],i[1],1],p=[r[0],r[1],1],w=dotVect(crossVect(d,p),g)/dotVect(crossVect(m,p),g),v=dotVect(crossVect(d,p),m)/dotVect(crossVect(g,p),m),_=[w*m[0]-d[0],w*m[1]-d[1],w*m[2]-d[2]],b=[v*g[0]-d[0],v*g[1]-d[1],v*g[2]-d[2]],y=_[0],M=_[1],x=_[2],E=b[0],A=b[1],k=b[2],S=1/(x*k)*(y*E-(y*k+x*E)*u+x*k*u*u+(M*A-(M*k+x*A)*f+x*k*f*f));S=S>=0?Math.sqrt(S):Math.sqrt(-S);var I=new Matrix([[S,0,u],[0,S,f],[0,0,1]]),D=inverse(I.transpose()),T=inverse(I),R=Matrix.rowVector(_),B=Matrix.rowVector(b),C=Math.sqrt(dotVect(R.mmul(D).mmul(T).to1DArray(),_)/dotVect(B.mmul(D).mmul(T).to1DArray(),b));return 0===C||0===c?(h=Math.ceil(o),l=Math.ceil(s)):C<c?(h=Math.ceil(o),l=Math.ceil(h/C)):(l=Math.ceil(s),h=Math.ceil(C*l)),[h,l]}function projectionPoint(t,e,r,i,n,a,o,s,h,l,u,f){var c=(r*t+i*e+n)/(h*t+l*e+1),d=(a*t+o*e+s)/(h*t+l*e+1);return u.getValueXY(Math.floor(c),Math.floor(d),f)}function warpingFourPoints(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.calculateRatio,i=void 0===r||r;if(4!==t.length)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${t.length} elements`);var n,a,o=_slicedToArray(t,4),s=o[0],h=o[1],l=o[2],u=o[3],f=[s,h,l,u],c=order4Points(f),d=_slicedToArray(c,4),m=d[0],g=d[1],p=d[2],w=d[3];if(i){var v=computeWidthAndHeigth(m,g,p,w,this.width,this.height),_=_slicedToArray(v,2);n=_[0],a=_[1]}else n=Math.ceil(Math.max(distance2Points(m,g),distance2Points(w,p))),a=Math.ceil(Math.max(distance2Points(m,w),distance2Points(g,p)));for(var b=Image.createFrom(this,{width:n,height:a}),y=_slicedToArray(m,2),M=y[0],x=y[1],E=_slicedToArray(g,2),A=E[0],k=E[1],S=_slicedToArray(p,2),I=S[0],D=S[1],T=_slicedToArray(w,2),R=T[0],B=T[1],C=0,P=0,O=0,$=n-1,N=a-1,L=n-1,F=a-1,U=0,Y=new Matrix([[C,P,1,0,0,0,-C*M,-P*M],[O,$,1,0,0,0,-O*A,-$*A],[N,L,1,0,0,0,-N*I,-P*I],[F,U,1,0,0,0,-F*R,-U*R],[0,0,0,C,P,1,-C*x,-P*x],[0,0,0,O,$,1,-O*k,-$*k],[0,0,0,N,L,1,-N*D,-L*D],[0,0,0,F,U,1,-F*B,-U*B]]),H=Matrix.columnVector([M,A,I,R,x,k,D,B]),z=new SingularValueDecomposition(Y),V=z.solve(H),X=V.to1DArray(),G=_slicedToArray(X,8),j=G[0],Z=G[1],K=G[2],q=G[3],W=G[4],J=G[5],Q=G[6],tt=G[7],et=new Matrix(a,n),rt=0;rt<this.channels;rt++){for(var it=0;it<a;it++)for(var nt=0;nt<n;nt++)et.set(it,nt,projectionPoint(it,nt,j,Z,K,q,W,J,Q,tt,this,rt));b.setMatrix(et,{channel:rt})}return b}function crop(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.x,r=void 0===e?0:e,i=t.y,n=void 0===i?0:i,a=t.width,o=void 0===a?this.width-r:a,s=t.height,h=void 0===s?this.height-n:s;if(this.checkProcessable("max",{bitDepth:[8,16]}),r=Math.round(r),n=Math.round(n),o=Math.round(o),h=Math.round(h),r>this.width-1||n>this.height-1)throw new RangeError(`crop: origin (x:${r}, y:${n}) out of range (${this.width-1}; ${this.height-1})`);if(o<=0||h<=0)throw new RangeError(`crop: width and height (width:${o}; height:${h}) must be positive numbers`);if(r<0||n<0)throw new RangeError(`crop: x and y (x:${r}, y:${n}) must be positive numbers`);if(o>this.width-r||h>this.height-n)throw new RangeError(`crop: (x: ${r}, y:${n}, width:${o}, height:${h}) size is out of range`);for(var l=Image.createFrom(this,{width:o,height:h,position:[r,n]}),u=o*this.channels,f=n+h,c=0,d=r*this.channels,m=n;m<f;m++)for(var g=m*this.width*this.channels+d,p=g+u;g<p;g++)l.data[c++]=this.data[g];return l}function cropAlpha(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.checkProcessable("cropAlpha",{alpha:1});var e=t.threshold,r=void 0===e?this.maxValue:e,i=findLeft(this,r,this.components);if(-1===i)throw new Error("Could not find new dimensions. Threshold may be too high.");var n=findTop(this,r,this.components,i),a=findBottom(this,r,this.components,i),o=findRight(this,r,this.components,i,n,a);return this.crop({x:i,y:n,width:o-i+1,height:a-n+1})}function findLeft(t,e,r){for(var i=0;i<t.width;i++)for(var n=0;n<t.height;n++)if(t.getValueXY(i,n,r)>=e)return i;return-1}function findTop(t,e,r,i){for(var n=0;n<t.height;n++)for(var a=i;a<t.width;a++)if(t.getValueXY(a,n,r)>=e)return n;return-1}function findBottom(t,e,r,i){for(var n=t.height-1;n>=0;n--)for(var a=i;a<t.width;a++)if(t.getValueXY(a,n,r)>=e)return n;return-1}function findRight(t,e,r,i,n,a){for(var o=t.width-1;o>=i;o--)for(var s=n;s<=a;s++)if(t.getValueXY(o,s,r)>=e)return o;return-1}function getFactor(t){if("string"==typeof t){var e=t[t.length-1];t=parseFloat(t),"%"===e&&(t/=100)}return t}function getThreshold(t,e){if(!e)throw Error("getThreshold : the maxValue should be specified");if("string"==typeof t){if("%"!==t[t.length-1])throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(t)/100*e}if("number"==typeof t)return t<1?t*e:t;throw Error("getThreshold : the value is not valid")}function factorDimensions(t,e,r){t=getFactor(t);var i=Math.round(t*e),n=Math.round(t*r);return i<=0&&(i=1),n<=0&&(n=1),{width:i,height:n}}function checkRow(t,e){if(e<0||e>=t.height)throw new RangeError(`row must be included between 0 and ${t.height-1}. Current value: ${e}`)}function checkColumn(t,e){if(e<0||e>=t.width)throw new RangeError(`column must be included between 0 and ${t.width-1}. Current value: ${e}`)}function checkChannel(t,e){if(e<0||e>=t.channels)throw new RangeError(`channel must be included between 0 and ${t.channels-1}. Current value: ${e}`)}var validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(t){if("string"!=typeof t)throw new TypeError("interpolation must be a string");if(t=t.toLowerCase(),!validInterpolations[t])throw new RangeError("invalid interpolation algorithm: "+t);return validInterpolations[t]}function nearestNeighbor(t,e,r){var i=this.width/e,n=this.height/r;if(this.bitDepth>1)for(var a=0;a<e;a++)for(var o=Math.floor((a+.5)*i),s=0;s<r;s++)for(var h=Math.floor((s+.5)*n),l=0;l<this.channels;l++)t.setValueXY(a,s,l,this.getValueXY(o,h,l));else for(var u=0;u<e;u++)for(var f=Math.floor((u+.5)*i),c=0;c<r;c++){var d=Math.floor((c+.5)*n);this.getBitXY(f,d)&&t.setBitXY(u,c)}}function resize(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.factor,r=void 0===e?1:e,i=t.interpolation,n=void 0===i?validInterpolations.nearestneighbor:i,a=t.preserveAspectRatio,o=void 0===a||a,s=checkInterpolation(n),h=t.width,l=t.height;h||(h=l&&o?Math.round(l*(this.width/this.height)):this.width),l||(l=o?Math.round(h*(this.height/this.width)):this.height);var u=factorDimensions(r,h,l);if(h=u.width,l=u.height,h===this.width&&l===this.height){var f=this.clone();return f.position=[0,0],f}var c=Math.round((this.width-h)/2),d=Math.round((this.height-l)/2),m=Image.createFrom(this,{width:h,height:l,position:[c,d]});switch(s){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,m,h,l);break;default:throw new Error("unsupported resize interpolation: "+s)}return m}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB]});for(var t=Image.createFrom(this,{colorModel:HSV}),e=0,r=this.data,i=0;i<r.length;i+=this.channels){var n=r[i],a=r[i+1],o=r[i+2],s=Math.min(n,a,o),h=Math.max(n,a,o),l=h-s,u=0,f=0===h?0:l/h,c=h;if(h!==s){switch(h){case n:u=(a-o)/l+(a<o?6:0);break;case a:u=(o-n)/l+2;break;case o:u=(n-a)/l+4;break;default:throw new Error("unreachable")}u/=6}t.data[e++]=u*this.maxValue,t.data[e++]=f*this.maxValue,t.data[e++]=c,this.alpha&&(t.data[e++]=r[i+3])}return t}function hsl(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB]});for(var t=Image.createFrom(this,{colorModel:HSL}),e=Math.floor(this.maxValue/2),r=0,i=this.data,n=0;n<i.length;n+=this.channels){var a=i[n],o=i[n+1],s=i[n+2],h=Math.max(a,o,s),l=Math.min(a,o,s),u=0,f=0,c=(h+l)/2;if(h!==l){var d=h-l;switch(f=c>e?d/(2-h-l):d/(h+l),h){case a:u=(o-s)/d+(o<s?6:0);break;case o:u=(s-a)/d+2;break;case s:u=(a-o)/d+4;break;default:throw new Error("unreachable")}u/=6}t.data[r++]=u*this.maxValue,t.data[r++]=f*this.maxValue,t.data[r++]=c,this.alpha&&(t.data[r++]=i[n+3])}return t}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB]});for(var t=Image.createFrom(this,{components:4,colorModel:CMYK}),e=0,r=this.data,i=0;i<r.length;i+=this.channels){var n=r[i],a=r[i+1],o=r[i+2],s=Math.min(this.maxValue-n,this.maxValue-a,this.maxValue-o),h=(this.maxValue-n-s)/(1-s/this.maxValue),l=(this.maxValue-a-s)/(1-s/this.maxValue),u=(this.maxValue-o-s)/(1-s/this.maxValue);t.data[e++]=Math.round(h),t.data[e++]=Math.round(l),t.data[e++]=Math.round(u),t.data[e++]=Math.round(s),this.alpha&&(t.data[e++]=r[i+3])}return t}function rgba8(){return new Image(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}var methods={luma709:(t,e,r)=>6966*t+23436*e+2366*r>>15,luma601:(t,e,r)=>9798*t+19235*e+3735*r>>15,maximum:(t,e,r)=>Math.max(t,e,r),minimum:(t,e,r)=>Math.min(t,e,r),average:(t,e,r)=>(t+e+r)/3>>0,minmax:(t,e,r)=>(Math.max(t,e,r)+Math.min(t,e,r))/2,red:t=>t,green:(t,e)=>e,blue:(t,e,r)=>r,cyan(t,e,r,i){var n=methods.black(t,e,r,i);return(i.maxValue-t-n)/(1-n/i.maxValue)>>0},magenta(t,e,r,i){var n=methods.black(t,e,r,i);return(i.maxValue-e-n)/(1-n/i.maxValue)>>0},yellow(t,e,r,i){var n=methods.black(t,e,r,i);return(i.maxValue-r-n)/(1-n/i.maxValue)>>0},black:(t,e,r,i)=>Math.min(i.maxValue-t,i.maxValue-e,i.maxValue-r),hue(t,e,r,i){var n=methods.min(t,e,r),a=methods.max(t,e,r);if(a===n)return 0;var o=0,s=a-n;switch(a){case t:o=(e-r)/s+(e<r?6:0);break;case e:o=(r-t)/s+2;break;case r:o=(t-e)/s+4;break;default:throw new Error("unreachable")}return o/6*i.maxValue>>0},saturation(t,e,r,i){var n=methods.min(t,e,r),a=methods.max(t,e,r);return 0===a?0:(a-n)/a*i.maxValue},lightness(t,e,r){var i=methods.min(t,e,r);return(methods.max(t,e,r)+i)/2}};Object.defineProperty(methods,"luminosity",{enumerable:!1,value:methods.lightness}),Object.defineProperty(methods,"luminance",{enumerable:!1,value:methods.lightness}),Object.defineProperty(methods,"min",{enumerable:!1,value:methods.minimum}),Object.defineProperty(methods,"max",{enumerable:!1,value:methods.maximum}),Object.defineProperty(methods,"brightness",{enumerable:!1,value:methods.maximum});var names={};function grey(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.algorithm,r=void 0===e?"luma709":e,i=t.keepAlpha,n=void 0!==i&&i,a=t.mergeAlpha,o=void 0===a||a;if("string"!=typeof r&&"function"!=typeof r)throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),1===this.components&&(r="red"),n&=this.alpha,o&=this.alpha,n&&(o=!1);var s,h=getOutputImage(this,t,{components:1,alpha:n,colorModel:GREY});if("function"==typeof r)s=r;else if(!(s=methods[r.toLowerCase()]))throw new Error("unsupported grey algorithm: "+r);for(var l=0,u=0;u<this.data.length;u+=this.channels)o?h.data[l++]=clamp(s(this.data[u],this.data[u+1],this.data[u+2],this)*this.data[u+this.components]/this.maxValue,this):(h.data[l++]=clamp(s(this.data[u],this.data[u+1],this.data[u+2],this),this),h.alpha&&(h.data[l++]=this.data[u+this.components]));return h}function huang(t){for(var e=0,r=0;r<t.length;r++)if(0!==t[r]){e=r;break}for(var i=t.length-1,n=t.length-1;n>=e;n--)if(0!==t[n]){i=n;break}for(var a=1/(i-e),o=new Array(t.length),s=0,h=0,l=e;l<t.length;l++)s+=l*t[l],h+=t[l],o[l]=s/h;var u=new Array(t.length);s=h=0;for(var f=i;f>0;f--)s+=f*t[f],h+=t[f],u[f-1]=s/h;for(var c=-1,d=Number.MAX_VALUE,m=0;m<t.length;m++){for(var g=0,p=void 0,w=0;w<=m;w++)(p=1/(1+a*Math.abs(w-o[m])))<1e-6||p>.999999||(g+=t[w]*(-p*Math.log(p)-(1-p)*Math.log(1-p)));for(var v=m+1;v<t.length;v++)(p=1/(1+a*Math.abs(v-u[m])))<1e-6||p>.999999||(g+=t[v]*(-p*Math.log(p)-(1-p)*Math.log(1-p)));g<d&&(d=g,c=m)}return c}function intermodes(t){for(var e=t.slice(),r=0;!bimodalTest(e);){for(var i=0,n=0,a=e[0],o=0;o<t.length-1;o++)i=n,n=a,a=e[o+1],e[o]=(i+n+a)/3;if(e[t.length-1]=(n+a)/3,++r>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}for(var s=0,h=1;h<t.length-1;h++)e[h-1]<e[h]&&e[h+1]<e[h]&&(s+=h);return Math.floor(s/2)}function bimodalTest(t){for(var e=!1,r=0,i=1;i<t.length-1;i++)if(t[i-1]<t[i]&&t[i+1]<t[i]&&++r>2)return!1;return 2===r&&(e=!0),e}function isodata(t){for(var e,r,i,n,a=0,o=1;o<t.length;o++)if(t[o]>0){a=o+1;break}for(;;){e=0,i=0;for(var s=0;s<a;s++)i+=t[s],e+=t[s]*s;n=0,r=0;for(var h=a+1;h<t.length;h++)r+=t[h],n+=t[h]*h;if(i>0&&r>0&&(e/=i,n/=r,a===Math.round((e+n)/2)))break;if(++a>t.length-2)throw new Error("Threshold not found")}return a}function li(t,e){var r,i,n,a,o,s,h,l,u,f,c;f=0;for(var d=0;d<t.length;d++)f+=d*t[d];h=f/=e;do{r=(s=h)+.5|0,i=0,a=0;for(var m=0;m<=r;m++)i+=m*t[m],a+=t[m];l=0===a?0:i/a,n=0,o=0;for(var g=r+1;g<t.length;g++)n+=g*t[g],o+=t[g];h=(c=(l-(u=0===o?0:n/o))/(Math.log(l)-Math.log(u)))<-Number.EPSILON?c-.5|0:c+.5|0}while(Math.abs(h-s)>.5);return r}function maxEntropy(t,e){for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=t[i]/e;var n=new Array(t.length),a=new Array(t.length);n[0]=r[0],a[0]=1-n[0];for(var o=1;o<t.length;o++)n[o]=n[o-1]+r[o],a[o]=1-n[o];for(var s=0,h=0;h<t.length;h++)if(Math.abs(n[h])>=Number.EPSILON){s=h;break}for(var l=t.length-1,u=t.length-1;u>=s;u--)if(Math.abs(a[u])>=Number.EPSILON){l=u;break}for(var f,c,d,m=-1,g=Number.MIN_VALUE,p=s;p<=l;p++){c=0;for(var w=0;w<=p;w++)0!==t[w]&&(c-=r[w]/n[p]*Math.log(r[w]/n[p]));d=0;for(var v=p+1;v<t.length;v++)0!==t[v]&&(d-=r[v]/a[p]*Math.log(r[v]/a[p]));g<(f=c+d)&&(g=f,m=p)}return m}function mean$1(t,e){for(var r=0,i=0;i<t.length;i++)r+=i*t[i];return Math.floor(r/e)}function minError(t,e){for(var r,i,n,a,o,s,h,l,u,f,c,d=-2,m=0,g=0;g<t.length;g++)m+=g*t[g];for(r=m/=e;r!==d;){var p=sumA(t,r),w=sumA(t,t.length-1),v=sumB(t,r),_=sumB(t,t.length-1),b=sumC(t,r);if(a=p/w,o=(w-p)/w,(f=(u=(i=v/p)/(s=b/p-i*i)-(n=(_-v)/(w-p))/(h=(sumC(t,t.length-1)-b)/(w-p)-n*n))*u-(l=1/s-1/h)*(i*i/s-n*n/h+Math.log10(s*(o*o)/(h*(a*a)))))<0)return r;d=r,c=(u+Math.sqrt(f))/l,r=isNaN(c)?d:Math.floor(c)}return r}function sumA(t,e){for(var r=0,i=0;i<=e;i++)r+=t[i];return r}function sumB(t,e){for(var r=0,i=0;i<=e;i++)r+=i*t[i];return r}function sumC(t,e){for(var r=0,i=0;i<=e;i++)r+=i*i*t[i];return r}function minimum(t){if(t.length<2)return 0;for(var e=0,r=-1,i=-1,n=new Array(t.length),a=0;a<t.length;a++)n[a]=t[a],t[a]>0&&(i=a);for(;!bimodalTest$1(n);)if(n=smoothed(n),++e>1e4)return r;return r=minimumBetweenPeeks(n,i)}function smoothed(t){for(var e=new Array(t.length),r=1;r<t.length-1;r++)e[r]=(t[r-1]+t[r]+t[r+1])/3;return e[0]=(t[0]+t[1])/3,e[t.length-1]=(t[t.length-2]+t[t.length-1])/3,e}function minimumBetweenPeeks(t,e){for(var r,i=1;i<e;i++)if(t[i-1]>t[i]&&t[i+1]>=t[i]){r=i;break}return r}function bimodalTest$1(t){for(var e=t.length,r=!1,i=0,n=1;n<e-1;n++)if(t[n-1]<t[n]&&t[n+1]<t[n]&&++i>2)return!1;return 2===i&&(r=!0),r}function moments(t,e){for(var r,i,n,a,o,s,h=0,l=0,u=0,f=0,c=-1,d=t.length,m=new Array(d),g=0;g<d;g++)m[g]=t[g]/e;for(var p=0;p<d;p++)h+=p*m[p],l+=p*p*m[p],u+=p*p*p*m[p];n=(-l*l+h*u)/(i=1*l-h*h),o=.5*(-(a=(1*-u+l*h)/i)-Math.sqrt(a*a-4*n)),r=((s=.5*(-a+Math.sqrt(a*a-4*n)))-h)/(s-o);for(var w=0;w<d;w++)if((f+=m[w])>r){c=w;break}return c}function otsu(t,e){for(var r=0,i=0,n=0,a=0,o=0,s=0;s<t.length;s++)o+=s*t[s];for(var h=0;h<t.length;h++){var l=e-(i+=t[h]);if(0!==i&&0!==l){var u=(o-(r+=h*t[h]))/l,f=i*l*(r/i-u)*(r/i-u);f>=n&&(a=h,n=f)}}return a}function percentile(t){for(var e=-1,r=new Array(t.length),i=partialSum(t,t.length-1),n=1,a=0;a<t.length;a++)r[a]=Math.abs(partialSum(t,a)/i-.5),r[a]<n&&(n=r[a],e=a);return e}function partialSum(t,e){for(var r=0,i=0;i<=e;i++)r+=t[i];return r}function renyiEntropy(t,e){for(var r,i,n=new Array(t.length),a=new Array(t.length),o=new Array(t.length),s=0,h=0,l=0,u=0,f=0,c=0,d=0;d<t.length;d++)n[d]=t[d]/e;a[0]=n[0],o[0]=1-a[0];for(var m=1;m<t.length;m++)a[m]=a[m-1]+n[m],o[m]=1-a[m];r=0;for(var g=0;g<t.length;g++)if(Math.abs(a[g])>=Number.EPSILON){r=g;break}i=t.length-1;for(var p=t.length-1;p>=r;p--)if(Math.abs(o[p])>=Number.EPSILON){i=p;break}for(var w=r;w<=i;w++){for(var v=0,_=0,b=0,y=0;y<=w;y++)0!==t[y]&&(v-=n[y]/a[w]*Math.log(n[y]/a[w])),_+=Math.sqrt(n[y]/a[w]),b+=n[y]*n[y]/(a[w]*a[w]);for(var M=0,x=0,E=0,A=w+1;A<t.length;A++)0!==t[A]&&(M-=n[A]/o[w]*Math.log(n[A]/o[w])),x+=Math.sqrt(n[A]/o[w]),E+=n[A]*n[A]/(o[w]*o[w]);var k=v+M,S=2*(_*x>0?Math.log(_*x):0),I=-1*(b*E>0?Math.log(b*E):0);k>u&&(u=k,s=w),S>f&&(f=S,h=w),I>c&&(c=I,l=w)}var D,T=[s,h,l];T.sort(ascending),D=Math.abs(T[0]-T[1])<=5?Math.abs(T[1]-T[2])<=5?[1,2,1]:[0,1,3]:Math.abs(T[1]-T[2])<=5?[3,1,0]:[1,2,1];var R=a[T[2]]-a[T[0]];return Math.round(T[0]*(a[T[0]]+.25*R*D[0])+.25*T[1]*R*D[1]+T[2]*(o[T[2]]+.25*R*D[2]))}function shanbhag(t,e){for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=t[i]/e;var n=new Array(t.length),a=new Array(t.length);n[0]=r[0],a[0]=1-n[0];for(var o=1;o<t.length;o++)n[o]=n[o-1]+r[o],a[o]=1-n[o];for(var s=0,h=0;h<t.length;h++)if(Math.abs(n[h])>=Number.EPSILON){s=h;break}for(var l=t.length-1,u=t.length-1;u>=s;u--)if(Math.abs(a[u])>=Number.EPSILON){l=u;break}for(var f,c,d,m,g=-1,p=Number.MAX_VALUE,w=s;w<=l;w++){d=0,f=.5/n[w];for(var v=1;v<=w;v++)d-=r[v]*Math.log(1-f*n[v-1]);d*=f,m=0,f=.5/a[w];for(var _=w+1;_<t.length;_++)m-=r[_]*Math.log(1-f*a[_]);m*=f,(c=Math.abs(d-m))<p&&(p=c,g=w)}return g}function triangle(t){for(var e=0,r=0,i=0,n=0,a=0;a<t.length;a++)if(t[a]>0){e=a;break}e>0&&e--;for(var o=t.length-1;o>0;o--)if(t[o]>0){n=o;break}n<t.length-1&&n++;for(var s=0;s<t.length;s++)t[s]>r&&(i=s,r=t[s]);var h,l,u,f=!1;if(i-e<n-i){f=!0;for(var c=0,d=t.length-1;c<d;){var m=t[c];t[c]=t[d],t[d]=m,c++,d--}e=t.length-1-n,i=t.length-1-i}if(e===i)return e;h=t[i],l=e-i,u=(h/=u=Math.sqrt(h*h+l*l))*e+(l/=u)*t[e];for(var g=e,p=0,w=e+1;w<=i;w++){var v=h*w+l*t[w]-u;v>p&&(g=w,p=v)}if(g--,f){for(var _=0,b=t.length-1;_<b;){var y=t[_];t[_]=t[b],t[b]=y,_++,b--}return t.length-1-g}return g}function yen(t,e){for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=t[i]/e;var n=new Array(t.length);n[0]=r[0];for(var a=1;a<t.length;a++)n[a]=n[a-1]+r[a];var o=new Array(t.length);o[0]=r[0]*r[0];for(var s=1;s<t.length;s++)o[s]=o[s-1]+r[s]*r[s];var h=new Array(t.length);h[t.length-1]=0;for(var l=t.length-2;l>=0;l--)h[l]=h[l+1]+r[l+1]*r[l+1];for(var u,f=-1,c=Number.MIN_VALUE,d=0;d<t.length;d++)(u=-1*(o[d]*h[d]>0?Math.log(o[d]*h[d]):0)+2*(n[d]*(1-n[d])>0?Math.log(n[d]*(1-n[d])):0))>c&&(c=u,f=d);return f}Object.keys(methods).forEach(t=>{names[t]=t});var methods$1={huang:huang,intermodes:intermodes,isodata:isodata,li:li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum:minimum,moments:moments,otsu:otsu,percentile:percentile,renyientropy:renyiEntropy,shanbhag:shanbhag,triangle:triangle,yen:yen},names$1={};function getThreshold$1(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.algorithm,r=void 0===e?names$1.otsu:e;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});var i=methods$1[r.toLowerCase()];if(i){var n=this.getHistogram();return i(n,this.size)}throw new Error("unknown thresholding algorithm: "+r)}Object.keys(methods$1).forEach(t=>{names$1[t]=t});var THRESHOLD="threshold";function mask(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.algorithm,r=void 0===e?THRESHOLD:e,i=t.threshold,n=void 0===i?.5:i,a=t.useAlpha,o=void 0===a||a,s=t.invert,h=void 0!==s&&s;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),n=r===THRESHOLD?getThreshold(n,this.maxValue):getThreshold$1.call(this,t);var l=new Image(this.width,this.height,{kind:"BINARY",parent:this}),u=0;if(this.alpha&&o)for(var f=0;f<this.data.length;f+=this.channels){var c=this.data[f]+(this.maxValue-this.data[f])*(this.maxValue-this.data[f+1])/this.maxValue;(h&&c<=n||!h&&c>=n)&&l.setBit(u),u++}else for(var d=0;d<this.data.length;d+=this.channels)(h&&this.data[d]<=n||!h&&this.data[d]>=n)&&l.setBit(u),u++;return l}function copyImage(t,e,r,i){for(var n=t.width,a=t.height,o=e.width,s=t.channels,h=0;h<n;h++)for(var l=0;l<a;l++)for(var u=0;u<s;u++){var f=(l*n+h)*s+u,c=((i+l)*o+r+h)*s+u;e.data[c]=t.data[f]}}function pad(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.size,r=void 0===e?0:e,i=t.algorithm,n=void 0===i?"copy":i,a=t.color;if(this.checkProcessable("pad",{bitDepth:[8,16]}),"set"===n){if(a.length!==this.channels)throw new Error("pad: the color array must have the same length as the number of channels. Here: "+this.channels);for(var o=0;o<a.length;o++)0===a[o]&&(a[o]=.001)}else a=newArray_1(this.channels,null);Array.isArray(r)||(r=[r,r]);var s=this.width+2*r[0],h=this.height+2*r[1],l=this.channels,u=Image.createFrom(this,{width:s,height:h});copyImage(this,u,r[0],r[1]);for(var f=r[0];f<s-r[0];f++)for(var c=0;c<l;c++){for(var d=a[c]||u.data[(r[1]*s+f)*l+c],m=0;m<r[1];m++)u.data[(m*s+f)*l+c]=d;d=a[c]||u.data[((h-r[1]-1)*s+f)*l+c];for(var g=h-r[1];g<h;g++)u.data[(g*s+f)*l+c]=d}for(var p=0;p<h;p++)for(var w=0;w<l;w++){for(var v=a[w]||u.data[(p*s+r[0])*l+w],_=0;_<r[0];_++)u.data[(p*s+_)*l+w]=v;v=a[w]||u.data[(p*s+s-r[0]-1)*l+w];for(var b=s-r[0];b<s;b++)u.data[(p*s+b)*l+w]=v}return u}function colorDepth(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(t))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===t)return this.clone();var e=Image.createFrom(this,{bitDepth:t});switch(t){case 8:if(1===this.bitDepth)for(var r=0;r<this.size;r++)this.getBit(r)&&(e.data[r]=255);else for(var i=0;i<this.data.length;i++)e.data[i]=this.data[i]>>8;break;case 16:if(1===this.bitDepth)for(var n=0;n<this.size;n++)this.getBit(n)&&(e.data[n]=65535);else for(var a=0;a<this.data.length;a++)e.data[a]=this.data[a]<<8|this.data[a];break;default:throw new Error("colorDepth conversion unexpected case")}return e}function rotateFree(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.interpolation,i=void 0===r?validInterpolations.nearestneighbor:r,n=e.width,a=void 0===n?this.width:n,o=e.height,s=void 0===o?this.height:o;if("number"!=typeof t)throw new TypeError("degrees must be a number");var h=checkInterpolation(i),l=t*Math.PI/180,u=Math.floor(Math.abs(a*Math.cos(l))+Math.abs(s*Math.sin(l))),f=Math.floor(Math.abs(s*Math.cos(l))+Math.abs(a*Math.sin(l))),c=Image.createFrom(this,{width:u,height:f}),d=Math.cos(-l),m=Math.sin(-l),g=u/2,p=f/2;u%2==0?(g-=.5,f%2==0?p-=.5:p=Math.floor(p)):(g=Math.floor(g),f%2==0?p-=.5:p=Math.floor(p));var w=Math.floor(a/2-g),v=Math.floor(s/2-p);switch(h){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,c,w,v,g,p,d,m);case validInterpolations.bilinear:return rotateBilinear(this,c,w,v,g,p,d,m);default:throw new Error("unsupported rotate interpolation: "+h)}}function rotateNearestNeighbor(t,e,r,i,n,a,o,s){for(var h=0;h<e.width;h+=1)for(var l=0;l<e.height;l+=1)for(var u=0;u<t.channels;u++){var f=Math.round((h-n)*o-(l-a)*s+n)+r,c=Math.round((l-a)*o+(h-n)*s+a)+i;f<0||f>=t.width||c<0||c>=t.height?1===t.alpha&&u===t.channels-1?e.setValueXY(h,l,u,0):e.setValueXY(h,l,u,t.maxValue):e.setValueXY(h,l,u,t.getValueXY(f,c,u))}return e}function rotateBilinear(t,e,r,i,n,a,o,s){for(var h=t.width*t.channels,l=0;l<e.height;l++)for(var u=0;u<e.width;u++)for(var f=(u-n)*o-(l-a)*s+n+r,c=(l-a)*o+(u-n)*s+a+i,d=0|f,m=0|c,g=f-d,p=c-m,w=0;w<t.channels;w++)if(f<0||f>=t.width||c<0||c>=t.height)1===t.alpha&&w===t.channels-1?e.setValueXY(u,l,w,0):e.setValueXY(u,l,w,t.maxValue);else{var v=(m*t.width+d)*t.channels+w,_=t.data[v],b=t.data[v+t.channels],y=t.data[v+h],M=_+g*(b-_)+p*(y-_)+g*p*(_-b-y+t.data[v+h+t.channels])|0;e.setValueXY(u,l,w,M)}return e}function rotate(t,e){if("number"!=typeof t)throw new TypeError("angle must be a number");switch(t<0&&(t=360*Math.ceil(-t/360)+t),t%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,t,e)}}function rotateLeft(){for(var t=Image.createFrom(this,{width:this.height,height:this.width}),e=t.height-1,r=0;r<this.height;r++)for(var i=0;i<this.width;i++)for(var n=0;n<this.channels;n++)t.setValueXY(r,e-i,n,this.getValueXY(i,r,n));return t}function rotateRight(){for(var t=Image.createFrom(this,{width:this.height,height:this.width}),e=t.width-1,r=0;r<this.height;r++)for(var i=0;i<this.width;i++)for(var n=0;n<this.channels;n++)t.setValueXY(e-r,i,n,this.getValueXY(i,r,n));return t}function rotate180(){for(var t=Image.createFrom(this),e=t.width-1,r=t.height-1,i=0;i<this.height;i++)for(var n=0;n<this.width;n++)for(var a=0;a<this.channels;a++)t.setValueXY(e-n,r-i,a,this.getValueXY(n,i,a));return t}function insert(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=getImageParameters(t);this.checkProcessable("insert",r);var i=e.x,n=void 0===i?0:i,a=e.y,o=void 0===a?0:a,s=getOutputImageOrInPlace(this,e,{copy:!0}),h=Math.min(s.height,o+t.height),l=Math.min(s.width,n+t.width);if(1===s.bitDepth)for(var u=o;u<h;u++)for(var f=n;f<l;f++){var c=t.getBitXY(f-n,u-o);c?s.setBitXY(f,u):s.clearBitXY(f,u)}else for(var d=o;d<h;d++)for(var m=n;m<l;m++)s.setPixelXY(m,d,t.getPixelXY(m-n,d-o));return s}function setBorder(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.size,r=void 0===e?0:e,i=t.algorithm,n=void 0===i?"copy":i,a=t.color;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),"set"===n){if(a.length!==this.channels)throw new Error("setBorder: the color array must have the same length as the number of channels. Here: "+this.channels);for(var o=0;o<a.length;o++)0===a[o]&&(a[o]=.001)}else a=newArray_1(this.channels,null);Array.isArray(r)||(r=[r,r]);for(var s=r[0],h=r[1],l=this.channels,u=s;u<this.width-s;u++)for(var f=0;f<l;f++){for(var c=a[f]||this.data[(u+this.width*h)*l+f],d=0;d<h;d++)this.data[(d*this.width+u)*l+f]=c;c=a[f]||this.data[(u+this.width*(this.height-h-1))*l+f];for(var m=this.height-h;m<this.height;m++)this.data[(m*this.width+u)*l+f]=c}for(var g=0;g<this.height;g++)for(var p=0;p<l;p++){for(var w=a[p]||this.data[(g*this.width+s)*l+p],v=0;v<s;v++)this.data[(g*this.width+v)*l+p]=w;w=a[p]||this.data[(g*this.width+this.width-s-1)*l+p];for(var _=this.width-s;_<this.width;_++)this.data[(g*this.width+_)*l+p]=w}return this}function split(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.preserveAlpha,r=void 0===e||e;if(this.checkProcessable("split",{bitDepth:[8,16]}),1===this.components)return new Stack([this.clone()]);var i=new Stack,n=this.data;if(this.alpha&&r)for(var a=0;a<this.components;a++){for(var o=Image.createFrom(this,{components:1,alpha:!0,colorModel:GREY}),s=0,h=0;h<n.length;h+=this.channels)o.data[s++]=n[h+a],o.data[s++]=n[h+this.components];i.push(o)}else for(var l=0;l<this.channels;l++){for(var u=Image.createFrom(this,{components:1,alpha:!1,colorModel:GREY}),f=0,c=0;c<n.length;c+=this.channels)u.data[f++]=n[c+l];i.push(u)}return i}function getChannel(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.keepAlpha,i=void 0!==r&&r,n=e.mergeAlpha,a=void 0!==n&&n;i&=this.alpha,a&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),t=validateChannel(this,t);for(var o=Image.createFrom(this,{components:1,alpha:i,colorModel:GREY}),s=0,h=0;h<this.data.length;h+=this.channels)a?o.data[s++]=this.data[h+t]*this.data[h+this.components]/this.maxValue:(o.data[s++]=this.data[h+t],i&&(o.data[s++]=this.data[h+this.components]));return o}function combineChannels(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:defaultCombineMethod,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.mergeAlpha,i=void 0!==r&&r,n=e.keepAlpha,a=void 0!==n&&n;i&=this.alpha,a&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});for(var o=Image.createFrom(this,{components:1,alpha:a,colorModel:GREY}),s=0,h=0;h<this.size;h++){var l=t(this.getPixel(h));i?o.data[s++]=l*this.data[h*this.channels+this.components]/this.maxValue:(o.data[s++]=l,a&&(o.data[s++]=this.data[h*this.channels+this.components]))}return o}function defaultCombineMethod(t){return(t[0]+t[1]+t[2])/3}function setChannel(t,e){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),e.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),e.width!==this.width||e.height!==this.height)throw new Error("Images must have exactly the same width and height");for(var r=t=validateChannel(this,t),i=0;i<e.data.length;i++)this.data[r]=e.data[i],r+=this.channels;return this}function getSimilarity(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.shift,i=void 0===r?[0,0]:r,n=e.average,a=e.channels,o=e.defaultAlpha,s=e.normalize,h=e.border,l=void 0===h?[0,0]:h;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(l)||(l=[l,l]),a=validateArrayOfChannels(this,{channels:a,defaultAlpha:o}),this.bitDepth!==t.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==t.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==t.colorModel)throw new Error("Both images must have the same colorModel");void 0===n&&(n=!0);for(var u=Math.max(l[0],-i[0]),f=Math.min(this.width-l[0],this.width-i[0]),c=Math.max(l[1],-i[1]),d=Math.min(this.height-l[1],this.height-i[1]),m=newArray_1(a.length,0),g=0;g<a.length;g++){var p=a[g],w=s?this.sum[p]:Math.max(this.sum[p],t.sum[p]),v=s?t.sum[p]:Math.max(this.sum[p],t.sum[p]);if(0!==w&&0!==v)for(var _=u;_<f;_++)for(var b=c;b<d;b++){var y=_*this.multiplierX+b*this.multiplierY+p,M=y+i[0]*this.multiplierX+i[1]*this.multiplierY;m[g]+=Math.min(this.data[y]/w,t.data[M]/v)}}return n?m.reduce((t,e)=>t+e)/m.length:m}function getPixelsGrid(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.sampling,r=void 0===e?[10,10]:e,i=t.painted,n=void 0!==i&&i,a=t.mask;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(r)||(r=[r,r]);for(var o=r[0],s=r[1],h=[],l=[],u=this.width/o,f=this.height/s,c=Math.floor(u/2),d=0;d<o;d++){for(var m=Math.floor(f/2),g=0;g<s;g++){var p=Math.round(c),w=Math.round(m);a&&!a.getBitXY(p,w)||(h.push([p,w]),l.push(this.getPixelXY(p,w))),m+=f}c+=u}var v={xyS:h,zS:l};return n&&(v.painted=this.rgba8().paintPoints(h)),v}function Matrix$2(t,e,r){for(var i=new Array(t),n=0;n<t;n++)i[n]=new Array(e);if(r)for(var a=0;a<t;a++)for(var o=0;o<e;o++)i[a][o]=r;return i.width=t,i.height=e,Object.setPrototypeOf(i,Matrix$2.prototype),i}function match(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.border;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==t.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==t.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==t.colorModel)throw new Error("Both images must have the same colorModel");for(var i=new Matrix$2(t.width,t.height,-1/0),n=Math.floor(t.width/2),a=Math.floor(t.height/2),o=n,s=a,h=!1;!h;){for(var l=i.localSearch(n,a,-1/0),u=0;u<l.length;u++){var f=l[u],c=this.getSimilarity(t,{border:r,shift:[o-f[0],s-f[1]]});i[f[0]][f[1]]=c}var d=i.localMax(n,a);d.position[0]!==n||d.position[1]!==a?(n=d.position[0],a=d.position[1]):h=!0}return[n-o,a-s]}function getRow(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,t),checkChannel(this,e);for(var r=new Array(this.width),i=0,n=t*this.width*this.channels+e,a=n+this.width*this.channels,o=n;o<a;o+=this.channels)r[i++]=this.data[o];return r}function getColumn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,t),checkChannel(this,e);for(var r=new Array(this.height),i=0,n=this.width*this.channels,a=e+t*this.channels;a<this.data.length;a+=n)r[i++]=this.data[a];return r}function getMatrix(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.channel;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),void 0===e){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");e=0}for(var r=new Matrix(this.height,this.width),i=0;i<this.height;i++)for(var n=0;n<this.width;n++)r.set(i,n,this.getValueXY(n,i,e));return r}function setMatrix(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=new Matrix(t);var r=e.channel;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),void 0===r){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}if(this.width!==t.columns||this.height!==t.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(var i=0;i<this.height;i++)for(var n=0;n<this.width;n++)this.setValueXY(n,i,r,t.get(i,n))}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});for(var t=new Array(this.size),e=0,r=0;r<this.data.length;r+=this.channels){for(var i=new Array(this.components),n=0;n<this.components;n++)i[n]=this.data[r+n];t[e++]=i}return t}function getIntersection(t){for(var e=this.getClosestCommonParent(t),r=this.getRelativePosition(e,{defaultFurther:!0}),i=getRelativePositionForAllPixels(this,r),n=t.getRelativePosition(e,{defaultFurther:!0}),a=getRelativePositionForAllPixels(t,n),o=getCommonSurface(i,a),s={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]},h=0;h<o.length;h++){var l=o[h],u=[l[0]-r[0],l[1]-r[1]],f=[l[0]-n[0],l[1]-n[1]],c=this.getBitXY(u[0],u[1]),d=t.getBitXY(f[0],f[1]);1===c&&1===d&&s.commonWhitePixels.push(l)}for(var m=0;m<i.length;m++){var g=void 0,p=void 0;0!==m&&(g=Math.floor(m/(this.width-1)),p=m%(this.width-1)),1===this.getBitXY(g,p)&&s.whitePixelsMask1.push(i[m])}for(var w=0;w<a.length;w++){var v=0,_=0;0!==w&&(v=Math.floor(w/(t.width-1)),_=w%(t.width-1)),1===t.getBitXY(v,_)&&s.whitePixelsMask2.push(a[w])}return s}function getRelativePositionForAllPixels(t,e){for(var r=[],i=0;i<t.height;i++)for(var n=0;n<t.width;n++){var a=[i,n];r.push([a[0]+e[0],a[1]+e[1]])}return r}function getCommonSurface(t,e){for(var r=0,i=0,n=[];r<t.length&&i<e.length;)t[r][0]===e[i][0]&&t[r][1]===e[i][1]?(n.push(t[r]),r++,i++):t[r][0]<e[i][0]||t[r][0]===e[i][0]&&t[r][1]<e[i][1]?r++:i++;return n}function getClosestCommonParent(t){var e,r=getDepth(this),i=getDepth(t);if(e=r>=i?getFurthestParent(this,r):getFurthestParent(t,i),0===r||0===i)return e;for(var n=this,a=t;r!==i;)if(r>i){if(null===(n=n.parent))return e;r-=1}else{if(null===(a=a.parent))return e;i-=1}for(;n!==a&&null!==n&&null!==a;)if(n=n.parent,a=a.parent,null===n||null===a)return e;return n!==a?e:n}function getDepth(t){for(var e=0,r=t;null!=r.parent;)r=r.parent,e++;return e}function getFurthestParent(t,e){for(var r=t;e>0;)r=r.parent,e-=1;return r}Matrix$2.prototype.localMin=function(t,e){for(var r=this[t][e],i=[t,e],n=Math.max(0,t-1);n<Math.min(this.length,t+2);n++)for(var a=Math.max(0,e-1);a<Math.min(this[0].length,e+2);a++)this[n][a]<r&&(r=this[n][a],i=[n,a]);return{position:i,value:r}},Matrix$2.prototype.localMax=function(t,e){for(var r=this[t][e],i=[t,e],n=Math.max(0,t-1);n<Math.min(this.length,t+2);n++)for(var a=Math.max(0,e-1);a<Math.min(this[0].length,e+2);a++)this[n][a]>r&&(r=this[n][a],i=[n,a]);return{position:i,value:r}},Matrix$2.prototype.localSearch=function(t,e,r){for(var i=[],n=Math.max(0,t-1);n<Math.min(this.length,t+2);n++)for(var a=Math.max(0,e-1);a<Math.min(this[0].length,e+2);a++)this[n][a]===r&&i.push([n,a]);return i};const defaultOptions$c={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(t,e){t.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),e=Object.assign({},defaultOptions$c,e);const r=t.width,i=t.height,n=t.maxValue,a={sigma:e.gaussianBlur,radius:3},o=t.gaussianFilter(a),s=o.convolution(Gy,convOptions),h=o.convolution(Gx,convOptions),l=h.hypotenuse(s),u=t.constructor,f=new u(r,i,{kind:"GREY",bitDepth:32}),c=new u(r,i,{kind:"GREY",bitDepth:32}),d=new u(r,i,{kind:"GREY"});for(var m=1;m<r-1;m++)for(var g=1;g<i-1;g++){var p=(Math.round(Math.atan2(h.getValueXY(m,g,0),s.getValueXY(m,g,0))*(5/Math.PI))+5)%5;0===p&&(l.getValueXY(m,g,0)<=l.getValueXY(m,g-1,0)||l.getValueXY(m,g,0)<=l.getValueXY(m,g+1,0))||1===p&&(l.getValueXY(m,g,0)<=l.getValueXY(m-1,g+1,0)||l.getValueXY(m,g,0)<=l.getValueXY(m+1,g-1,0))||2===p&&(l.getValueXY(m,g,0)<=l.getValueXY(m-1,g,0)||l.getValueXY(m,g,0)<=l.getValueXY(m+1,g,0))||3===p&&(l.getValueXY(m,g,0)<=l.getValueXY(m-1,g-1,0)||l.getValueXY(m,g,0)<=l.getValueXY(m+1,g+1,0))||f.setValueXY(m,g,0,l.getValueXY(m,g,0))}for(m=0;m<r*i;++m){var w=f.data[m],v=0;w>e.highThreshold&&(v++,d.data[m]=n),w>e.lowThreshold&&v++,c.data[m]=v}var _=[];for(m=1;m<r-1;++m)for(g=1;g<i-1;++g)if(1===c.getValueXY(m,g,0))t:for(var b=m-1;b<m+2;++b)for(var y=g-1;y<g+2;++y)if(2===c.getValueXY(b,y,0)){_.push([m,g]),d.setValueXY(m,g,0,n);break t}for(;_.length>0;){var M=[];for(m=0;m<_.length;++m)for(g=-1;g<2;++g)for(b=-1;b<2;++b)if(0!==g||0!==b){var x=_[m][0]+g,E=_[m][1]+b;1===c.getValueXY(x,E,0)&&0===d.getValueXY(x,E,0)&&(M.push([x,E]),d.setValueXY(x,E,0,n))}_=M}return d}function cannyEdge(t){return cannyEdgeDetector(this,t)}function extract(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.position;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!r&&!(r=t.getRelativePosition(this)))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){for(var i=Image.createFrom(this,{width:t.width,height:t.height,alpha:1,position:r,parent:this}),n=0;n<t.width;n++)for(var a=0;a<t.height;a++){for(var o=0;o<this.channels;o++){var s=this.getValueXY(n+r[0],a+r[1],o);i.setValueXY(n,a,o,s)}t.getBitXY(n,a)||i.setValueXY(n,a,this.components,0)}return i}for(var h=Image.createFrom(this,{width:t.width,height:t.height,position:r,parent:this}),l=0;l<t.height;l++)for(var u=0;u<t.width;u++)t.getBitXY(u,l)&&this.getBitXY(u+r[0],l+r[1])&&h.setBitXY(u,l);return h}var fastList=createCommonjsModule((function(t,e){!function(){function e(t,e,r){this.next=r,r&&(r.prev=this),this.prev=e,e&&(e.next=this),this.data=t}function r(){if(!(this instanceof r))return new r;this._head=null,this._tail=null,this.length=0}r.prototype={push:function(t){this._tail=new e(t,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(0!==this.length){var t=this._tail;return this._tail=t.prev,t.prev&&(t.prev=this._tail.next=null),this.length--,1===this.length?this._head=this._tail:0===this.length&&(this._head=this._tail=null),t.data}},unshift:function(t){this._head=new e(t,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(0!==this.length){var t=this._head;return this._head=t.next,t.next&&(t.next=this._head.prev=null),this.length--,1===this.length?this._tail=this._head:0===this.length&&(this._head=this._tail=null),t.data}},item:function(t){t<0&&(t=this.length+t);for(var e=this._head;t-- >0&&e;)e=e.next;return e?e.data:void 0},slice:function(t,e){if(t||(t=0),e||(e=this.length),e<0&&(e=this.length+e),t<0&&(t=this.length+t),e===t)return[];if(e<t)throw new Error("invalid offset: "+t+","+e+" (length="+this.length+")");for(var r=e-t,i=new Array(r),n=0,a=this._head;t-- >0&&a;)a=a.next;for(;n<r&&a;)i[n++]=a.data,a=a.next;return i},drop:function(){r.call(this)},forEach:function(t,e){for(var r=this._head,i=0,n=this.length;i<n&&r;)t.call(e||this,r.data,i,this),r=r.next,i++},map:function(t,e){var i=new r;return this.forEach((function(r,n,a){i.push(t.call(e||a,r,n,a))})),i},filter:function(t,e){var i=new r;return this.forEach((function(r,n,a){t.call(e||a,r,n,a)&&i.push(r)})),i},reduce:function(t,e,r){var i=0,n=this._head,a=this.length;for(e||(i=1,e=n&&n.data,n=n&&n.next);i<a&&n;)e=t.call(r||this,e,n.data,this),i++,n=n.next;return e}},t.exports=r}()}));function floodFill(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.x,r=void 0===e?0:e,i=t.y,n=void 0===i?0:i,a=t.inPlace,o=void 0===a||a,s=o?this:Image.createFrom(this);this.checkProcessable("floodFill",{bitDepth:1});var h=this.getBitXY(r,n);if(h)return s;var l=new fastList;for(l.push(new Node(r,n));l.length>0;){var u=l.shift();s.setBitXY(u.x,u.y);for(var f=u.x+1;f<this.width&&(!s.getBitXY(f,u.y)&&!this.getBitXY(f,u.y));f++)s.setBitXY(f,u.y),u.y+1<this.height&&!this.getBitXY(f,u.y+1)&&l.push(new Node(f,u.y+1)),u.y-1>=0&&!this.getBitXY(f,u.y-1)&&l.push(new Node(f,u.y-1));for(var c=u.x-1;c>=0&&(!s.getBitXY(c,u.y)&&!this.getBitXY(c,u.y));c++)s.setBitXY(c,u.y),u.y+1<this.height&&!this.getBitXY(c,u.y+1)&&l.push(new Node(c,u.y+1)),u.y-1>=0&&!this.getBitXY(c,u.y-1)&&l.push(new Node(c,u.y-1))}return s}function Node(t,e){this.x=t,this.y=e}function hsv2rgb(t,e,r){var i=[],n=(r/=100)*(e/=100),a=t/60,o=n*(1-Math.abs(a%2-1)),s=r-n;switch(parseInt(a,10)){case 0:i=[n,o,0];break;case 1:i=[o,n,0];break;case 2:i=[0,n,o];break;case 3:i=[0,o,n];break;case 4:i=[o,0,n];break;case 5:i=[n,0,o]}return{r:Math.round(255*(i[0]+s)),g:Math.round(255*(i[1]+s)),b:Math.round(255*(i[2]+s))}}function hsl2hsv(t,e,r){return{h:t,s:2*(e*=(r<50?r:100-r)/100)/(r+e)*100,v:r+e}}function hsl2rgb(t,e,r){var i=hsl2hsv(t,e,r);return hsv2rgb(i.h,i.s,i.v)}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable})))),i.forEach((function(e){_defineProperty(t,e,r[e])}))}return t}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(t){return named(t)||hex3(t)||hex6(t)||rgb(t)||rgba$1(t)||hsl$1(t)||hsla(t)}function named(t){var e=colors[t.toLowerCase()];if(e)return{r:e[0],g:e[1],b:e[2],a:100}}function rgb(t){var e=t.match(/rgb\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:100}}}function rgba$1(t){var e=t.match(/rgba\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:100*r[3]}}}function hex6(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:100}}function hex3(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:100}}function hsl$1(t){var e=t.match(/hsl\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */);return _objectSpread({},hsl2rgb(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)),{a:100})}}function hsla(t){var e=t.match(/hsla\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */),i=parseInt(r[0],10),n=parseInt(r[1],10),a=parseInt(r[2],10),o=parseInt(100*parseFloat(r[3]),10);return _objectSpread({},hsl2rgb(i,n,a),{a:o})}}function css2array(t){var e=parse(t);return[e.r,e.g,e.b,Math.round(255*e.a/100)]}function hue2rgb(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function hsl2rgb$1(t,e,r){var i,n,a,o,s,h;return r/=100,0===(e/=100)?o=s=h=255*r:(o=hue2rgb(i=2*r-(n=r<=.5?r*(e+1):r+e-r*e),n,(a=t/360)+1/3),s=hue2rgb(i,n,a),h=hue2rgb(i,n,a-1/3)),{r:o,g:s,b:h}}function getDistinctColors(t){for(var e=new Array(t),r=0,i=0;i<360;i+=360/t){var n=hsl2rgb$1(i,100,30+ ++r%4*15);e[r-1]=[Math.round(255*n.r),Math.round(255*n.g),Math.round(255*n.b)]}return e}function getRandomColor(){return[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())]}function getColors(t){var e=t.color,r=t.colors,i=t.randomColors,n=t.numberColors,a=void 0===n?50:n;if(e&&!Array.isArray(e)&&(e=css2array(e)),e)return[e];if(r)return r=r.map((function(t){return Array.isArray(t)?t:css2array(t)}));if(i){r=new Array(a);for(var o=0;o<a;o++)r[o]=getRandomColor()}return getDistinctColors(a)}function paintLabels(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.color,n=void 0===i?"blue":i,a=r.colors,o=r.font,s=void 0===o?"12px Helvetica":o,h=r.rotate,l=void 0===h?0:h;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB}),!Array.isArray(t))throw Error("paintLabels: labels must be an array");if(!Array.isArray(e))throw Error("paintLabels: positions must be an array");if(n&&!Array.isArray(n)&&(n=css2array(n)),a=a?a.map((function(t){return Array.isArray(t)?t:css2array(t)})):[n],t.length!==e.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(s)||(s=[s]),Array.isArray(l)||(l=[l]);for(var u=this.getCanvas(),f=u.getContext("2d"),c=0;c<t.length;c++){f.save();var d=a[c%a.length];f.fillStyle=`rgba(${d[0]},${d[1]},${d[2]},${d[3]/this.maxValue})`,f.font=s[c%s.length];var m=e[c];f.translate(m[0],m[1]),f.rotate(l[c%l.length]/180*Math.PI),f.fillText(t[c],0,0),f.restore()}return this.data=Uint8Array.from(f.getImageData(0,0,this.width,this.height).data),this}function paintMasks(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.alpha,i=void 0===r?255:r,n=e.labels,a=void 0===n?[]:n,o=e.labelsPosition,s=void 0===o?[]:o,h=e.labelColor,l=void 0===h?"blue":h,u=e.labelFont,f=void 0===u?"12px Helvetica":u;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB});var c=getColors(Object.assign({},e,{numberColors:t.length}));Array.isArray(t)||(t=[t]);for(var d=0;d<t.length;d++)for(var m=t[d],g=c[d%c.length],p=0;p<m.width;p++)for(var w=0;w<m.height;w++)if(m.getBitXY(p,w))for(var v=0;v<Math.min(this.components,g.length);v++)if(255===i)this.setValueXY(p+m.position[0],w+m.position[1],v,g[v]);else{var _=this.getValueXY(p+m.position[0],w+m.position[1],v);_=Math.round((_*(255-i)+g[v]*i)/255),this.setValueXY(p+m.position[0],w+m.position[1],v,_)}if(Array.isArray(a)&&a.length>0){var b=this.getCanvas(),y=b.getContext("2d");y.fillStyle=l,y.font=f;for(var M=0;M<Math.min(t.length,a.length);M++){var x=s[M]?s[M]:t[M].position;y.fillText(a[M],x[0],x[1])}this.data=Uint8Array.from(y.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(t,e){for(var r=new Array(t),i=0;i<t;i++)r[i]=new Array(e).fill(0);return r}var cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.kind,r=void 0===e?"cross":e,i=t.shape,n=t.size,a=t.width,o=t.height,s=t.filled,h=void 0===s||s;if(n&&(a=n,o=n),i)switch(i.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(a,o,{filled:h});break;case"circle":case"ellipse":this.matrix=ellipse(a,o,{filled:h});break;case"triangle":this.matrix=triangle$1(a,o,{filled:h});break;default:throw new Error("Shape: unexpected shape: "+i)}else{if(!r)throw new Error("Shape: expected a kind or a shape option");switch(r.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error("Shape: unexpected kind: "+r)}}this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){for(var t=this.matrix,e=[],r=0;r<t.length;r++)for(var i=0;i<t[0].length;i++)t[r][i]&&e.push([i-this.halfWidth,r-this.halfHeight]);return e}getMask(){for(var t=new Image(this.width,this.height,{kind:BINARY}),e=0;e<this.matrix.length;e++)for(var r=0;r<this.matrix[0].length;r++)this.matrix[e][r]&&t.setBitXY(r,e);return t}}function rectangle(t,e,r){var i=zerosMatrix(e,t);if(r.filled)for(var n=0;n<e;n++)for(var a=0;a<t;a++)i[n][a]=1;else{for(var o of[0,e-1])for(var s=0;s<t;s++)i[o][s]=1;for(var h=0;h<e;h++)for(var l of[0,t-1])i[h][l]=1}return i}function ellipse(t,e,r){var i=zerosMatrix(e,t),n=1-e%2,a=1-t%2,o=Math.floor((t-1)/2),s=Math.floor((e-1)/2),h=o*o,l=s*s;if(r.filled)for(var u=0;u<=s;u++)for(var f=o-Math.floor(Math.sqrt(h-h*u*u/l));f<=o;f++)i[s-u][f]=1,i[s+u+n][f]=1,i[s-u][t-f-1]=1,i[s+u+n][t-f-1]=1;else{for(var c=0;c<=s;c++){var d=o-Math.floor(Math.sqrt(h-h*c*c/l));i[s-c][d]=1,i[s+c+n][d]=1,i[s-c][t-d-1]=1,i[s+c+n][t-d-1]=1}for(var m=0;m<=o;m++){var g=s-Math.floor(Math.sqrt(l-l*m*m/h));i[g][o-m]=1,i[g][o+m+a]=1,i[e-g-1][o-m]=1,i[e-g-1][o+m+a]=1}}return i}function triangle$1(t,e,r){if(!r.filled)throw new Error("Non filled triangle is not implemented");for(var i=zerosMatrix(e,t),n=0;n<e;n++)for(var a=Math.floor((1-n/e)*t/2),o=a;o<t-a;o++)i[n][o]=1;return i}function paintPoints(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.shape;this.checkProcessable("paintPoints",{bitDepth:[8,16]});for(var i=getColors(Object.assign({},e,{numberColors:t.length})),n=new Shape(r).getPoints(),a=Math.min(this.channels,i[0].length),o=0;o<t.length;o++)for(var s=i[o%i.length],h=t[o][0],l=t[o][1],u=0;u<n.length;u++){var f=n[u][0],c=n[u][1];if(h+f>=0&&l+c>=0&&h+f<this.width&&l+c<this.height)for(var d=(h+f+(l+c)*this.width)*this.channels,m=0;m<a;m++)this.data[d+m]=s[m]}return this}function paintPolyline(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.color,i=void 0===r?[this.maxValue,0,0]:r,n=e.closed,a=void 0!==n&&n;this.checkProcessable("paintPoints",{bitDepth:[8,16]});for(var o=Math.min(this.channels,i.length),s=0;s<t.length-1+a;s++)for(var h=t[s],l=t[(s+1)%t.length],u=l[0]-h[0],f=l[1]-h[1],c=Math.max(Math.abs(u),Math.abs(f)),d=u/c,m=f/c,g=h[0],p=h[1],w=0;w<=c;w++){var v=Math.round(g),_=Math.round(p);if(v>=0&&_>=0&&v<this.width&&_<this.height)for(var b=(v+_*this.width)*this.channels,y=0;y<o;y++)this.data[b+y]=i[y];g+=d,p+=m}return this}function paintPolylines(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object.assign({},e);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});for(var i=getColors(Object.assign({},e,{numberColors:t.length})),n=0;n<t.length;n++)r.color=i[n%i.length],this.paintPolyline(t[n],r);return this}function deleteDouble(t){for(var e=[],r=0;r<t.length;r++)t[r][0]===t[(r+1)%t.length][0]&&t[r][1]===t[(r+1)%t.length][1]||t[r][0]===t[(r-1+t.length)%t.length][0]&&t[r][1]===t[(r-1+t.length)%t.length][1]||t[(r+1)%t.length][0]===t[(r-1+t.length)%t.length][0]&&t[(r-1+t.length)%t.length][1]===t[(r+1)%t.length][1]||e.push(t[r]);return e}function lineBetweenTwoPoints(t,e){if(t[0]===e[0])return{a:0,b:t[0],vertical:!0};var r=(e[1]-t[1])/(e[0]-t[0]);return{a:r,b:t[1]-r*t[0],vertical:!1}}function isAtTheRightOfTheLine(t,e,r,i){if(!0===r.vertical)return r.b<=t;if(0===r.a)return!1;var n=(e-r.b)/r.a;return n<t&&n>=0&&n<=i}function paintPolygon(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.color,i=void 0===r?[this.maxValue,0,0]:r,n=e.filled,a=void 0!==n&&n;this.checkProcessable("paintPoints",{bitDepth:[8,16]}),e.closed=!0;var o=deleteDouble(t);if(!1===a)return this.paintPolyline(t,e);for(var s=Array(this.height),h=0;h<this.height;h++){s[h]=[];for(var l=0;l<this.width;l++)s[h].push(0)}for(var u=0;u<o.length;u++)for(var f=lineBetweenTwoPoints(o[u],o[(u+1)%o.length]),c=0;c<this.height;c++)for(var d=0;d<this.width;d++)isAtTheRightOfTheLine(d,c,f,this.height)&&(s[c][d]=0===s[c][d]?1:0);for(var m=0;m<this.height;m++)for(var g=0;g<this.width;g++)if(1===s[m][g])for(var p=Math.min(this.channels,i.length),w=(g+m*this.width)*this.channels,v=0;v<p;v++)this.data[w+v]=i[v];return this.paintPolyline(t,e)}function paintPolygons(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object.assign({},e);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});for(var i=getColors(Object.assign({},e,{numberColors:t.length})),n=0;n<t.length;n++)r.color=i[n%i.length],this.paintPolygon(t[n],r);return this}function getHistogram(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.maxSlots,r=void 0===e?256:e,i=t.channel,n=t.useAlpha,a=void 0===n||n;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),void 0===i){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");i=0}return getChannelHistogram.call(this,i,{useAlpha:a,maxSlots:r})}function getHistograms(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.maxSlots,r=void 0===e?256:e,i=t.useAlpha,n=void 0===i||i;this.checkProcessable("getHistograms",{bitDepth:[8,16]});for(var a=new Array(n?this.components:this.channels),o=0;o<a.length;o++)a[o]=getChannelHistogram.call(this,o,{useAlpha:n,maxSlots:r});return a}function getChannelHistogram(t,e){var r=e.useAlpha,i=e.maxSlots;if(1===this.bitDepth){for(var n=[0,0],a=0;a<this.height;a++)for(var o=0;o<this.width;o++){var s=this.getBitXY(a,o);0===s?n[0]+=1:1===s&&(n[1]+=1)}return n}var h=Math.log2(i);if(!isInteger(h))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");var l=0;this.bitDepth>h&&(l=this.bitDepth-h);var u=this.data,f=newArray_1(Math.pow(2,Math.min(this.bitDepth,h)),0);if(r&&this.alpha)for(var c=this.channels-t-1,d=t;d<u.length;d+=this.channels)f[u[d]>>l]+=u[d+c]/this.maxValue;else for(var m=t;m<u.length;m+=this.channels)f[u[m]>>l]++;return f}function getColorHistogram(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.useAlpha,r=void 0===e||e,i=t.nbSlots,n=void 0===i?512:i;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});var a=Math.log(n)/Math.log(8);if(a!==Math.floor(a))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");for(var o=this.bitDepth-a,s=this.data,h=newArray_1(Math.pow(8,a),0),l=Math.pow(2,2*a),u=Math.pow(2,a),f=0;f<s.length;f+=this.channels){var c=(s[f]>>o)*l+(s[f+1]>>o)*u+(s[f+2]>>o);r&&this.alpha?h[c]+=s[f+this.channels-1]/this.maxValue:h[c]++}return h}function min$2(){this.checkProcessable("min",{bitDepth:[8,16,32]});for(var t=newArray_1(this.channels,1/0),e=0;e<this.data.length;e+=this.channels)for(var r=0;r<this.channels;r++)this.data[e+r]<t[r]&&(t[r]=this.data[e+r]);return t}function max$2(){this.checkProcessable("max",{bitDepth:[8,16,32]});for(var t=newArray_1(this.channels,-1/0),e=0;e<this.data.length;e+=this.channels)for(var r=0;r<this.channels;r++)this.data[e+r]>t[r]&&(t[r]=this.data[e+r]);return t}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});for(var t=newArray_1(this.channels,0),e=0;e<this.data.length;e+=this.channels)for(var r=0;r<this.channels;r++)t[r]+=this.data[e+r];return t}function getMoment(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.checkProcessable("getMoment",{bitDepth:[1]});for(var r=0,i=0;i<this.width;i++)for(var n=0;n<this.height;n++)1===this.getBitXY(i,n)&&(r+=Math.pow(i,t)*Math.pow(n,e));return r}function localMaxima(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.mask,r=t.region,i=void 0===r?3:r,n=t.removeClosePoints,a=void 0===n?0:n,o=t.invert,s=void 0!==o&&o,h=t.maxEquals,l=void 0===h?2:h,u=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1});for(var f=s?0:1,c=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],d=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],m=(i*=4)<=8?1:2,g=[],p=m;p<u.height-m;p++)for(var w=m;w<u.width-m;w++)if(!e||e.getBitXY(w,p)===f){for(var v=0,_=0,b=u.data[w+p*u.width],y=0;y<i;y++)s?u.data[w+c[y]+(p+d[y])*u.width]>b&&v++:u.data[w+c[y]+(p+d[y])*u.width]<b&&v++,u.data[w+c[y]+(p+d[y])*u.width]===b&&_++;v+_===i&&_<=l&&g.push([w,p])}if(a>0)for(var M=0;M<g.length;M++)for(var x=M+1;x<g.length;x++)Math.sqrt(Math.pow(g[M][0]-g[x][0],2)+Math.pow(g[M][1]-g[x][1],2))<a&&(g[M][0]=g[M][0]+g[x][0]>>1,g[M][1]=g[M][1]+g[x][1]>>1,g.splice(x,1),x--);return g}function mean$2(){for(var t=this.getHistograms({maxSlots:this.maxValue+1}),e=new Array(t.length),r=0;r<t.length;r++){var i=t[r];e[r]=mean(i)}return e}function median$2(){for(var t=this.getHistograms({maxSlots:this.maxValue+1}),e=new Array(t.length),r=0;r<t.length;r++){var i=t[r];e[r]=median(i)}return e}function points(){this.checkProcessable("points",{bitDepth:[1]});for(var t=[],e=0;e<this.width;e++)for(var r=0;r<this.height;r++)1===this.getBitXY(e,r)&&t.push([e,r]);return t}function getRelativePosition(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this===t)return[0,0];for(var r=[0,0],i=this;i;){if(i===t)return r;i.position&&(r[0]+=i.position[0],r[1]+=i.position[1]),i=i.parent}return!!e.defaultFurther&&r}function countAlphaPixels(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.alpha,r=void 0===e?1:e;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});var i=0;if(void 0!==r){for(var n=this.components;n<this.data.length;n+=this.channels)this.data[n]===r&&i++;return i}return this.size}function monotoneChainConvexHull(t,e={}){e.sorted||t.sort(byXThenY);const r=t.length,i=new Array(2*r);for(var n=0,a=0;a<r;a++){const e=t[a];for(;n>=2&&cw(i[n-2],i[n-1],e)<=0;)n--;i[n++]=e}const o=n+1;for(a=r-2;a>=0;a--){const e=t[a];for(;n>=o&&cw(i[n-2],i[n-1],e)<=0;)n--;i[n++]=e}return i.slice(0,n-1)}function cw(t,e,r){return(e[1]-t[1])*(r[0]-t[0])-(e[0]-t[0])*(r[1]-t[1])}function byXThenY(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}function monotoneChainConvexHull$1(){return this.checkProcessable("monotoneChainConvexHull",{bitDepth:1}),monotoneChainConvexHull(this.getPoints(),{sorted:!0})}function difference(t,e){return[t[0]-e[0],t[1]-e[1]]}function normalize(t){var e=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2));return[t[0]/e,t[1]/e]}function rotate$1(t,e,r){void 0===r&&(r=new Array(e.length));for(var i=Math.cos(t),n=Math.sin(t),a=0;a<r.length;++a)r[a]=[i*e[a][0]-n*e[a][1],n*e[a][0]+i*e[a][1]];return r}function minimalBoundingRectangle(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.originalPoints,r=void 0===e?monotoneChainConvexHull$1.call(this):e;if(0===r.length)return[];if(1===r.length)return[r[0],r[0],r[0],r[0]];for(var i,n=new Array(r.length),a=1/0,o=0,s=0;s<n.length;s++){var h=getAngle(r[s],r[(s+1)%n.length]);rotate$1(-h,r,n);for(var l=n[s][0],u=n[s][1],f=n[(s+1)%n.length][0],c=n[(s+1)%n.length][1],d=!0,m=0,g=0,p=0,w=0;w<n.length;w++){var v=n[w][0],_=n[w][1],b=(v-l)/(f-l);!0===d?(d=!1,m=b,g=b):(b<m&&(m=b),b>g&&(g=b));var y=(-(f-l)*_+f*u-c*l)/(f-l);Math.abs(y)>Math.abs(p)&&(p=y)}var M=[l+m*(f-l),u],x=[l+g*(f-l),u],E=Math.abs(p*(m-g)*(f-l));E<a&&(o=h,a=E,i=[M,x,[x[0],x[1]-p],[M[0],M[1]-p]])}return rotate$1(o,i,i),i}function getAngle(t,e){var r=normalize(difference(e,t)),i=Math.acos(r[0]);return r[1]<0?-i:i}function extend$1(t){var e={inPlace:!0};t.extendMethod("invert",invert),t.extendMethod("abs",abs),t.extendMethod("level",level,e),t.extendMethod("add",add,e),t.extendMethod("subtract",subtract,e),t.extendMethod("subtractImage",subtractImage),t.extendMethod("multiply",multiply,e),t.extendMethod("divide",divide,e),t.extendMethod("hypotenuse",hypotenuse$1),t.extendMethod("background",background),t.extendMethod("flipX",flipX),t.extendMethod("flipY",flipY),t.extendMethod("blurFilter",blurFilter),t.extendMethod("medianFilter",medianFilter),t.extendMethod("gaussianFilter",gaussianFilter),t.extendMethod("sobelFilter",sobelFilter),t.extendMethod("gradientFilter",gradientFilter),t.extendMethod("scharrFilter",scharrFilter),t.extendMethod("dilate",dilate),t.extendMethod("erode",erode),t.extendMethod("open",open),t.extendMethod("close",close),t.extendMethod("topHat",topHat),t.extendMethod("blackHat",blackHat),t.extendMethod("morphologicalGradient",morphologicalGradient),t.extendMethod("warpingFourPoints",warpingFourPoints),t.extendMethod("crop",crop),t.extendMethod("cropAlpha",cropAlpha),t.extendMethod("resize",resize).extendMethod("scale",resize),t.extendMethod("hsv",hsv),t.extendMethod("hsl",hsl),t.extendMethod("cmyk",cmyk),t.extendMethod("rgba8",rgba8),t.extendMethod("grey",grey).extendMethod("gray",grey),t.extendMethod("mask",mask),t.extendMethod("pad",pad),t.extendMethod("colorDepth",colorDepth),t.extendMethod("setBorder",setBorder,e),t.extendMethod("rotate",rotate),t.extendMethod("rotateLeft",rotateLeft),t.extendMethod("rotateRight",rotateRight),t.extendMethod("insert",insert),t.extendMethod("getRow",getRow),t.extendMethod("getColumn",getColumn),t.extendMethod("getMatrix",getMatrix),t.extendMethod("setMatrix",setMatrix),t.extendMethod("getPixelsArray",getPixelsArray),t.extendMethod("getIntersection",getIntersection),t.extendMethod("getClosestCommonParent",getClosestCommonParent),t.extendMethod("getThreshold",getThreshold$1),t.extendMethod("split",split),t.extendMethod("getChannel",getChannel),t.extendMethod("combineChannels",combineChannels),t.extendMethod("setChannel",setChannel),t.extendMethod("getSimilarity",getSimilarity),t.extendMethod("getPixelsGrid",getPixelsGrid),t.extendMethod("getBestMatch",match),t.extendMethod("cannyEdge",cannyEdge),t.extendMethod("convolution",convolution),t.extendMethod("extract",extract),t.extendMethod("floodFill",floodFill),t.extendMethod("paintLabels",paintLabels,e),t.extendMethod("paintMasks",paintMasks,e),t.extendMethod("paintPoints",paintPoints,e),t.extendMethod("paintPolyline",paintPolyline,e),t.extendMethod("paintPolylines",paintPolylines,e),t.extendMethod("paintPolygon",paintPolygon,e),t.extendMethod("paintPolygons",paintPolygons,e),t.extendMethod("countAlphaPixels",countAlphaPixels),t.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull$1),t.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),t.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),t.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),t.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),t.extendMethod("getMin",min$2).extendProperty("min",min$2),t.extendMethod("getMax",max$2).extendProperty("max",max$2),t.extendMethod("getSum",sum).extendProperty("sum",sum),t.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),t.extendMethod("getLocalMaxima",localMaxima),t.extendMethod("getMedian",median$2).extendProperty("median",median$2),t.extendMethod("getMean",mean$2).extendProperty("mean",mean$2),t.extendMethod("getPoints",points).extendProperty("points",points),t.extendMethod("getRelativePosition",getRelativePosition)}var twoProduct_1=twoProduct,SPLITTER=+(Math.pow(2,27)+1);function twoProduct(t,e,r){var i=t*e,n=SPLITTER*t,a=n-(n-t),o=t-a,s=SPLITTER*e,h=s-(s-e),l=e-h,u=o*l-(i-a*h-o*h-a*l);return r?(r[0]=u,r[1]=i,r):[u,i]}var robustSum=linearExpansionSum;function scalarScalar(t,e){var r=t+e,i=r-t,n=t-(r-i)+(e-i);return n?[n,r]:[r]}function linearExpansionSum(t,e){var r=0|t.length,i=0|e.length;if(1===r&&1===i)return scalarScalar(t[0],e[0]);var n,a,o=new Array(r+i),s=0,h=0,l=0,u=Math.abs,f=t[h],c=u(f),d=e[l],m=u(d);c<m?(a=f,(h+=1)<r&&(c=u(f=t[h]))):(a=d,(l+=1)<i&&(m=u(d=e[l]))),h<r&&c<m||l>=i?(n=f,(h+=1)<r&&(c=u(f=t[h]))):(n=d,(l+=1)<i&&(m=u(d=e[l])));for(var g,p,w=n+a,v=w-n,_=a-v,b=_,y=w;h<r&&l<i;)c<m?(n=f,(h+=1)<r&&(c=u(f=t[h]))):(n=d,(l+=1)<i&&(m=u(d=e[l]))),(_=(a=b)-(v=(w=n+a)-n))&&(o[s++]=_),b=y-((g=y+w)-(p=g-y))+(w-p),y=g;for(;h<r;)(_=(a=b)-(v=(w=(n=f)+a)-n))&&(o[s++]=_),b=y-((g=y+w)-(p=g-y))+(w-p),y=g,(h+=1)<r&&(f=t[h]);for(;l<i;)(_=(a=b)-(v=(w=(n=d)+a)-n))&&(o[s++]=_),b=y-((g=y+w)-(p=g-y))+(w-p),y=g,(l+=1)<i&&(d=e[l]);return b&&(o[s++]=b),y&&(o[s++]=y),s||(o[s++]=0),o.length=s,o}var twoSum=fastTwoSum;function fastTwoSum(t,e,r){var i=t+e,n=i-t,a=e-n,o=t-(i-n);return r?(r[0]=o+a,r[1]=i,r):[o+a,i]}var robustScale=scaleLinearExpansion;function scaleLinearExpansion(t,e){var r=t.length;if(1===r){var i=twoProduct_1(t[0],e);return i[0]?i:[i[1]]}var n=new Array(2*r),a=[.1,.1],o=[.1,.1],s=0;twoProduct_1(t[0],e,a),a[0]&&(n[s++]=a[0]);for(var h=1;h<r;++h){twoProduct_1(t[h],e,o);var l=a[1];twoSum(l,o[0],a),a[0]&&(n[s++]=a[0]);var u=o[1],f=a[1],c=u+f,d=f-(c-u);a[1]=c,d&&(n[s++]=d)}return a[1]&&(n[s++]=a[1]),0===s&&(n[s++]=0),n.length=s,n}var robustDiff=robustSubtract;function scalarScalar$1(t,e){var r=t+e,i=r-t,n=t-(r-i)+(e-i);return n?[n,r]:[r]}function robustSubtract(t,e){var r=0|t.length,i=0|e.length;if(1===r&&1===i)return scalarScalar$1(t[0],-e[0]);var n,a,o=new Array(r+i),s=0,h=0,l=0,u=Math.abs,f=t[h],c=u(f),d=-e[l],m=u(d);c<m?(a=f,(h+=1)<r&&(c=u(f=t[h]))):(a=d,(l+=1)<i&&(m=u(d=-e[l]))),h<r&&c<m||l>=i?(n=f,(h+=1)<r&&(c=u(f=t[h]))):(n=d,(l+=1)<i&&(m=u(d=-e[l])));for(var g,p,w=n+a,v=w-n,_=a-v,b=_,y=w;h<r&&l<i;)c<m?(n=f,(h+=1)<r&&(c=u(f=t[h]))):(n=d,(l+=1)<i&&(m=u(d=-e[l]))),(_=(a=b)-(v=(w=n+a)-n))&&(o[s++]=_),b=y-((g=y+w)-(p=g-y))+(w-p),y=g;for(;h<r;)(_=(a=b)-(v=(w=(n=f)+a)-n))&&(o[s++]=_),b=y-((g=y+w)-(p=g-y))+(w-p),y=g,(h+=1)<r&&(f=t[h]);for(;l<i;)(_=(a=b)-(v=(w=(n=d)+a)-n))&&(o[s++]=_),b=y-((g=y+w)-(p=g-y))+(w-p),y=g,(l+=1)<i&&(d=-e[l]);return b&&(o[s++]=b),y&&(o[s++]=y),s||(o[s++]=0),o.length=s,o}var orientation_1=createCommonjsModule((function(t){function e(t,e){for(var r=new Array(t.length-1),i=1;i<t.length;++i)for(var n=r[i-1]=new Array(t.length-1),a=0,o=0;a<t.length;++a)a!==e&&(n[o++]=t[i][a]);return r}function r(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",r(t.slice(0,e)),",",r(t.slice(e)),")"].join("")}function i(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var n=[],a=0;a<t.length;++a)n.push(["scale(",r(i(e(t,a))),",",(o=a,1&o?"-":""),t[0][a],")"].join(""));return n;var o}function n(t){for(var n=[],a=[],o=function(t){for(var e=new Array(t),r=0;r<t;++r){e[r]=new Array(t);for(var i=0;i<t;++i)e[r][i]=["m",i,"[",t-r-1,"]"].join("")}return e}(t),s=[],h=0;h<t;++h)0==(1&h)?n.push.apply(n,i(e(o,h))):a.push.apply(a,i(e(o,h))),s.push("m"+h);var l=r(n),u=r(a),f="orientation"+t+"Exact",c=["function ",f,"(",s.join(),"){var p=",l,",n=",u,",d=sub(p,n);return d[d.length-1];};return ",f].join("");return new Function("sum","prod","scale","sub",c)(robustSum,twoProduct_1,robustScale,robustDiff)}var a=n(3),o=n(4),s=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,r){var i,n=(t[1]-r[1])*(e[0]-r[0]),o=(t[0]-r[0])*(e[1]-r[1]),s=n-o;if(n>0){if(o<=0)return s;i=n+o}else{if(!(n<0))return s;if(o>=0)return s;i=-(n+o)}var h=33306690738754716e-32*i;return s>=h||s<=-h?s:a(t,e,r)},function(t,e,r,i){var n=t[0]-i[0],a=e[0]-i[0],s=r[0]-i[0],h=t[1]-i[1],l=e[1]-i[1],u=r[1]-i[1],f=t[2]-i[2],c=e[2]-i[2],d=r[2]-i[2],m=a*u,g=s*l,p=s*h,w=n*u,v=n*l,_=a*h,b=f*(m-g)+c*(p-w)+d*(v-_),y=7771561172376103e-31*((Math.abs(m)+Math.abs(g))*Math.abs(f)+(Math.abs(p)+Math.abs(w))*Math.abs(c)+(Math.abs(v)+Math.abs(_))*Math.abs(d));return b>y||-b>y?b:o(t,e,r,i)}];function h(t){var e=s[t.length];return e||(e=s[t.length]=n(t.length)),e.apply(void 0,t)}!function(){for(;s.length<=5;)s.push(n(s.length));for(var e=[],r=["slow"],i=0;i<=5;++i)e.push("a"+i),r.push("o"+i);var a=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(i=2;i<=5;++i)a.push("case ",i,":return o",i,"(",e.slice(0,i).join(),");");a.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),r.push(a.join(""));var o=Function.apply(void 0,r);for(t.exports=o.apply(void 0,[h].concat(s)),i=0;i<=5;++i)t.exports[i]=s[i]}()})),robustPnp=robustPointInPolygon;function robustPointInPolygon(t,e){for(var r=e[0],i=e[1],n=t.length,a=1,o=n,s=0,h=n-1;s<o;h=s++){var l=t[s],u=t[h],f=l[1],c=u[1];if(c<f){if(c<i&&i<f){if(0===(d=orientation_1(l,u,e)))return 0;a^=0<d|0}else if(i===f){if(f<t[(s+1)%n][1]){if(0===(d=orientation_1(l,u,e)))return 0;a^=0<d|0}}}else if(f<c){if(f<i&&i<c){if(0===(d=orientation_1(l,u,e)))return 0;a^=d<0|0}else if(i===f){if(t[(s+1)%n][1]<f){var d;if(0===(d=orientation_1(l,u,e)))return 0;a^=d<0|0}}}else if(i===f){var m=Math.min(l[0],u[0]),g=Math.max(l[0],u[0]);if(0===s){for(;h>0;){var p=(h+n-1)%n;if((_=t[p])[1]!==i)break;var w=_[0];m=Math.min(m,w),g=Math.max(g,w),h=p}if(0===h)return m<=r&&r<=g?0:1;o=h+1}for(var v=t[(h+n-1)%n][1];s+1<o;){var _;if((_=t[s+1])[1]!==i)break;w=_[0];m=Math.min(m,w),g=Math.max(g,w),s+=1}if(m<=r&&r<=g)return 0;var b=t[(s+1)%n][1];r<m&&v<i!=b<i&&(a^=1)}}return 2*a-1}class Roi{constructor(t,e){this.map=t,this.id=e,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.scale,i=void 0===r?1:r,n=e.kind;switch(void 0===n?"":n){case"contour":t=this.contourMask;break;case"box":t=this.boxMask;break;case"filled":t=this.filledMask;break;case"center":t=this.centerMask;break;case"hull":t=this.hullMask;break;case"mbr":t=this.mbrMask;break;default:t=this.mask}return i<1&&((t=t.resize({factor:i})).parent=this.mask.parent,t.position[0]+=this.minX,t.position[1]+=this.minY),t}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){var t=this.borderIDs,e=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];for(var r=this.internalIDs,i=0;i<t.length;i++)r.includes(t[i])||(this.computed.externalIDs.push(t[i]),this.computed.externalLengths.push(e[i]))}get externalIDs(){return this.computed.externalIDs||this._computExternalIDs(),this.computed.externalIDs}get externalLengths(){return this.computed.externalLengths||this._computExternalIDs(),this.computed.externalLengths}_computeBorderIDs(){var t=getBorders(this);this.computed.borderIDs=t.ids,this.computed.borderLengths=t.lengths}get borderIDs(){return this.computed.borderIDs||this._computeBorderIDs(),this.computed.borderIDs}get borderLengths(){return this.computed.borderLengths||this._computeBorderIDs(),this.computed.borderLengths}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){for(var t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),e=0;e<this.width;e++)for(var r=0;r<this.height;r++)this.map.data[e+this.minX+(r+this.minY)*this.map.width]===this.id&&(e>0&&e<this.width-1&&r>0&&r<this.height-1&&this.map.data[e-1+this.minX+(r+this.minY)*this.map.width]===this.id&&this.map.data[e+1+this.minX+(r+this.minY)*this.map.width]===this.id&&this.map.data[e+this.minX+(r-1+this.minY)*this.map.width]===this.id&&this.map.data[e+this.minX+(r+1+this.minY)*this.map.width]===this.id||t.setBitXY(e,r));this.computed.contourMask=t}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){for(var t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),e=0;e<this.width;e++)t.setBitXY(e,0),t.setBitXY(e,this.height-1);for(var r=0;r<this.height;r++)t.setBitXY(0,r),t.setBitXY(this.width-1,r);this.computed.boxMask=t}return this.computed.boxMask}get mask(){if(!this.computed.mask){for(var t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),e=0;e<this.width;e++)for(var r=0;r<this.height;r++)this.map.data[e+this.minX+(r+this.minY)*this.map.width]===this.id&&t.setBitXY(e,r);this.computed.mask=t}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){for(var t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),e=0;e<this.width;e++)for(var r=0;r<this.height;r++){var i=e+this.minX+(r+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[i])&&t.setBitXY(e,r)}this.computed.filledMask=t}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){var t=new Shape({kind:"smallCross"}).getMask();t.parent=this.map.parent,t.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=t}return this.computed.centerMask}get hullMask(){if(!this.computed.hullMask){for(var t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),e=this.contourMask.monotoneChainConvexHull(),r=0;r<this.width;r++)for(var i=0;i<this.height;i++)1!==robustPnp(e,[r,i])&&t.setBitXY(r,i);this.computed.hullMask=t}return this.computed.hullMask}get mbrMask(){if(!this.computed.mbrMask){for(var t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),e=this.mask.minimalBoundingRectangle(),r=0;r<this.width;r++)for(var i=0;i<this.height;i++)1!==robustPnp(e,[r,i])&&t.setBitXY(r,i);this.computed.mbrMask=t}return this.computed.mbrMask}get points(){if(!this.computed.points){for(var t=[],e=0;e<this.height;e++)for(var r=0;r<this.width;r++){var i=(e+this.minY)*this.map.width+r+this.minX;this.map.data[i]===this.id&&t.push([r,e])}this.computed.points=t}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){for(var t,e=0,r=this.points,i=0;i<r.length;i++)for(var n=i+1;n<r.length;n++){var a=Math.pow(r[i][0]-r[n][0],2)+Math.pow(r[i][1]-r[n][1],2);a>=e&&(e=a,t=[r[i],r[n]])}this.computed.maxLengthPoints=t}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){var t=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=t}return this.computed.maxLength}get angle(){if(!this.computed.angle){var t=this.maxLengthPoints,e=180*-Math.atan2(t[0][1]-t[1][1],t[0][0]-t[1][0])/Math.PI;this.computed.angle=e}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface}}}function getBorders(t){for(var e=t.map,r=e.data,i=new Set,n=new Map,a=new Set,o=[1,0,-1,0],s=[0,1,0,-1],h=t.minX;h<=t.maxX;h++)for(var l=t.minY;l<=t.maxY;l++){if(r[h+l*e.width]===t.id)for(var u=0;u<4;u++){var f=h+o[u],c=l+s[u];if(f>=0&&c>=0&&f<e.width&&c<e.height){var d=f+c*e.width;if(r[d]!==t.id&&!a.has(d)){a.add(d),i.add(r[d]);var m=n.get(r[d]);m?n.set(r[d],++m):n.set(r[d],1)}}}}var g=Array.from(i),p=g.map((function(t){return n.get(t)}));return{ids:g,lengths:p}}function getBoxIDs(t){var e=new Set,r=t.map,i=r.data;for(var n of[0,t.height-1])for(var a=0;a<t.width;a++){var o=(n+t.minY)*r.width+a+t.minX;if(a-t.minX>0&&i[o]===t.id&&i[o-1]!==t.id){var s=i[o-1];e.add(s)}if(r.width-a-t.minX>1&&i[o]===t.id&&i[o+1]!==t.id){var h=i[o+1];e.add(h)}}for(var l of[0,t.width-1])for(var u=0;u<t.height;u++){var f=(u+t.minY)*r.width+l+t.minX;if(u-t.minY>0&&i[f]===t.id&&i[f-r.width]!==t.id){var c=i[f-r.width];e.add(c)}if(r.height-u-t.minY>1&&i[f]===t.id&&i[f+r.width]!==t.id){var d=i[f+r.width];e.add(d)}}return Array.from(e)}function getBox(t){var e=0,r=t.map,i=r.data,n=[0];for(var a of(t.height>1&&(n[1]=t.height-1),n))for(var o=1;o<t.width-1;o++){i[(a+t.minY)*r.width+o+t.minX]===t.id&&e++}var s=[0];for(var h of(t.width>1&&(s[1]=t.width-1),s))for(var l=0;l<t.height;l++){i[(l+t.minY)*r.width+h+t.minX]===t.id&&e++}return e}function getBorder(t){for(var e=0,r=t.map,i=r.data,n=1;n<t.width-1;n++)for(var a=1;a<t.height-1;a++){var o=(a+t.minY)*r.width+n+t.minX;i[o]===t.id&&(i[o-1]===t.id&&i[o+1]===t.id&&i[o-r.width]===t.id&&i[o+r.width]===t.id||e++)}return e+t.box}function getExternal(t){for(var e=0,r=t.map,i=r.data,n=1;n<t.width-1;n++)for(var a=1;a<t.height-1;a++){var o=(a+t.minY)*r.width+n+t.minX;i[o]===t.id&&(t.externalIDs.includes(i[o-1])||t.externalIDs.includes(i[o+1])||t.externalIDs.includes(i[o-r.width])||t.externalIDs.includes(i[o+r.width]))&&e++}return e+t.box}function getInternalIDs(t){var e=[t.id],r=t.map,i=r.data;if(t.height>2)for(var n=0;n<t.width;n++){var a=t.minY*r.width+n+t.minX;if(e.includes(i[a])){var o=i[a+r.width];e.includes(o)||t.boxIDs.includes(o)||e.push(o)}}for(var s=new Array(4),h=1;h<t.width-1;h++)for(var l=1;l<t.height-1;l++){var u=(l+t.minY)*r.width+h+t.minX;if(e.includes(i[u])){s[0]=i[u-1],s[1]=i[u+1],s[2]=i[u-r.width],s[3]=i[u+r.width];for(var f=0;f<4;f++){var c=s[f];e.includes(c)||t.boxIDs.includes(c)||e.push(c)}}}return e}class RoiLayer{constructor(t,e){this.roiMap=t,this.options=e,this.roi=this.createRoi()}createRoi(){var t=this.roiMap.data,e={};this.roiMap.positive=0,this.roiMap.negative=0;for(var r=0;r<t.length;r++)t[r]&&!e[t[r]]&&(e[t[r]]=!0,t[r]>0?this.roiMap.positive++:this.roiMap.negative++);var i={};for(var n in e)i[n]=new Roi(this.roiMap,1*n);for(var a=this.roiMap.width,o=this.roiMap.height,s=0;s<o;s++)for(var h=0;h<a;h++){var l=s*a+h;if(0!==t[l]){var u=i[t[l]];h<u.minX&&(u.minX=h),h>u.maxX&&(u.maxX=h),s<u.minY&&(u.minY=s),s>u.maxY&&(u.maxY=s),u.meanX+=h,u.meanY+=s,u.surface++}}var f=[];for(var c in e)i[c].meanX/=i[c].surface,i[c].meanY/=i[c].surface,f.push(i[c]);return f}}function commonBorderLength(t){for(var e=t.data,r=[1,0,-1,0],i=[0,1,0,-1],n=t.minMax,a=-n.min,o=n.max+a,s=[],h=0;h<=o;h++)s.push(Object.create(null));for(var l=0;l<t.width;l++)for(var u=0;u<t.height;u++){var f=e[l+u*t.width];if(0!==f){for(var c=Object.create(null),d=!1,m=0;m<4;m++){var g=l+r[m],p=u+i[m];if(g>=0&&p>=0&&g<t.width&&p<t.height){var w=e[g+p*t.width];f!==w&&(d=!0,0!==w&&void 0===c[w]&&(c[w]=!0,s[w+a][f]?s[w+a][f]++:s[w+a][f]=1))}else d=!0}d&&(s[f+a][f]?s[f+a][f]++:s[f+a][f]=1)}}for(var v={},_=0;_<s.length;_++)Object.keys(s[_]).length>0&&(v[_-a]=s[_]);return v}function mergeRoi(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.algorithm,r=void 0===e?"commonBorderLength":e,i=t.minCommonBorderLength,n=void 0===i?5:i,a=t.maxCommonBorderLength,o=void 0===a?100:a,s=t.minCommonBorderRatio,h=void 0===s?.3:s,l=t.maxCommonBorderRatio,u=void 0===l?1:l,f=function(t,e,r){return t[r]>=n&&t[r]<=o};"function"==typeof r&&(f=r),"commonborderratio"===r.toLowerCase()&&(f=function(t,e,r){var i=Math.min(t[r]/t[e],1);return i>=h&&i<=u});var c=this,d=c.commonBorderLength,m={},g={};for(var p of Object.keys(d)){var w=d[p],v=Object.keys(w);for(var _ of v)if(_!==p&&f(w,p,_)){var b=_;g[_]&&(b=g[_]);var y=p;if(g[p]&&(y=g[p]),Number(b)!==y){var M=Math.min(b,y),x=Math.max(b,y);if(m[M]||(m[M]={}),m[M][x]=!0,g[x]=M,m[x]){for(var E of Object.keys(m[x]))m[M][E]=!0,g[E]=M;delete m[x]}}}}var A=c.minMax,k=-A.min,S=A.max+k,I=new Array(S+1).fill(0);for(var D of Object.keys(g))I[Number(D)+k]=g[D];for(var T=c.data,R=0;R<T.length;R++){var B=T[R];if(0!==B){var C=I[B+k];0!==C&&(T[R]=C)}}return c.computed={},c}class RoiMap{constructor(t,e){this.parent=t,this.width=t.width,this.height=t.height,this.data=e,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){for(var t=Number.MAX_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER,r=0;r<this.data.length;r++)this.data[r]<t&&(t=this.data[r]),this.data[r]>e&&(e=this.data[r]);return{min:t,max:e}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return mergeRoi.call(this,t)}mergeRois(t){for(var e=t[0],r=t.slice(1),i=0;i<this.data.length;i++)r.includes(this.data[i])&&(this.data[i]=e)}rowsInfo(){for(var t=new Array(this.height),e=0,r=0;r<this.data.length;r+=this.width){var i={row:e,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[e++]=i;for(var n={},a={},o=[],s=this.data[r],h=0,l=r;l<r+this.width;l++){var u=this.data[l];s!==u&&(s=u,o.push(h),h=0),h++,u>0?(i.positivePixel++,n[u]||(n[u]=!0)):u<0?(i.negativePixel++,a[u]||(a[u]=!0)):i.zeroPixel++}o.push(h),i.medianChange=o.sort((t,e)=>t-e)[Math.floor(o.length/2)],i.positiveRoiIDs=Object.keys(n),i.negativeRoiIDs=Object.keys(a),i.positiveRoi=i.positiveRoiIDs.length,i.negativeRoi=i.negativeRoiIDs.length}return t}colsInfo(){for(var t=new Array(this.width),e=0,r=0;r<this.width;r++){var i={col:e,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[e++]=i;for(var n={},a={},o=[],s=this.data[r],h=0,l=r;l<r+this.data.length;l+=this.width){var u=this.data[l];s!==u&&(s=u,o.push(h),h=0),h++,u>0?(i.positivePixel++,n[u]||(n[u]=!0)):u<0?(i.negativePixel++,a[u]||(a[u]=!0)):i.zeroPixel++}o.push(h),i.medianChange=o.sort((t,e)=>t-e)[Math.floor(o.length/2)],i.positiveRoiIDs=Object.keys(n),i.negativeRoiIDs=Object.keys(a),i.positiveRoi=i.positiveRoiIDs.length,i.negativeRoi=i.negativeRoiIDs.length}return t}}function fromMask(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.allowCorners,i=void 0!==r&&r,n=65535,a=new Int16Array(t.size),o=0,s=0,h=new Uint16Array(n+1),l=new Uint16Array(n+1),u=0;u<t.width;u++)for(var f=0;f<t.height;f++)0===a[f*t.width+u]&&c(u,f);function c(e,r){var u=0,f=0,c=t.getBitXY(e,r),d=c?++o:--s;if(o>32767||s<-32768)throw new Error("Too many regions of interest");for(h[0]=e,l[0]=r;u<=f;){var m=h[u&n],g=l[u&n];if(a[g*t.width+m]=d,m>0&&0===a[g*t.width+m-1]&&t.getBitXY(m-1,g)===c&&(f++,h[f&n]=m-1,l[f&n]=g,a[g*t.width+m-1]=-32768),g>0&&0===a[(g-1)*t.width+m]&&t.getBitXY(m,g-1)===c&&(f++,h[f&n]=m,l[f&n]=g-1,a[(g-1)*t.width+m]=-32768),m<t.width-1&&0===a[g*t.width+m+1]&&t.getBitXY(m+1,g)===c&&(f++,h[f&n]=m+1,l[f&n]=g,a[g*t.width+m+1]=-32768),g<t.height-1&&0===a[(g+1)*t.width+m]&&t.getBitXY(m,g+1)===c&&(f++,h[f&n]=m,l[f&n]=g+1,a[(g+1)*t.width+m]=-32768),i&&(m>0&&g>0&&0===a[(g-1)*t.width+m-1]&&t.getBitXY(m-1,g-1)===c&&(f++,h[f&n]=m-1,l[f&n]=g-1,a[(g-1)*t.width+m-1]=-32768),m<t.width-1&&g>0&&0===a[(g-1)*t.width+m+1]&&t.getBitXY(m+1,g-1)===c&&(f++,h[f&n]=m+1,l[f&n]=g-1,a[(g-1)*t.width+m+1]=-32768),m>0&&g<t.height-1&&0===a[(g+1)*t.width+m-1]&&t.getBitXY(m-1,g+1)===c&&(f++,h[f&n]=m-1,l[f&n]=g+1,a[(g+1)*t.width+m-1]=-32768),m<t.width-1&&g<t.height-1&&0===a[(g+1)*t.width+m+1]&&t.getBitXY(m+1,g+1)===c&&(f++,h[f&n]=m+1,l[f&n]=g+1,a[(g+1)*t.width+m+1]=-32768)),f-++u>n)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(t,a)}class DisjointSet{constructor(){this.nodes=new Map}add(t){var e=this.nodes.get(t);return e||(e=new DisjointSetNode(t),this.nodes.set(t,e)),e}union(t,e){const r=this.find(t),i=this.find(e);r!==i&&(r.rank<i.rank?r.parent=i:r.rank>i.rank?i.parent=r:(i.parent=r,r.rank++))}find(t){for(var e=t;null!==e.parent;)e=e.parent;for(var r=t;null!==r.parent;){var i=r;r=r.parent,i.parent=e}return e}connected(t,e){return this.find(t)===this.find(e)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(t){this.value=t,this.parent=null,this.rank=0}var direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(t){var e,r,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.allowCorners,o=void 0!==a&&a,s=4;if(o&&(s=8),8===s)e=direction8X,r=direction8Y,i=neighbours8;else{if(4!==s)throw new RangeError("unsupported neighbours count: "+s);e=direction4X,r=direction4Y,i=neighbours4}for(var h=t.size,l=t.width,u=t.height,f=new Array(h),c=new Uint32Array(h),d=new DisjointSet_1,m=1,g=0;g<u;g++)for(var p=0;p<l;p++){var w=p+g*l;if(t.getBit(w)){for(var v=null,_=0;_<i.length;_++){var b=p+e[_],y=g+r[_];if(b>=0&&y>=0&&b<l&&y<u){var M=b+y*l,x=f[M];x?(i[_]=x,(!v||i[_].value<v.value)&&(v=i[_])):i[_]=null}}if(v){f[w]=v;for(var E=0;E<i.length;E++)i[E]&&i[E]!==v&&d.union(v,i[E])}else f[w]=d.add(m++)}}for(var A=0;A<u;A++)for(var k=0;k<l;k++){var S=k+A*l;t.getBit(S)&&(c[S]=d.find(f[S]).value)}return new RoiMap(t,c)}function fromMaxima(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.allowCorner,r=void 0===e||e,i=t.onlyTop,n=void 0!==i&&i,a=(t.invert,this);a.checkProcessable("fromMaxima",{components:[1]});var o=1,s=2,h=0,l=0,u=new Int16Array(a.size),f=new Int8Array(a.size),c=new Float32Array(a.size),d=1048575,m=new Uint16Array(d+1),g=new Uint16Array(d+1),p=0,w=0,v=new Uint16Array(d+1),_=new Uint16Array(d+1),b=0,y=0;for(E(a);p<w;){var M=m[p&d],x=g[p&d];k(M,x,s),p++}return new RoiMap(a,u);function E(t){for(var e=t.maxima,i=void 0===e||e,n=1;n<a.height-1;n++)for(var o=1;o<a.width-1;o++){var s=o+n*a.width;if(0===f[s]){var c=i?a.data[s]:-a.data[o+n*a.width];if(a.data[n*a.width+o-1]>c)continue;if(a.data[n*a.width+o+1]>c)continue;if(a.data[(n-1)*a.width+o]>c)continue;if(a.data[(n+1)*a.width+o]>c)continue;if(r){if(a.data[(n-1)*a.width+o-1]>c)continue;if(a.data[(n-1)*a.width+o+1]>c)continue;if(a.data[(n+1)*a.width+o-1]>c)continue;if(a.data[(n+1)*a.width+o+1]>c)continue}u[s]=i?++h:--l,A(o,n)||(i?--h:++l)}}}function A(t,e){var r=w;b=0,y=1,v[0]=t,_[0]=e;for(var i=!0;b<y;){i&=k(v[b&d],_[b&d],o),b++}if(!i){for(var n=0;n<y;n++){var s=v[n&d],h=_[n&d]*a.width+s;u[h]=0}w=r}return i}function k(t,e,r){for(var i=u[e*a.width+t],h=a.data[e*a.width+t],l=e-1;l<=e+1;l++)for(var p=t-1;p<=t+1;p++){var b=l*a.width+p;if(0===f[b])switch(f[b]=1,c[b]=a.data[b]-h,r){case o:if(0===c[b]){if(0===p||0===l||p===a.width-1||l===a.height-1)return!1;u[b]=i,v[y&d]=p,_[y&d]=l,y++}else{if(c[b]>0)return!1;n||(u[b]=i,m[w&d]=p,g[w&d]=l,w++)}break;case s:c[b]<=0&&(u[b]=i,m[w&d]=p,g[w&d]=l,w++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new Shape(e),i=new Int16Array(this.size),n=0,a=r.getPoints(),o=0;o<t.length;o++){n++;for(var s=t[o][0],h=t[o][1],l=0;l<a.length;l++){var u=a[l][0],f=a[l][1];s+u>=0&&h+f>=0&&s+u<this.width&&h+f<this.height&&(i[s+u+(h+f)*this.width]=n)}}return new RoiMap(this,i)}var priorityQueue=createCommonjsModule((function(t,e){t.exports=function t(e,r,i){function n(o,s){if(!r[o]){if(!e[o]){var h="function"==typeof commonjsRequire&&commonjsRequire;if(!s&&h)return h(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[o]={exports:{}};e[o][0].call(u.exports,(function(t){var r=e[o][1][t];return n(r||t)}),u,u.exports,t,e,r,i)}return r[o].exports}for(var a="function"==typeof commonjsRequire&&commonjsRequire,o=0;o<i.length;o++)n(i[o]);return n}({1:[function(t,e,r){var i,n,a,o,s,h={}.hasOwnProperty;i=t("./PriorityQueue/AbstractPriorityQueue"),n=t("./PriorityQueue/ArrayStrategy"),o=t("./PriorityQueue/BinaryHeapStrategy"),a=t("./PriorityQueue/BHeapStrategy"),(s=function(t){function e(t){t||(t={}),t.strategy||(t.strategy=o),t.comparator||(t.comparator=function(t,e){return(t||0)-(e||0)}),e.__super__.constructor.call(this,t)}return function(t,e){for(var r in e)h.call(e,r)&&(t[r]=e[r]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,t),e}(i)).ArrayStrategy=n,s.BinaryHeapStrategy=o,s.BHeapStrategy=a,e.exports=s},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(t,e,r){e.exports=function(){function t(t){var e;if(null==(null!=t?t.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=t?t.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new t.strategy(t),this.length=(null!=t&&null!=(e=t.initialValues)?e.length:void 0)||0}return t.prototype.queue=function(t){this.length++,this.priv.queue(t)},t.prototype.dequeue=function(t){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},t.prototype.peek=function(t){if(!this.length)throw"Empty queue";return this.priv.peek()},t.prototype.clear=function(){return this.length=0,this.priv.clear()},t}()},{}],3:[function(t,e,r){var i;i=function(t,e,r){var i,n,a;for(n=0,i=t.length;n<i;)r(t[a=n+i>>>1],e)>=0?n=a+1:i=a;return n},e.exports=function(){function t(t){var e;this.options=t,this.comparator=this.options.comparator,this.data=(null!=(e=this.options.initialValues)?e.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return t.prototype.queue=function(t){var e;e=i(this.data,t,this.comparator),this.data.splice(e,0,t)},t.prototype.dequeue=function(){return this.data.pop()},t.prototype.peek=function(){return this.data[this.data.length-1]},t.prototype.clear=function(){this.data.length=0},t}()},{}],4:[function(t,e,r){e.exports=function(){function t(t){var e,r,i,n,a,o,s,h;for(this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.pageSize=(null!=t?t.pageSize:void 0)||512,this.length=0,s=0;1<<s<this.pageSize;)s+=1;if(1<<s!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=s,this._emptyMemoryPageTemplate=e=[],r=0,a=this.pageSize;0<=a?r<a:r>a;0<=a?++r:--r)e.push(null);if(this._memory=[],this._mask=this.pageSize-1,t.initialValues)for(i=0,n=(o=t.initialValues).length;i<n;i++)h=o[i],this.queue(h)}return t.prototype.queue=function(t){this.length+=1,this._write(this.length,t),this._bubbleUp(this.length,t)},t.prototype.dequeue=function(){var t,e;return t=this._read(1),e=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,e),this._bubbleDown(1,e)),t},t.prototype.peek=function(){return this._read(1)},t.prototype.clear=function(){this.length=0,this._memory.length=0},t.prototype._write=function(t,e){var r;for(r=t>>this._shift;r>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[r][t&this._mask]=e},t.prototype._read=function(t){return this._memory[t>>this._shift][t&this._mask]},t.prototype._bubbleUp=function(t,e){var r,i,n,a;for(r=this.comparator;t>1&&(i=t&this._mask,t<this.pageSize||i>3?n=t&~this._mask|i>>1:i<2?(n=t-this.pageSize>>this._shift,n+=n&~(this._mask>>1),n|=this.pageSize>>1):n=t-2,!(r(a=this._read(n),e)<0));)this._write(n,e),this._write(t,a),t=n},t.prototype._bubbleDown=function(t,e){var r,i,n,a,o;for(o=this.comparator;t<this.length;)if(t>this._mask&&!(t&this._mask-1)?r=i=t+2:t&this.pageSize>>1?(r=(t&~this._mask)>>1,i=1+(r=1+(r|=t&this._mask>>1)<<this._shift)):i=(r=t+(t&this._mask))+1,r!==i&&i<=this.length)if(n=this._read(r),a=this._read(i),o(n,e)<0&&o(n,a)<=0)this._write(r,e),this._write(t,n),t=r;else{if(!(o(a,e)<0))break;this._write(i,e),this._write(t,a),t=i}else{if(!(r<=this.length))break;if(!(o(n=this._read(r),e)<0))break;this._write(r,e),this._write(t,n),t=r}},t}()},{}],5:[function(t,e,r){e.exports=function(){function t(t){var e;this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.length=0,this.data=(null!=(e=t.initialValues)?e.slice(0):void 0)||[],this._heapify()}return t.prototype._heapify=function(){var t,e,r;if(this.data.length>0)for(t=e=1,r=this.data.length;1<=r?e<r:e>r;t=1<=r?++e:--e)this._bubbleUp(t)},t.prototype.queue=function(t){this.data.push(t),this._bubbleUp(this.data.length-1)},t.prototype.dequeue=function(){var t,e;return e=this.data[0],t=this.data.pop(),this.data.length>0&&(this.data[0]=t,this._bubbleDown(0)),e},t.prototype.peek=function(){return this.data[0]},t.prototype.clear=function(){this.length=0,this.data.length=0},t.prototype._bubbleUp=function(t){for(var e,r;t>0&&(e=t-1>>>1,this.comparator(this.data[t],this.data[e])<0);)r=this.data[e],this.data[e]=this.data[t],this.data[t]=r,t=e},t.prototype._bubbleDown=function(t){var e,r,i,n,a;for(e=this.data.length-1;n=1+(r=1+(t<<1)),i=t,r<=e&&this.comparator(this.data[r],this.data[i])<0&&(i=r),n<=e&&this.comparator(this.data[n],this.data[i])<0&&(i=n),i!==t;)a=this.data[i],this.data[i]=this.data[t],this.data[t]=a,t=i},t}()},{}]},{},[1])(1)})),dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.points,r=t.mask,i=t.image,n=t.fillMaxValue,a=void 0===n?this.maxValue:n,o=t.invert,s=void 0!==o&&o,h=i||this;h.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),s=!s,e||(e=h.getLocalMaxima({invert:s,mask:r}));for(var l=s?0:1,u=new Int16Array(h.size),f=h.width,c=h.height,d=new priorityQueue({comparator:(t,e)=>t[2]-e[2],strategy:priorityQueue.BinaryHeapStrategy}),m=0;m<e.length;m++){var g=e[m][0]+e[m][1]*f;u[g]=m+1;var p=h.data[g];(s&&p<=a||!s&&p>=a)&&d.queue([e[m][0],e[m][1],p])}for(;d.length>0;)for(var w=d.dequeue(),v=w[0]+w[1]*f,_=0;_<4;_++){var b=w[0]+dxs[_],y=w[1]+dys[_];if(b>=0&&y>=0&&b<f&&y<c){var M=b+y*f;if(!r||r.getBit(M)===l){var x=h.data[M];(s&&x<=a||!s&&x>=a)&&0===u[M]&&(u[M]=u[v],d.queue([w[0]+dxs[_],w[1]+dys[_],x]))}}}return new RoiMap(h,u)}class RoiManager{constructor(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._image=t,this._options=e,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},this._options,t),r=fromMaxima.call(this._image,t);this._layers[e.label]=new RoiLayer(r,e)}fromPoints(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object.assign({},this._options,e),i=fromPoints.call(this._image,t,e);return this._layers[r.label]=new RoiLayer(i,r),this}putMap(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new RoiMap(this._image,t),i=Object.assign({},this._options,e);return this._layers[i.label]=new RoiLayer(r,i),this}fromWaterShed(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},this._options,t),r=fromWaterShed.call(this._image,t);this._layers[e.label]=new RoiLayer(r,e)}fromMask(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object.assign({},this._options,e),i=fromMask.call(this._image,t,e);return this._layers[r.label]=new RoiLayer(i,r),this}fromMaskConnectedComponentLabelingAlgorithm(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object.assign({},this._options,e),i=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,t,e);return this._layers[r.label]=new RoiLayer(i,r),this}getMap(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},this._options,t);return this._assertLayerWithLabel(e.label),this._layers[e.label].roiMap}rowsInfo(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.getMap(t).rowsInfo()}colsInfo(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.getMap(t).rowsInfo()}getRoiIds(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getRois(t);if(e){for(var r=new Array(e.length),i=0;i<e.length;i++)r[i]=e[i].id;return r}throw new Error("ROIs not found")}getRois(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.label,r=void 0===e?this._options.label:e,i=t.positive,n=void 0===i||i,a=t.negative,o=void 0===a||a,s=t.minSurface,h=void 0===s?0:s,l=t.maxSurface,u=void 0===l?Number.POSITIVE_INFINITY:l,f=t.minWidth,c=void 0===f?0:f,d=t.maxWidth,m=void 0===d?Number.POSITIVE_INFINITY:d,g=t.minHeight,p=void 0===g?0:g,w=t.maxHeight,v=void 0===w?Number.POSITIVE_INFINITY:w,_=t.minRatio,b=void 0===_?0:_,y=t.maxRatio,M=void 0===y?Number.POSITIVE_INFINITY:y;if(!this._layers[r])throw new Error(`this Roi layer (${r}) does not exist`);var x=this._layers[r].roi,E=[];for(var A of x)(A.id<0&&o||A.id>0&&n)&&A.surface>=h&&A.surface<=u&&A.width>=c&&A.width<=m&&A.height>=p&&A.height<=v&&A.ratio>=b&&A.ratio<=M&&E.push(A);return E}getRoi(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).label,r=void 0===e?this._options.label:e;if(!this._layers[r])throw new Error(`this Roi layer (${r}) does not exist`);var i=this._layers[r].roi.find(e=>e.id===t);if(!i)throw new Error("found no Roi with id "+t);return i}getMasks(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getRois(t),r=new Array(e.length),i=0;i<e.length;i++)r[i]=e[i].getMask(t);return r}getData(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},this._options,t);return this._assertLayerWithLabel(e.label),this._layers[e.label].roiMap.data}paint(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.labelProperty;this._painted||(this._painted=this._image.rgba8());var r=this.getMasks(t);if(e){var i=this.getRois(t);t.labels=i.map(t=>t[e]),t.labelsPosition=i.map(t=>[t.meanX,t.meanY])}return this._painted.paintMasks(r,t),this._painted}getMask(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new Image(this._image.width,this._image.height,{kind:"BINARY"}),r=this.getMasks(t),i=0;i<r.length;i++)for(var n=r[i],a=0;a<n.width;a++)for(var o=0;o<n.height;o++)n.getBitXY(a,o)&&e.setBitXY(a+n.position[0],o+n.position[1]);return e}resetPainted(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).image;this._painted=t?this.image.rgba8():this._image.rgba8()}mergeRoi(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getMap(t);return e.mergeRoi(t),this.putMap(e.data,t),this}mergeRois(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Array.isArray(t)||t.some(t=>!Number.isInteger(t)))throw new Error("Roi ids must be an array of integers");if(t.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(t).size!==t.length)throw new Error("Roi ids must be all different");t.forEach(t=>this.getRoi(t));var r=this.getMap(e);return r.mergeRois(t),this.putMap(r.data,e),this}findCorrespondingRoi(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.getRois(e),i=[],n=0;n<r.length;n++){var a=r[n],o=correspondingRoisInformation(a.minX,a.minY,a.points,t,Math.sign(a.id));i.push(o)}return i}_assertLayerWithLabel(t){if(!this._layers[t])throw new Error("no layer with label "+t)}}function correspondingRoisInformation(t,e,r,i,n){for(var a={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0},o=0;o<r.length;o++){var s=r[o],h=s[0]+t+(s[1]+e)*i.width,l=i.data[h];(l>0||l<0)&&(a.id.includes(l)?a.surface[a.id.indexOf(l)]+=1:(a.id.push(l),a.surface.push(1)))}for(var u=0;u<a.id.length;u++){Math.sign(a.id[u])===n?a.same+=a.surface[u]:a.opposite+=a.surface[u],a.roiSurfaceCovered[u]=a.surface[u]/r.length}return a.total=a.opposite+a.same,a}var objectToString=Object.prototype.toString;class Image{constructor(t,e,r,i){if(1===arguments.length){var n=i=t;t=n.width,e=n.height,r=n.data}else if(r&&!r.length){r=(i=r).data}if(void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i={}),"object"!=typeof i||null===i)throw new TypeError("options must be an object");if(!Number.isInteger(t)||t<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(e)||e<=0)throw new RangeError("height must be a positive integer");var a=i.kind,o=void 0===a?RGBA:a;if("string"!=typeof o)throw new TypeError("kind must be a string");var s=getKind(o),h=Object.assign({},i);for(var l in s)void 0===h[l]&&(h[l]=s[l]);verifyKindDefinition(h);var u=h.components,f=h.bitDepth,c=h.colorModel,d=h.alpha+0,m=t*e,g=u+d,p=32===f?Number.MAX_VALUE:Math.pow(2,f)-1;if(void 0===r)r=createPixelArray(m,u,d,g,f,p);else{var w=getTheoreticalPixelArraySize(m,g,f);if(r.length!==w)throw new RangeError(`incorrect data size: ${r.length}. Should be ${w}`)}this.width=t,this.height=e,this.data=r,this.size=m,this.components=u,this.alpha=d,this.bitDepth=f,this.maxValue=p,this.colorModel=c,this.channels=g,this.meta=i.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:i.parent||null}),this.position=i.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(t){return"[object IJSImage]"===objectToString.call(t)}static fromCanvas(t){var e=t.getContext("2d").getImageData(0,0,t.width,t.height);return new Image(e.width,e.height,e.data)}static createFrom(t,e){var r=getImageParameters(t);return Object.assign(r,{parent:t,position:[0,0]},e),new Image(r)}getRoiManager(t){return new RoiManager(this,t)}clone(){var t=this.data.slice();return new Image(this.width,this.height,t,this)}apply(t){for(var e=0;e<this.height;e++)for(var r=0;r<this.width;r++){var i=(e*this.width+r)*this.channels;t.call(this,i)}}}function laplacianOfGaussian(t,e,r){var i,n,a,o,s=new Array(e);r||(r=100),r*=-1;var h=(e-1)/2,l=2*t*t;for(i=0;i<e;i++)for(s[i]=new Array(e),o=(i-h)*(i-h),n=0;n<e;n++)a=(n-h)*(n-h),s[i][n]=Math.round(r*(1-(a+o)/l)*Math.exp(-(a+o)/l));return s}setValueMethods(Image),setBitMethods(Image),setExportMethods(Image),Image.prototype.checkProcessable=checkProcessable,Image.prototype.getRGBAData=getRGBAData,Image.load=load,Image.extendMethod=extendMethod,Image.extendProperty=extendProperty,extend$1(Image);var kernel$1=Object.freeze({__proto__:null,laplacianOfGaussian:laplacianOfGaussian,DISCRETE_LAPLACE_4:DISCRETE_LAPLACE_4,DISCRETE_LAPLACE_8:DISCRETE_LAPLACE_8,SOBEL_X:SOBEL_X,SOBEL_Y:SOBEL_Y,SCHARR_X:SCHARR_X,SCHARR_Y:SCHARR_Y,SECOND_DERIVATIVE:SECOND_DERIVATIVE,SECOND_DERIVATIVE_INV:SECOND_DERIVATIVE_INV}),worker$1=function(){self.window=self;function t(){this._listeners={}}t.prototype.on=function(t,e){if(this._listeners[t])throw new RangeError("there is already a listener for "+t);if("function"!=typeof e)throw new TypeError("callback argument must be a function");this._listeners[t]=e},t.prototype._send=function(t,e,r){void 0===r?r=[]:Array.isArray(r)||(r=[r]),self.postMessage({id:t,data:e},r)},t.prototype._trigger=function(t,e){if(!this._listeners[t])throw new Error("event "+t+" is not defined");this._listeners[t].apply(null,e)};var e=new t;self.onmessage=function(t){switch(t.data.action){case"exec":t.data.args.unshift((function(r,i){e._send(t.data.id,r,i)})),e._trigger(t.data.event,t.data.args);break;case"ping":e._send(t.data.id,"pong");break;default:throw new Error("unexpected action: "+t.data.action)}}},workerStr=worker$1.toString().split('"CODE";'),newWorkerURL=function(t,e){var r=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(e)+");\n","(",t,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(r)},workerTemplate={newWorkerURL:newWorkerURL},CORES=navigator.hardwareConcurrency||1;function WorkerManager(t,e){if("string"!=typeof t&&"function"!=typeof t)throw new TypeError("func argument must be a function");if(void 0===e&&(e={}),"object"!=typeof e||null===e)throw new TypeError("options argument must be an object");this._workerCode=t.toString(),void 0===e.maxWorkers||"auto"===e.maxWorkers?this._numWorkers=Math.min(CORES-1,1):e.maxWorkers>0?this._numWorkers=Math.min(e.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=e.timeout||0,this._terminateOnError=!!e.terminateOnError;var r=e.deps;"string"==typeof r&&(r=[r]),Array.isArray(r)||(r=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(r)}WorkerManager.prototype._init=function(t){for(var e=workerTemplate.newWorkerURL(this._workerCode,t),r=0;r<this._numWorkers;r++){var i=new Worker(e);i.onmessage=this._onmessage.bind(this,i),i.onerror=this._onerror.bind(this,i),i.running=!1,i.id=r,this._workers.set(i,null)}URL.revokeObjectURL(e)},WorkerManager.prototype._onerror=function(t,e){if(!this._terminated){this._working--,t.running=!1;var r=this._workers.get(t);r&&r[1](e.message),this._workers.set(t,null),this._terminateOnError?this.terminate():this._exec()}},WorkerManager.prototype._onmessage=function(t,e){if(!this._terminated){this._working--,t.running=!1;var r=this._workers.get(t);r&&r[0](e.data.data),this._workers.set(t,null),this._exec()}},WorkerManager.prototype._exec=function(){for(var t of this._workers.keys()){if(this._working===this._numWorkers||0===this._waiting.length)return;if(!t.running)for(var e=0;e<this._waiting.length;e++){var r=this._waiting[e];if("number"!=typeof r[4]||r[4]===t.id){this._waiting.splice(e,1),t.postMessage({action:"exec",event:r[0],args:r[1]},r[2]),t.running=!0,t.time=Date.now(),this._workers.set(t,r[3]),this._working++;break}}}},WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var t of this._workers)t[0].terminate(),t[1]&&t[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}},WorkerManager.prototype.postAll=function(t,e){if(this._terminated)throw new Error("Cannot post (terminated)");var r=[];for(var i of this._workers.keys())r.push(this.post(t,e,[],i.id));return Promise.all(r)},WorkerManager.prototype.post=function(t,e,r,i){void 0===e&&(e=[]),void 0===r&&(r=[]),Array.isArray(e)||(e=[e]),Array.isArray(r)||(r=[r]);var n=this;return new Promise((function(a,o){if(n._terminated)throw new Error("Cannot post (terminated)");n._waiting.push([t,e,r,[a,o],i]),n._exec()}))};var src$4=WorkerManager,defaultOptions$d={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(t,e,r){e=Object.assign({},defaultOptions$d,e);var i=this.manager;return Array.isArray(t)?Promise.all(t.map((function(t){var n=runOnce(i,t,e);return"function"==typeof r&&n.then(r),n}))):runOnce(i,t,e)}function runOnce(t,e,r){return t.post("data",[e,r]).then((function(t){for(var e in t)t[e]=new Image(t[e]);return t}))}function work(){worker.on("data",(function(t,e,r){e=new IJS(e);var i={},n=[],a=e.grey(),o=a.sobelFilter();d("sobel",o);var s=o.level().mask({threshold:r.threshold});d("mask",s);var h=o.getRoiManager();h.fromMask(s);var l=h.getMask(r.roi);d("realMask",l);var u=a.getPixelsGrid({sampling:r.sampling,mask:l}),f=e.getBackground(u.xyS,u.zS,r.regression);d("background",f);var c=e.subtract(f);function d(t,e){r.include.includes(t)&&(i[t]=e,n.push(e.data.buffer))}i.result=c,n.push(c.data.buffer),t(i,n)}))}var background$1={run:run,work:work};function extend$2(t){t.extendMethod("background",background$1)}class Worker$1{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(null===this._url)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(t){if("string"!=typeof t)throw new TypeError("worker URL must be a string");this._url=t,this._deps[0]=t}static extendMethod(t,e){var r,i,n={};function a(){r||(this.checkUrl(),i=this.url,r=new src$4(e.work,{deps:i}),n.manager=r);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e.run.call(n,...a)}a.reset=function(){r&&(r.terminate(),r=new src$4(e.work,{deps:i}),n.manager=r)},Worker$1.prototype[t]=a}}extend$2(Worker$1);var worker$2=new Worker$1,Static={grey:names,threshold:names$1};exports.Image=Image,exports.Kernel=kernel$1,exports.Shape=Shape,exports.Stack=Stack,exports.Static=Static,exports.Worker=worker$2,exports.default=Image,Object.defineProperty(exports,"__esModule",{value:!0})}));
//# sourceMappingURL=image.min.js.map
